# Field Configuration

If you are using morsels' search UI **as-is** for static site search, you can likely skip configuring `fields_config.fields`.

There are a few other parameters under `fields_config` however, which can be used to adjust response times, caching, and file bloat individually. However, you should be well-served by the preconfigured [scaling presets](./presets.md) for such purposes.

```json
{
  "fields_config": {
    "cache_all_field_stores": true,
    "field_store_block_size": 10000,
    "num_stores_per_dir": 1000,
    "fields": [
      {
        "name": "title",
        "do_store": false,
        "weight": 2.0,
        "k": 1.2,
        "b": 0.15
      },
      {
        "name": "heading",
        "do_store": false,
        "weight": 1.5,
        "k": 1.2,
        "b": 0.25
      },
      {
        "name": "body",
        "do_store": false,
        "weight": 1.0,
        "k": 1.2,
        "b": 0.75
      },
      {
        "name": "headingLink",
        "do_store": false,
        "weight": 0.0,
        "k": 1.2,
        "b": 0.75
      },
      // Internal, hardcoded field (see "Reserved Fields")
      {
        "name": "_relative_fp",
        "do_store": true,
        "weight": 0.0,
        "k": 1.2,
        "b": 0.75
      }
    ]
  }
}
```

#### Storing Fields: **`do_store`**

Morsels stores fields that have `do_store: true` specified in the field configuration into a json file.
At search time, these fields are retrieved for result preview generation.

#### Field Store Granularity: **`field_store_block_size`, `num_stores_per_dir`**

The `field_store_block_size` parameter controls how many documents to store in one json file. Batching multiple files together if the fields stored are small can lead to less files and better browser caching. The `num_stores_per_dir` parameter controls how many json files should be stored together in one directory.

> ⚠️ Ensure `field_store_block_size` is a clean multiple or divisor of the `num_docs_per_block` parameter under [indexing](./indexing.md) later.<br>
> This is a rather arbitiary limitation chosen to reduce the field store indexing scheme complexity,
> but should work well enough for most use cases.

#### Field Store Caching: **`cache_all_field_stores`**

This is the same as the configuration option under [search configuration](../search_configuration.md#search-library-options).
If both are specified, the value specified in the `initMorsels` call will take priority.

All fields specified with `do_store=true` would be cached up front on initialisation of the search library.

Its usage alongside other options is discussed in more detail under the chapter [Tradeoffs](../tradeoffs.md).

#### Field Scoring Parameters

**`weight`**

This parameter is a boost / penalty multiplied to a individual field's score.

Specifying `0.0` will result in the field not being indexed (although, it can still be stored for retrieval using `do_store`).

**`k` & `b`**

These are Okapi BM25 model parameters. The following [article](https://www.elastic.co/guide/en/elasticsearch/guide/current/pluggable-similarites.html#bm25-tunability) provides a good overview on how to configure these if the defaults are unsuitable for your use case.

## Default Field Configuration

The functions of the default fields for the user interface are as follows:

<img alt="annotation for fields" src="../images/fields_annotated.png" />

- `title`: This is the header for a single document match. 

- `heading`: These are section headers which appear on the left of corresponding `body` field, sourced from `<h1-6>` tags.

- `headingLink`: These are the `id` attributes of corresponding `<h1-6>` tags. When found, an `#anchor` is appended to the link.

- `body`: This field is the text that appears to the right of headings (or on its own if there is no corresponding heading).

- `_relative_fp` **or** `link`: If the `title` field is missing for any document, this field takes its place in the header. It is also used to link to the source document (in the `<a />` tag) and (optionally) for generating result [previews](../search_configuration.md#default-rendering-output--purpose).

  - Note: The `link` field is not setup by default; The combination of `sourceFilesUrl` + `_relative_fp` serves the same purpose. The `link` field serves to accomodate more custom data requirements (e.g. linking to another domain, or indexing a json document).



## Mapping File Data to Fields

Defining fields is all good, but you may also need a way to map custom-formatted file data to each of these fields if the default mappings are insufficient. This is discussed later under [indexing](./indexing.md#mapping-file-data-to-fields-loader_configs).

The exception are the reserved fields below, which have "hardcoded" values.

### Reserved Fields

**`_relative_fp`**

This is a "hardcoded" field generated by the indexer, in that its value is fixed as the relative file path from your source folder path to the file.

It is included in the default configuration to facilitate constructing a source file link, used to link to the document itself (via the `<a></a>` tag), and optionally for result preview [generation](../search_configuration.md#options-for-generating-result-previews).

If this is removed, this field simply won't be indexed nor stored.
