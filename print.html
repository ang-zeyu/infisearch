<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js morsels-theme">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Morsels Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/morsels-theme.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "morsels-theme";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('morsels-theme')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="search_features.html"><strong aria-hidden="true">2.</strong> Search Features</a></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting_started_mdbook.html"><strong aria-hidden="true">3.1.</strong> mdBook</a></li><li class="chapter-item expanded "><a href="getting_started_others.html"><strong aria-hidden="true">3.2.</strong> Others</a></li></ol></li><li class="chapter-item expanded "><a href="search_configuration.html"><strong aria-hidden="true">4.</strong> Search UI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="search_configuration_themes.html"><strong aria-hidden="true">4.1.</strong> Themes</a></li><li class="chapter-item expanded "><a href="search_configuration_renderers.html"><strong aria-hidden="true">4.2.</strong> Altering HTML outputs</a></li></ol></li><li class="chapter-item expanded "><a href="indexer_configuration.html"><strong aria-hidden="true">5.</strong> Indexer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="indexer/fields.html"><strong aria-hidden="true">5.1.</strong> Fields</a></li><li class="chapter-item expanded "><a href="indexer/language.html"><strong aria-hidden="true">5.2.</strong> Language</a></li><li class="chapter-item expanded "><a href="indexer/indexing.html"><strong aria-hidden="true">5.3.</strong> Indexing</a></li><li class="chapter-item expanded "><a href="indexer/presets.html"><strong aria-hidden="true">5.4.</strong> Scaling Presets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tradeoffs.html"><strong aria-hidden="true">5.4.1.</strong> Tradeoffs</a></li></ol></li><li class="chapter-item expanded "><a href="incremental_indexing.html"><strong aria-hidden="true">5.5.</strong> Incremental Indexing</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Morsels Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ang-zeyu/morsels" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Morsels is a complete client-side search solution tailored for static sites, including a search <em>user interface and library</em> that depends on a <em>pre-built index</em> generated by a <em>command-line</em> tool.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>
<p><strong>Multi-threaded</strong> üèá CLI indexer powered by Rust</p>
</li>
<li>
<p><strong>Typo tolerance</strong> ‚å® with spelling correction and automatic prefix search</p>
</li>
<li>
<p><strong>Feature-rich search</strong> üîç: boolean queries, field filters, phrase queries, BM25 scoring, query term proximity boosts, persistent caching and WebWorker built-in</p>
</li>
<li>
<p>Powered by <strong>WebAssembly</strong>, enabling efficient index (de)compression and query processing </p>
</li>
<li>
<p><strong>Semi-Scalable</strong> üìà, achieved by (optionally) splitting the index into chunks (‚Äúmorsels‚Äù).</p>
</li>
<li>
<p><strong>Incremental</strong> Indexing</p>
</li>
<li>
<p><strong>Customisable</strong> dropdown / fullscreen popup user interface üñ•Ô∏è</p>
</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<p>You may want to use this tool if:</p>
<ul>
<li>You want a complete solution for static site search</li>
<li>You have a fairly <strong>large collection</strong> of HTML, csv, json or txt (only these are supported for now) files that cannot be monolithically retrieved or kept in memory feasibly</li>
<li>Running a search server / SaaS (eg. Algolia Docsearch) is not an option</li>
</ul>
<blockquote>
<p>‚ö†Ô∏è 
It is <strong>not possible</strong> to use morsels for <strong>client-side indexing</strong> since the indexer is a cli tool.</p>
<p>If this is the use case, consider other lighter-weight libraries like lunr.js that already fit well.</p>
</blockquote>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it Works:</a></h2>
<p><img src="./images/architecture.png" alt="Morsels‚Äô architecture diagram" /></p>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<p>This project is currently made up of 1 exposed crate and npm package, which may be referred to in the subsequent sections of the documentation.</p>
<h4 id="exposed-crates-and-packages"><a class="header" href="#exposed-crates-and-packages">Exposed Crates and Packages:</a></h4>
<ul>
<li><strong>morsels_indexer</strong>: the cli tool providing indexing functionalities for several file formats</li>
<li><strong>@morsels/search-ui</strong>: interfaces with @morsels/search-lib to provide basic search UI functionalities (e.g. result preview generation)</li>
</ul>
<details>
<summary>
<strong>Internal Crates and Packages:</strong>
</summary>
<ul>
<li><strong>morsels_search</strong>: internal rust wasm crate, used by the <strong>@morsels/search-lib</strong> package below.</li>
<li><strong>morsels_common</strong>: internal rust crate containing some common functionalities</li>
<li><strong>@morsels/search-lib</strong>: a small companion library to morsels_search for interfacing with the wasm crate. Serves only to separate some concerns from the UI package</li>
<li><strong>@morsels/lang-XX</strong>: internal tokenizer packages for different languages generated by wasm pack</li>
</ul>
</details>
<h2 id="other-limitations"><a class="header" href="#other-limitations">Other Limitations</a></h2>
<ol>
<li>
<p><strong>Latency</strong> &amp; File Bloat (only when fragmenting the index)</p>
<p>Scaling this tool for larger collections necessitates fragmenting the index and <strong>retrieving only what‚Äôs needed</strong> when searched, which means extra network requests, but to a reasonable degree. (see this <a href="https://ang-zeyu.github.io/morsels-demo-1/">demo</a>)</p>
<p>This tool should be able to handle <code>800MB</code> <strong>pure text</strong> (not counting things like HTML soup) collections with the full set of features enabled and some configuration tweaking.</p>
<p>The degree of fragmentation can be <a href="https://ang-zeyu.github.io/morsels/presets.html">configured</a> to varying degrees. That is, by default, Morsels can, and does function much like other existing monolithic pre-built index options in terms of the number of network requests, and you only ‚Äúpay for what you need‚Äù.</p>
</li>
<li>
<p><strong>Wasm</strong> ‚Äì no IE support =(</p>
</li>
<li>
<p><strong>Not production ready!</strong></p>
</li>
<li>
<p><strong>Browser Focused</strong>: For now, the focus is on providing e2e search functionalities in the browser. That means no Node.js support and such.</p>
</li>
</ol>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="search-features"><a class="header" href="#search-features">Search Features</a></h1>
<p>This page outlines the available search features common to both <code>@morsels/search-ui</code> and <code>@morsels/search-lib</code>.</p>
<h2 id="boolean-operators-parentheses"><a class="header" href="#boolean-operators-parentheses">Boolean Operators, Parentheses</a></h2>
<p><code>AND</code> and <code>NOT</code> operators are supported.
<code>OR</code> operators are not supported, but its function is implicitly left to the tokenizer (see below for an example).
Parentheses <code>(...)</code> can be used to group expressions together.</p>
<pre><code>lorem ipsum                 - documents containing either lorem or ipsum.
lorem AND ipsum             - documents with both &quot;lorem&quot; and &quot;ipsum&quot;
lorem AND NOT ipsum         - documents with &quot;lorem&quot; but not &quot;ipsum&quot;
lorem AND NOT (ipsum dolor) - documents with &quot;lorem&quot; but not (&quot;ipsum&quot; OR &quot;dolor&quot;)
</code></pre>
<h2 id="phrase-queries"><a class="header" href="#phrase-queries">Phrase Queries</a></h2>
<p>Phrase queries are also supported by enclosing the relevant terms in <code>&quot;...&quot;</code>.</p>
<pre><code>&quot;lorem ipsum&quot; - documents containing &quot;lorem&quot; and &quot;ipsum&quot; appearing one after the other
</code></pre>
<p>However, note these will not work if the <a href="./indexer/indexing.html#miscellaneous-options"><code>withPositions</code></a> index feature is disabled (enabled by default).</p>
<h2 id="field-search"><a class="header" href="#field-search">Field Search</a></h2>
<p>Field queries are supported via the following syntax <code>field_name:</code>, following the same syntax rules as the <code>NOT</code> operator.</p>
<pre><code>title:lorem             - documents containing &quot;lorem&quot; in the field &quot;title&quot;
title:(lorem AND ipsum) - documents with both &quot;lorem&quot; and &quot;ipsum&quot; in the
                          field &quot;title&quot; only
lorem AND title:ipsum   - documents with &quot;ipsum&quot; in the title and &quot;lorem&quot; in any field
</code></pre>
<h2 id="escaping-search-operators"><a class="header" href="#escaping-search-operators">Escaping Search Operators</a></h2>
<p>All search operators can also be escaped using the <code>\</code> character like such:</p>
<pre><code>lorem\ AND ipsum            - interpreted literally as &quot;lorem AND ipsum&quot;
\NOT lorem                  - interpreted literally as &quot;NOT lorem&quot;
\(not a parentheses group\)
\&quot;not a phrase query\&quot;
&quot;phrase query with qu\&quot;ote inside&quot;
title\:lorem
</code></pre>
<blockquote>
<p>üöß Usage instructions for most of these features currently aren‚Äôt included in the search user interface.</p>
<p>A ‚Äútip‚Äù floating action button is in the works.</p>
</blockquote>
<h2 id="non-user-facing-features"><a class="header" href="#non-user-facing-features">Non User-Facing Features</a></h2>
<h3 id="webworker-built-in"><a class="header" href="#webworker-built-in">WebWorker Built-in</a></h3>
<p>Most of the search library operates on a WebWorker where it matters (e.g. setup, query ranking), so you don‚Äôt have to worry about blocking the UI thread.</p>
<p>Retrieval of stored document fields (the raw document text for generating result previews and highlighting) is however done on the main thread, as copying many large documents to-and-fro WebWorker interfaces incurs substantial overhead.</p>
<p>Search UI (@morsels/search-ui) related functionalities, for example result preview generation, is also done on the main thread.
The main rationale is that there is simply no way of parsing HTML faster than implementations provided by the browser. (the original HTML document can be used as an alternative to storing document fields for result preview generation)</p>
<h3 id="low-level-inverted-index-format"><a class="header" href="#low-level-inverted-index-format">Low-Level Inverted Index Format</a></h3>
<p>Some basic, but high-return compression schemes are also employed:</p>
<ul>
<li>Gap encoding for document ids, positions</li>
<li>Bytewise variable integer encoding</li>
</ul>
<p>To facilitate decompression efficiency of such a low-level format, most of the search library is powered by WebAssembly (Rust) as such.</p>
<h3 id="ranking-specifics"><a class="header" href="#ranking-specifics">Ranking Specifics</a></h3>
<p>Most query expressions (e.g. free text queries like <code>lorem ipsum</code>) are ranked using the BM25 model, while <code>AND</code> and <code>()</code> operators sum the respective BM25 scores of their operands. A soft disjunctive maximum is calculated across a document‚Äôs field scores.</p>
<p>A simple form of <strong>query term proximity ranking</strong> is also supported and enabled by default for top-level expressions when the <code>with_positions</code> index <a href="./indexer/indexing.html#miscellaneous-options">feature</a> is enabled. Results are scaled in an inverse logarithmic manner according to how close disjunctive search expressions are to one another.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>This page assumes the use case of a <strong>static site</strong>, that is:</p>
<ul>
<li>You have some HTML files you want to index.</li>
<li>These HTML files are served in a static file server, and are linkable to.</li>
<li>You have an <code>&lt;input&gt;</code> element to attach a search dropdown to.</li>
<li>For mobile devices, a fullscreen UI will show instead when this input element is focused.<br><br>
This documentation uses an alternative interface (try the search function!), which is covered <a href="./search_configuration.html#ui-mode">later</a>.
To preview the defaults, head on over <a href="./search_configuration_themes.html">here</a>.</li>
</ul>
<p>If you require more (e.g. indexing custom json files), have a look through here first, then head on over to the subsequent configuration pages.</p>
<h2 id="installing-the-indexer"><a class="header" href="#installing-the-indexer">Installing the indexer</a></h2>
<p>There are two options here:</p>
<ul>
<li>If you have the rust / cargo toolchains setup, simply run <code>cargo install morsels_indexer --vers 0.1.0</code>.</li>
<li>Alternatively, the cli binaries are also available <a href="https://github.com/ang-zeyu/morsels/releases">here</a>.</li>
</ul>
<h2 id="running-the-indexer"><a class="header" href="#running-the-indexer">Running the indexer</a></h2>
<p>Run the executable as such, replacing <code>&lt;source-folder-path&gt;</code> with the relative or absolute folder path of your source html files, and <code>&lt;output-folder-path&gt;</code> with your desired index output folder.</p>
<pre><code>morsels &lt;source-folder-path&gt; &lt;output-folder-path&gt;
</code></pre>
<p>If you are using the binaries, replace <code>morsels</code> with the appropriate executable name.</p>
<h3 id="other-cli-options"><a class="header" href="#other-cli-options">Other Cli Options</a></h3>
<ul>
<li><code>-c &lt;config-file-path&gt;</code>: You may also change the config file location (relative to the <code>source-folder-path</code>) using the <code>-c &lt;config-file-path&gt;</code> option.</li>
<li><code>--preserve-output-folder</code>: All existing contents in the output folder are also removed when running a full index. Specify this option to avoid this.</li>
</ul>
<h2 id="installing-the-search-ui"><a class="header" href="#installing-the-search-ui">Installing the search UI</a></h2>
<h3 id="installation-via-cdn"><a class="header" href="#installation-via-cdn">Installation via CDN</a></h3>
<pre><code class="language-html">&lt;!-- Replace &quot;v0.1.0&quot; as appropriate --&gt;

&lt;!--  Search UI script --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.1.0/packages/search-ui/dist/search-ui.bundle.js&quot;&gt;&lt;/script&gt;
&lt;!-- Search UI css, this provides some basic styling for the search dropdown, and can be omitted if desired --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.1.0/packages/search-ui/dist/search-ui-light.css&quot; /&gt;
</code></pre>
<blockquote>
<p>‚ö†Ô∏è Ensure the versions here <strong>tally with the indexer version</strong> used.</p>
</blockquote>
<h3 id="hosting-the-files"><a class="header" href="#hosting-the-files">Hosting the Files</a></h3>
<p>If you wish to serve the files locally instead, you can find the necessary files in the release packages <a href="https://github.com/ang-zeyu/morsels/releases">here</a>. The following files inside <code>search.morsels.zip</code> are required:</p>
<ul>
<li><code>search-ui.bundle.js</code></li>
<li>Either <code>search-ui-light.css</code> / <code>search-ui-dark.css</code>
<ul>
<li>unless you are designing your own stylesheet from scratch</li>
</ul>
</li>
<li>A pair of language-specific bundles which are requested as necessary at runtime.
<ul>
<li><code>search.worker-*.bundle.js</code></li>
<li>an accompanying wasm binary</li>
</ul>
</li>
</ul>
<blockquote>
<p>‚ö†Ô∏è All files are expected to be <strong>accessible in the same folder</strong> relative to the linked <code>search-ui.bundle.js</code>.</p>
</blockquote>
<h3 id="ui-initialisation"><a class="header" href="#ui-initialisation">UI Initialisation</a></h3>
<p>Once you have loaded the bundles, to initialise morsels, simply call the <code>initMorsels</code> function in your page.</p>
<p>This <strong>requires an input element</strong> with an id of <code>morsels-search</code> to be present in the page by default, which can be configured via <code>uiOptions.input</code>.</p>
<pre><code class="language-ts">initMorsels({
  searcherOptions: {
    // Output folder url specified as the second parameter in the cli command
    url: 'http://192.168.10.132:3000/output/',
  },
  uiOptions: {
    // Input / source folder url, specified as the first parameter in the cli command
    sourceFilesUrl: 'http://192.168.10.132:3000/source/',
  }
});
</code></pre>
<h2 id="whats-next"><a class="header" href="#whats-next">What‚Äôs Next</a></h2>
<p>That‚Äôs it! Head on over to the search configuration chapter to learn more about configuring the UI behaviours / outputs.
The indexer configuration chapters covers a wide range of topics such as adding additional fields to index, mapping file contents to fields, and language configurations.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="mdbook-morsels"><a class="header" href="#mdbook-morsels">mdbook-morsels</a></h1>
<p><code>mdbook-morsels</code> is a simple search plugin replacement / proof-of-concept for <a href="https://github.com/rust-lang/mdBook">mdbook</a> to use morsels‚Äô search interface and library instead of elasticlunr.js.</p>
<h2 id="styling"><a class="header" href="#styling">Styling</a></h2>
<p>This plugin uses the css variables provided by the 5 main default themes in mdBook to style the search user interface. Switch the themes in this documentation to try out the different themes!</p>
<p>Note: The ‚ÄúMorsels‚Äù theme is not included in the plugin and is specific to this documentation. It is included only to show the default styling (without mdbook-morsels).</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>You will need to have installed the following command-line crates (<code>cargo install &lt;crate-name&gt;</code> or with the binaries in your <code>PATH</code>):</p>
<ul>
<li>mdbook</li>
<li>mdbook-morsels</li>
<li>morsels_indexer</li>
</ul>
<blockquote>
<p>‚ö†Ô∏è Ensure the mdbook-morsels and morsels_indexer versions are the same.</p>
</blockquote>
<p>Then, minimally add the first two configuration sections below to your <code>book.toml</code> configuration file:</p>
<pre><code class="language-toml">[output.html.search]
enable = false               # disable the default mdBook search feature implementation

[preprocessor.morsels]
command = &quot;mdbook-morsels&quot;
renderer = [&quot;html&quot;]          # this should only be run for the HTML renderer

# Plugin configuration options (optional)
[output.morsels]

# See search configuration page
mode = &quot;target&quot;

# Relative path to the indexer configuration file from the root project directory
# This will automatically be created if it dosen't exist.
config = &quot;morsels_config.json&quot;

# Don't add the default stylesheet from morsels/search-ui,
# nor the inline css variables for the default mdbook themes
#
# Only needed if you want to use some custom styling
no-css = false

# This scales some settings of the indexer according to your collection size
# (see chapter on &quot;Tradeoffs&quot;)
scaling = true
</code></pre>
<h2 id="preview"><a class="header" href="#preview">Preview</a></h2>
<p>Use the following (non-canonical, documentation specific) buttons to try out the different <a href="search_configuration.html#ui-mode"><strong><code>mode</code></strong> parameters</a>.</p>
<style>
    .demo-btn {
        padding: 5px 9px;
        margin: 0 8px 8px 8px;
        border: 2px solid var(--sidebar-bg) !important;
        border-radius: 10px;
        transition: all 0.15s linear;
        color: var(--fg) !important;
        text-decoration: none !important;
        font-weight: 600 !important;
    }

    .demo-btn:hover {
        color: var(--sidebar-fg) !important;
        background: var(--sidebar-bg) !important;
    }

    .demo-btn:active {
        color: var(--sidebar-active) !important;
    }
</style>
<div style="display: flex; justify-content: center; flex-wrap: wrap;">
    <a class="demo-btn" href="?mode=auto">Auto</a>
    <a class="demo-btn" href="?mode=dropdown">Dropdown</a>
    <a class="demo-btn" href="?mode=fullscreen">Fullscreen</a>
    <a class="demo-btn" href="?mode=target">Target</a>
</div>
<p>You can also try out the different <strong>themes</strong> on this documentation using mdbook‚Äôs paintbrush icon!</p>
<figure>
<p><img src="./images/mdbook-preview.gif" alt="mdbook morsels plugin preview" /></p>
<figcaption style="text-align: center;">
<p><em>Gif of</em> <code>mode='fullscreen'</code> <em>across the different themes</em></p>
</figcaption>
</figure>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="other-use-cases"><a class="header" href="#other-use-cases">Other Use Cases</a></h1>
<p>Since its indexer is essentially just a CLI tool, morsels could in-theory be used almost anywhere (e.g. other static site generators) easily without a custom wrapper implementation (such as the Mdbook plugin).</p>
<p>For example, to deploy another static site generator to gh-pages using github actions, simply chain the morsels tool on top of the static site generator output:</p>
<pre><code class="language-yml">name: docs
on:
  push:
    branches:
      - docs
jobs:
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build documentation
        run: # &lt;insert your favourite ssg build command&gt;
      - name: Install Morsels
        run: cargo install morsels_indexer # or, using the binary release
      - name: Run Morsels
        run: morsels &lt;docs_build_folder&gt; &lt;docs_build_folder/morsels_output&gt; -c &lt;morsels_config_path&gt;
      - name: Deploy to github pages üöÄ
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages
          folder: &lt;docs_build_folder&gt;
</code></pre>
<h2 id="custom-data-formats-non-html"><a class="header" href="#custom-data-formats-non-html">Custom Data Formats (non-HTML)</a></h2>
<p>Some use cases may not always have HTML files readily available (e.g. pure client-side rendered projects).</p>
<p>In such cases, morsels also supports <code>.json</code> and <code>.csv</code> files, which is covered in greater detail later under <a href="./indexer_configuration.html">indexer configuration</a>.</p>
<p>Another simpler (but likely slow) alternative you could consider specifically for client-side rendered projects is to display the page in a headless browser, then index said HTML file.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="search-configuration"><a class="header" href="#search-configuration">Search Configuration</a></h1>
<p>All search related options can be provided through the <code>initMorsels</code> function, exposed by <code>@morsels/search-ui</code>.</p>
<p>There are 2 categories of options, the first being related to internal search library functionalities, and the second the user interface.</p>
<hr />
<h2 id="forenote-on-mobile-device-detection"><a class="header" href="#forenote-on-mobile-device-detection">Forenote on Mobile Device Detection</a></h2>
<p>Note that some options in both the search library and UI are (by default) tuned based on whether the client is a ‚Äúmobile device‚Äù:</p>
<ul>
<li>Query term proximity ranking is disabled</li>
<li>The fullscreen version of the user interface is used for <code>mode='auto'</code> (see <a href="search_configuration.html#ui-mode">UI Mode</a>)</li>
</ul>
<p>Overrides and the process of this detection is configurable, and will be covered later.</p>
<hr />
<h2 id="search-ui-options"><a class="header" href="#search-ui-options">Search UI Options</a></h2>
<p>Search UI options are organised under the <code>uiOptions</code> key:</p>
<pre><code class="language-ts">initMorsels({
    uiOptions: {
        // ... options go here ...
    }
})
</code></pre>
<p>For brevity, this page covers only a subset of the most important options.</p>
<p>The subsequent <a href="./search_configuration_renderers.html">sub-chapter</a> provides a few more APIs to customise the HTML output. If you have a configuration use case that cannot be achieved without these APIs, and you think should be included as a simpler configuration option here, feel free to raise a feature request!</p>
<h3 id="input-element"><a class="header" href="#input-element">Input Element</a></h3>
<table><thead><tr><th>Option</th><th>Default Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>input</code></td><td><code>'morsels-search'</code></td><td><code>id</code> of the input element or a HTML element reference</td></tr>
<tr><td><code>inputDebounce</code></td><td><code>100</code></td><td>debounce time of keystrokes to the input element</td></tr>
<tr><td><code>preprocessQuery</code></td><td><code>(q) =&gt; q</code></td><td>any function for preprocessing the query. Can be used to add a <a href="./search_features.html#field-search">field filter</a> for example.</td></tr>
</tbody></table>
<p>The <code>input</code> element is the most important option, and is required in most cases. Its purpose varies depending on the <code>mode</code> specified below.</p>
<h3 id="ui-mode"><a class="header" href="#ui-mode">UI Mode</a></h3>
<p><code>mode = 'auto'</code></p>
<p>The search UI provides 4 main different behaviours.</p>
<p>To <strong>try the different modes out</strong>, head on over to the <a href="./getting_started_mdbook.html#preview">mdbook plugin</a> page, which provides various buttons for switching the modes in this documentation!</p>
<table><thead><tr><th>Mode</th><th>Details</th></tr></thead><tbody>
<tr><td><code>&quot;auto&quot;</code></td><td>This option is the <strong>default</strong>, and combines the <code>dropdown</code> and <code>fullscreen</code> options below. If a mobile device is detected as per the <a href="search_configuration.html#forenote-on-mobile-device-detection">earlier section</a>, the <code>fullscreen</code> mode is used. Otherwise, the <code>dropdown</code> mode is used.<br><br>An event handler is also attached that reruns this adjustment whenever the window is resized.</td></tr>
<tr><td><code>&quot;dropdown&quot;</code></td><td>This wraps the specified <code>input</code> element with a root container. Search results are placed in a <code>&lt;ul&gt;</code> container next to the input element.</td></tr>
<tr><td><code>&quot;fullscreen&quot;</code></td><td>This option creates a completely distinct root container (complete with its own input element, backdrop, close button, ‚Ä¶), and attaches it to the <code>&lt;body&gt;</code> element.<br><br>Under the default stylesheet, the user interface is fullscreen under <code>max-width: 1025px</code>, and takes up roughly 50% of the screen estate otherwise.<br><br>If the <code>input</code> element is specified, the interface is also shown whenever the <code>input</code> is focused.<br><br>Alternatively, the <code>showFullscreen</code> and <code>hideFullscreen</code> functions returned by the <code>initMorsels</code> call can be used to toggle the UI programatically. This is also <em>the only use case you would not need to specify the <code>input</code> element</em>.</td></tr>
<tr><td><code>&quot;target&quot;</code></td><td>This option is the most flexible, and is used by the mdbook plugin (by default) and this documentation. The <code>input</code> element must be specified, where keystroke event listeners are attached. No dom manipulation is performed unlike the <code>dropdown</code> or <code>auto</code> modes.<br><br>The search results are output to a custom <code>target</code> element of choice.</td></tr>
</tbody></table>
<h4 id="ui-mode-specific-options"><a class="header" href="#ui-mode-specific-options">UI Mode Specific Options</a></h4>
<p>There are also several options specific to each UI. Note that <code>dropdown</code> and <code>fullscreen</code> options are both applicable to the <code>auto</code> mode.</p>
<table><thead><tr><th>Mode</th><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td>all</td><td><code>label</code></td><td><code>'Search this site'</code></td><td>Accessibility label for the inputs and results listbox.</td></tr>
<tr><td><code>dropdown</code></td><td><code>dropdownAlignment</code></td><td><code>'bottom-end'</code></td><td><code>'bottom'</code> or <code>'bottom-start'</code> or <code>'bottom-end'</code>.<br><br>This is the side of the input element to align the dropdown results container and dropdown seperator against.<br><br>The alignment of the dropdown container will also be automatically flipped horizontally to ensure the most optimal placement (see <a href="https://floating-ui.com/docs/size#using-with-flip">floating-ui‚Äôs</a> docs for a demonstration).</td></tr>
<tr><td><code>fullscreen</code></td><td><code>fsContainer</code></td><td><code>&lt;body&gt;</code> element</td><td><code>id</code> of the element, or an element reference to attach the separate root container to.</td></tr>
<tr><td><code>fullscreen</code></td><td><code>fsPlaceholder</code></td><td><code>'Search this site...'</code></td><td>Placeholder of the input element in the fullscreen UI.</td></tr>
<tr><td><code>target</code></td><td><code>target</code></td><td><code>undefined</code></td><td><code>id</code> of the element, or an element reference to attach results to.<br><br>Required if using <code>mode='target'</code>.</td></tr>
</tbody></table>
<h4 id="manually-showing--hiding-the-fullscreen-ui"><a class="header" href="#manually-showing--hiding-the-fullscreen-ui">Manually Showing / Hiding the Fullscreen UI</a></h4>
<pre><code class="language-ts">const { showFullscreen, hideFullscreen } = initMorsels({ ... });
</code></pre>
<p>You may call the <code>showFullscreen()</code> function returned by the initMorsels call to programatically show the fullscreen search UI.</p>
<p>Correspondingly, the <code>hideFullscreen()</code> method hides the fullscreen interface, although, this shouldn‚Äôt be needed since a close button is available by default (the <kbd>Esc</kbd> key works too).</p>
<p>These methods can also be used under <code>mode=&quot;auto&quot;</code>.</p>
<h3 id="options-for-generating-result-previews"><a class="header" href="#options-for-generating-result-previews">Options for Generating Result Previews</a></h3>
<p>There are 3 ways to generate result previews of matched documents, the first of the below being the default.</p>
<p>Unless you have modified the default result renderer (covered in the next page on renderers), morsels also requires <strong>at least one</strong> of the <code>body</code> / <code>heading</code> / <code>title</code> fields. This is configured by default, and covered in the next section on indexing configuration in more detail.</p>
<h4 id="default-rendering-output--purpose"><a class="header" href="#default-rendering-output--purpose">Default Rendering Output / Purpose</a></h4>
<p>The default use case / result generation assumes the simple but common use case of linking to a source document (via an <code>&lt;a&gt;</code> tag). </p>
<p>Therefore, source documents are assumed to be <strong>available</strong> and <strong>linkable</strong> to. The url of this source document is <strong>either</strong>:</p>
<ol>
<li>
<p>The <code>sourceFilesUrl</code> option concatenated with the relative file path of the document at the time of indexing <strong>(default)</strong>.</p>
<blockquote>
<p>The relative file path is stored in the <code>_relative_fp</code> field, which is an internally generated field. Combining this with the base url (<code>sourceFilesUrl</code>) forms the full source document link.</p>
</blockquote>
</li>
<li>
<p>The <a href="./indexer/fields.html#default-fields-in-morselssearch-ui"><code>link</code> field</a>, a custom field that has to manually mapped from file data.</p>
</li>
</ol>
<p>The use of the default indexed fields in the UI is as shown in the following diagram, and will be covered in more detail in the chapter on <a href="./indexer/fields.html">fields</a>:</p>
<p><img src="./images/fields_annotated.png" alt="" /></p>
<p>Some indexer configuration <a href="./indexer/presets.html">presets</a> are available to help with switching between options 1 and 2 easily.</p>
<p>To generate alternative outputs for other use cases (e.g. buttons, perform some action), you will need to use option 3 below.</p>
<h4 id="1-from-source-documents"><a class="header" href="#1-from-source-documents">1. From Source Documents</a></h4>
<p>When option 2 below (field stores) is not configured or unavailable, morsels will attempt to <em>retrieve and reparse the source document and its fields</em> in order to generate result previews.</p>
<p>Note that this option is only applicable for indexed HTML, json, and txt files at this time.</p>
<p>As csv files are often used to hold multiple documents (and can therefore get very large), it is unsuitable to be used as a source for search result previews. In this case, options 2 or 3 can be used.</p>
<h4 id="2-from-field-stores-default"><a class="header" href="#2-from-field-stores-default">2. From Field Stores (default)</a></h4>
<p>Morsels is also able to generate result previews from its own json field stores generated at indexing time.</p>
<p>In order to specify what fields to store, and how to map file data to these fields, refer to the chapter on <a href="./indexer/fields.html">fields</a> under indexer configuration.</p>
<p>You may also wish to use this method even if source documents are available, if filesystem bloat isn‚Äôt too much of a concern. Apart from avoiding the additional http requests, the internal json field store comes packed in a format that is more performant to perform result preview generation on.</p>
<h4 id="3-alternative-rendering-outputs-advanced"><a class="header" href="#3-alternative-rendering-outputs-advanced">3. Alternative Rendering Outputs (advanced)</a></h4>
<p>It is also possible to create your own result <a href="./search_configuration_renderers.html">renderer</a> to, for example:</p>
<ul>
<li>attach an event handler to call a function when a user clicks the result preview</li>
<li>retrieve and generate result previews from some other API.</li>
</ul>
<p>Nevertheless, the section <a href="search_configuration.html#from-field-stores">‚ÄúFrom Field Stores‚Äù</a> above would still be relevant as it provides the basis for retrieving a document‚Äôs fields (e.g. a document id with which to call an API).</p>
<p>This is covered in more detail in the next page.</p>
<h3 id="results-per-page"><a class="header" href="#results-per-page">Results Per Page</a></h3>
<p><code>resultsPerPage = 8</code></p>
<p>In all UI modes, an infinite scrolling intersection observer is attached to the last search result. When triggered, search result previews are fetched and generated for a number of results only.</p>
<p>Lowering this value can have a noticeable performance improvement on result generation, as more <code>.html / .json</code> files have to be retrieved on-the-fly, parsed, and processed. This is especially true if using option 1 above.</p>
<h3 id="changing-the-mobile-device-detection-method"><a class="header" href="#changing-the-mobile-device-detection-method">Changing The Mobile Device Detection Method</a></h3>
<p>The mobile device check is done through a simple <code>window.matchMedia('only screen and (max-width: 1024px)').matches</code> query at initialisation time, which may not be robust enough for your use case.</p>
<p>An override may be provided through the <code>isMobileDevice</code> option shown below, which is simply a function returning a boolean.</p>
<pre><code class="language-ts">initMorsels({
    isMobileDevice: () =&gt; true,
})
</code></pre>
<hr />
<h2 id="search-library-options"><a class="header" href="#search-library-options">Search Library Options</a></h2>
<p>The options for the search library are rather brief, and can be summarised in this snippet:</p>
<pre><code class="language-js">initMorsels({
    // Options belonging to @morsels/search-lib, the search library package
    searcherOptions: {
        // Base url of output directory that the cli tool generated
        url: 'http://192.168.10.132:3000/output/',
        
        // Maximum number of terms for query term expansion
        numberOfExpandedTerms: 3,
        
        // Override for using query term proximity ranking or not.
        // Disabled for mobile devices by default
        useQueryTermProximity: true,

        // Whether to retrieve all field stores on initialisation
        // (see chapter &quot;Tradeoffs&quot; for more details)
        cacheAllFieldStores: true,

        // The maximum number of results to retrieve (unlimited if null).
        resultLimit: null,
    },
});
</code></pre>
<h3 id="automatic-term-expansion"><a class="header" href="#automatic-term-expansion">Automatic Term Expansion</a></h3>
<p><code>numberOfExpandedTerms</code></p>
<p>Stemming is turned off in the default <a href="./indexer/language.html#ascii-tokenizer">language module</a>. This does mean a bigger dictionary (but not too much usually), and lower recall, but much more precise searches.</p>
<p>To provide a compromise for recall, query terms that are similar to the searched term are added to the query, although with a lower weight.</p>
<p>For all <a href="./indexer/language.html">language modules</a> available currently, this is only applied for the last query term, and if the query string does not end with a whitespace. An implicit wildcard (suffix) search is performed on this term. (similar to Algolia Docsearch‚Äôs behaviour)</p>
<h3 id="term-proximity-ranking"><a class="header" href="#term-proximity-ranking">Term Proximity Ranking</a></h3>
<p><code>useQueryTermProximity</code></p>
<p>If positions are indexed, document scores are also scaled by how close query expressions or terms are to each other.
This may be costly for mobile devices however, and is disabled by default in such cases.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="themes"><a class="header" href="#themes">Themes</a></h1>
<p>Morsels provides 2 built-in themes by default, which correspond to the 2 stylesheets in the <a href="https://github.com/ang-zeyu/morsels/releases">releases</a>.</p>
<p>These 2 stylesheets also expose a wide range of css variables which you can alter as needed.</p>
<p>Head on over to the demo site <a href="https://ang-zeyu.github.io/morsels-demo-1/">here</a> to try them out!</p>
<h2 id="light"><a class="header" href="#light">Light</a></h2>
<h3 id="cdn-link"><a class="header" href="#cdn-link">CDN link</a></h3>
<pre><code class="language-html">&lt;!-- Replace &quot;v0.1.0&quot; as appropriate --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.1.0/packages/search-ui/dist/search-ui-light.css&quot; /&gt;
</code></pre>
<h3 id="preview-1"><a class="header" href="#preview-1">Preview</a></h3>
<style>
.image-container {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}

@media screen and (max-width: 1129px) {
    .image-container > img:first-child {
        margin-bottom: 10px;
        min-width: 300px;
        max-width: 500px;
    }

    .image-container > img:last-child {
        width: 300px;
    }
}

@media screen and (min-width: 1130px) {
    .image-container > img:first-child {
        margin-right: 10px;
        height: 440px;
    }

    .image-container > img:last-child {
        height: 440px;
    }
}
</style>
<div class="image-container">
<img src="./images/light-theme.png" alt="Preview of light theme">
<img src="./images/light-theme-fullscreen.png" alt="Preview of light theme (fullscreen)">
</div>
<h2 id="dark"><a class="header" href="#dark">Dark</a></h2>
<h3 id="cdn-link-1"><a class="header" href="#cdn-link-1">CDN link</a></h3>
<pre><code class="language-html">&lt;!-- Replace &quot;v0.1.0&quot; as appropriate --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.1.0/packages/search-ui/dist/search-ui-dark.css&quot; /&gt;
</code></pre>
<h3 id="preview-2"><a class="header" href="#preview-2">Preview</a></h3>
<div class="image-container">
<img src="./images/dark-theme.png" alt="Preview of dark theme">
<img src="./images/dark-theme-fullscreen.png" alt="Preview of dark theme (fullscreen)">
</div>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="altering-html-outputs"><a class="header" href="#altering-html-outputs">Altering HTML Outputs</a></h1>
<style>
    .alert-warning {
        color: #856404;
        background-color: #fff3cd;
        border-color: #ffeeba;
    }
    .alert {
        position: relative;
        padding: 0.75rem 1.25rem;
        margin-bottom: 1rem;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }
</style>
<blockquote>
<p>This page covers some APIs that allow you to customise some small parts of the HTML output structure, if required.</p>
</blockquote>
<p>Some use cases for this include:</p>
<ul>
<li>The default HTML structure is not sufficient for your styling needs</li>
<li>You need to attach additional event listeners to elements</li>
<li>You want to override or insert additional content sourced from custom fields / static content (e.g. a footer)</li>
<li>You want to change the <a href="./search_configuration.html#default-rendering-output--purpose">default use case</a> of following through on a result preview to its source document entirely</li>
</ul>
<blockquote>
<p>üí° If you only need to style the dropdown or search popup, you can include your own css file to do so <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/styles/search.css">and / or override the variables</a> exposed by the default css bundle.</p>
</blockquote>
<p>These API options are similarly specified under the <code>uiOptions</code> key of the root configuration object.</p>
<pre><code class="language-ts">initMorsels({
    uiOptions: {
        // ...
    }
});
</code></pre>
<h2 id="the-h-function"><a class="header" href="#the-h-function">The <code>h</code> function</a></h2>
<p><code>h</code></p>
<p>Almost all renderer functions are passed a <code>h</code> function. This is an <em>optional</em> helper function you may use to create elements.</p>
<p>The method signature is as such:</p>
<pre><code class="language-ts">export type CreateElement = (
  // Element name
  name: string,

  // Element attribute map
  attrs: { [attrName: string]: string },

  /*
   Child elements (HTMLElement) OR text nodes (just put the string)
   string parameters utilise .textContent,
   so you don't have to worry about escaping potentially malicious content
  */
  ...children: (string | HTMLElement)[]
) =&gt; HTMLElement;
</code></pre>
<h2 id="passing-custom-options"><a class="header" href="#passing-custom-options">Passing Custom Options</a></h2>
<p><code>opts</code></p>
<p>All renderer functions are also passed an <code>opts</code> parameter. This is the original input object that you provided to the <code>initMorsels</code> call, with default parameters populated at this point.</p>
<pre><code class="language-ts">opts = export interface SearchUiOptions {
  searcherOptions?: SearcherOptions,
  uiOptions?: UiOptions,
  isMobileDevice: () =&gt; boolean,
  otherOptions: any
}
</code></pre>
<p>If you need to include some custom options (e.g. an API base url), you can use the <code>otherOptions</code> key, which is guaranteed to be untouched by morsels.</p>
<h3 id="target"><a class="header" href="#target">Target</a></h3>
<p>There is no root element for the target, as it is specified by the <code>target</code> option. The equivalent of the <code>target</code> element would be the <code>listContainer</code> element for the dropdown / fullscreen versions  above.</p>
<h2 id="miscellaneous-renderers"><a class="header" href="#miscellaneous-renderers">Miscellaneous Renderers</a></h2>
<table><thead><tr><th>Function</th><th>Return</th><th>Description</th></tr></thead><tbody>
<tr><td><code>errorRender(h, opts)</code></td><td><code>HTMLElement</code></td><td>Renders the element attached under the <code>listContainer</code> (or the target element when using <code>mode = 'target'</code>) when an unexpected error occurs.</td></tr>
<tr><td><code>noResultsRender(h, opts)</code></td><td><code>HTMLElement</code></td><td>This API renders the element attached under the <code>listContainer</code> (or the target element when using <code>mode = 'target'</code>) when there are no results found for a given query. ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†</td></tr>
<tr><td><code>loadingIndicatorRender(h, opts, isInitialising: boolean, wasResultsBlank: boolean)</code></td><td><code>HTMLElement</code></td><td>This API renders the loading indicator attached under the <code>listContainer</code> when running a query.<br><br>While the search library is doing initialising work, the <code>isInitialising</code> parameter will be <code>true</code>. <br><br>The <code>wasResultsBlank</code> boolean is <code>true</code> when there are no results yet. You may use this parameter to change the look of the indicator in subsequent queries. In the default design, this corresponds to the spinning indicator on the top right of the search box.</td></tr>
<tr><td><code>termInfoRender(h, opts, queryParts: QueryPart[])</code></td><td><code>HTMLElement[]</code></td><td>This API renders element(s) attached under the <code>listContainer</code> related to the searched terms, and is blank by default.<br><br>This can be used to render messages like ‚Äú<em>Did you mean <u>spelling</u>?</em> ‚Äú.</td></tr>
<tr><td><code>fsBlankRender(h, opts)</code><br><br>( <code>mode='fullscreen'</code> only )</td><td><code>HTMLElement</code></td><td>This API renders the element attached under the <code>listContainer</code> when the search box is empty for the fullscreen UI.<br><br>This contrasts with the dropdown UI which is hidden in such a case.</td></tr>
</tbody></table>
<h3 id="queryparts-parameter"><a class="header" href="#queryparts-parameter"><code>queryParts</code> Parameter</a></h3>
<p>This parameter to the <code>termInfoRender</code> function is the parsed structure of the input query string.</p>
<p>Its interface is as follows:</p>
<pre><code class="language-ts">export interface QueryPart {
  partType: 'TERM' | 'PHRASE' | 'BRACKET' | 'AND' | 'NOT';

  // Raw, original term(s) contained, if any of the below 3 operations were applied
  originalTerms?: string[];

  isCorrected?: boolean;        // did this query part undergo spelling correction?
  isStopWordRemoved?: boolean;  // did this query part undergo stop word removal?
  isExpanded?: boolean;         // is this an added / expanded term?

  shouldExpand?: boolean;       // was this term a source for query term expansion?

  fieldName?: string;           // was a field filter applied?

  // Spelling corrected / Expanded / Stop word removed result
  terms?: string[];

  children?: QueryPart[];
}
</code></pre>
<h2 id="rendering-search-results"><a class="header" href="#rendering-search-results">Rendering Search Results</a></h2>
<p>The below 2 remaining <em>sets</em> of APIs render the results for all document matches, and are <em>mutually exclusive</em> in that the first, simpler set of APIs are ‚Äúbuilding blocks‚Äù of the second (which only has one available API). Reconfiguring the second API would invalidate any changes to the first.</p>
<h3 id="1-rendering-a-single-result"><a class="header" href="#1-rendering-a-single-result">1. Rendering a Single Result</a></h3>
<p>The renderers under this key are grouped under <code>uiOptions.resultsRenderOpts</code> (instead of <code>uiOptions.XXX</code>).</p>
<p>These APIs are more suited for performing smaller modifications for the default use case, for example, displaying an additionally indexed field (e.g. an icon).</p>
<div style="height:1px"></div>
<p><code>listItemRender(h, opts, fullLink, resultTitle, resultHeadingsAndTexts, fields): HTMLElement</code></p>
<p>This API renders the result for a single document match.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><code>fullLink</code></td><td>full resource link of the document</td></tr>
<tr><td><code>resultTitle</code></td><td>the first extracted <code>title</code> field of the document, if any</td></tr>
<tr><td><code>resultHeadingsAndTexts</code></td><td>An array of <code>string</code> or <code>HTMLElement</code> intended to be used as the last parameter of <code>h</code>.<br><br>This contains the highlighted heading-body pair matches, or body-only matches rendered from <code>headingBodyRender</code> and <code>bodyOnlyRender</code> further below.</td></tr>
<tr><td><code>fields</code></td><td>All stored fields for the document, as positioned <code>[fieldName, fieldValue]</code> pairs. Useful if adding additional fields.</td></tr>
</tbody></table>
<p>The following example shows the default implementation, and how to add an additional field, <code>subtitle</code>, to each result.</p>
<pre><code class="language-ts">const subTitleField = fields.find(field =&gt; field[0] === 'subtitle');

const linkEl = h(
  'a', { class: 'morsels-link' },
  h('div', { class: 'morsels-title' }, title,
    h('div', { class: 'morsels-subtitle' }, (subTitleField &amp;&amp; subTitleField[1]) || '')
  ),
  ...bodies
);

if (fullLink) {
  linkEl.setAttribute('href', fullLink);
}

return h(
  'li', { class: 'morsels-list-item' },
  linkEl,
);
</code></pre>
<h4 id="11-listitemrender-supporting-apis"><a class="header" href="#11-listitemrender-supporting-apis">1.1 <code>listItemRender</code> supporting APIs</a></h4>
<p>The remaining 3 APIs below are building blocks of <code>listItemRender</code>, responsible for generating its <code>resultTitle</code> and <code>resultHeadingsAndTexts</code> parameters.</p>
<pre><code class="language-ts">interface SearchUiRenderOptions {
  // Renders a &quot;heading&quot; field,
  // along with the highlighted &quot;body&quot; fields that follow it (in document order)
  headingBodyRender?: (
    h: CreateElement,

    // The highlighted elements under .morsels-heading. Intended to be used with the 'h' function.
    headingHighlights: (HTMLElement | string)[],    

    // The highlighted elements under .morsels-body. Intended to be used with the 'h' function.
    bodyHighlights: (HTMLElement | string)[], 

    // Url of the document + The matching heading's id, if any
    href?: string                             
  ) =&gt; HTMLElement,


  // Renders highlighted &quot;body&quot; fields without a heading preceding it
  bodyOnlyRender?: (
    h: CreateElement,

    // The highlighted elements under .morsels-body. Intended to be used with the 'h' function.
    bodyHighlights: (HTMLElement | string)[], 
  ) =&gt; HTMLElement,


  highlightRender?: (
    h: CreateElement,

    // matched term
    matchedPart: string,                      
  ) =&gt; HTMLElement,
}
</code></pre>
<h3 id="2-rendering-all-results"><a class="header" href="#2-rendering-all-results">2. Rendering All Results</a></h3>
<p><code>async resultsRender(h, opts, config, results, query): Promise&lt;HTMLElement[]&gt;</code></p>
<p>This API renders the results for <em>all</em> document matches.</p>
<p>Some examples use cases are:</p>
<ul>
<li>Altering the html output structure substantially (e.g. displaying results in a tabular form)</li>
<li>Calling external API calls to retrieve additional info for generating result previews.
<ul>
<li>For this reason, this is also the only <code>async</code> API</li>
</ul>
</li>
</ul>
<p>For example, the default implementation does the following:</p>
<ol>
<li>Check the <code>config.fieldInfos</code> if any of <code>body / title / heading</code> fields are stored by the indexer to generate result previews. (Skip to 3 if present)</li>
<li>If the document has the internal <code>_relative_fp</code> field and <code>sourceFilesUrl</code> is specified, retrieve the original document (<code>.html</code> or <code>.json</code>), and transform it into the same format as that generated by the indexer.</li>
<li>Transform and highlight the field stores using the <code>listItemRender</code> set of APIs below.</li>
</ol>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><code>config</code></td><td>This is the <em>indexing</em> configuration.</td></tr>
<tr><td><code>query</code></td><td>a <code>Query</code> object. <code>query.searchedTerms</code> contains a nested array of grouped terms that were searched. Groupings contain raw terms and their spelling corrections (if any).</td></tr>
<tr><td><code>results</code></td><td>an array of <code>Result</code> objects.<br><br>This class exposes the <code>getStorageWithFieldNames(): [string, string][]</code> method which returns an array of <code>[field name, field content]</code> pairs.</td></tr>
</tbody></table>
<p>You may also refer to the default implementation <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/searchResultTransform.ts#L369">here</a> to get an idea of how to use the API.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="indexer-configuration"><a class="header" href="#indexer-configuration">Indexer Configuration</a></h1>
<p>All indexer configurations are sourced from a json file. By default, the cli tool looks for <code>morsels_config.json</code> in the source folder (first argument specified in the command).</p>
<p>You can run the cli command with the <code>--config-init</code> option to initialise the full, default configuration file in the source folder. As the file generated from this option is rather verbose, you could also instead override the necessary properties as covered in the subsequent sections.</p>
<h2 id="full-example"><a class="header" href="#full-example">Full Example</a></h2>
<p>A typical full configuration file looks something like this:</p>
<pre><code class="language-json">{
  &quot;preset&quot;: &quot;small&quot;,
  &quot;fields_config&quot;: {
    &quot;field_store_block_size&quot;: 4294967295,
    &quot;num_stores_per_dir&quot;: 1000,
    &quot;cache_all_field_stores&quot;: true,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;title&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 2.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.15
      },
      {
        &quot;name&quot;: &quot;heading&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 1.5,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.25
      },
      {
        &quot;name&quot;: &quot;body&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 1.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;headingLink&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;_relative_fp&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      }
    ]
  },
  &quot;lang_config&quot;: {
    &quot;lang&quot;: &quot;ascii&quot;,
    &quot;options&quot;: null
  },
  &quot;indexing_config&quot;: {
    &quot;num_docs_per_block&quot;: 1000,
    &quot;pl_limit&quot;: 0,
    &quot;pl_cache_threshold&quot;: 0,
    &quot;exclude&quot;: [
      &quot;morsels_config.json&quot;
    ],
    &quot;loader_configs&quot;: {
      &quot;HtmlLoader&quot;: {
        &quot;exclude_selectors&quot;: [
          &quot;script,style,pre&quot;
        ],
        &quot;selectors&quot;: [
          {
            &quot;attr_map&quot;: {},
            &quot;field_name&quot;: &quot;title&quot;,
            &quot;selector&quot;: &quot;title&quot;
          },
          {
            &quot;attr_map&quot;: {},
            &quot;field_name&quot;: &quot;body&quot;,
            &quot;selector&quot;: &quot;body&quot;
          },
          {
            &quot;attr_map&quot;: {
              &quot;id&quot;: &quot;headingLink&quot;
            },
            &quot;field_name&quot;: &quot;heading&quot;,
            &quot;selector&quot;: &quot;h1,h2,h3,h4,h5,h6&quot;
          }
        ],
        &quot;type&quot;: &quot;HtmlLoader&quot;
      }
    },
    &quot;num_pls_per_dir&quot;: 1000,
    &quot;with_positions&quot;: false
  }
}
</code></pre>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="fields_config"><a class="header" href="#fields_config"><code>fields_config</code></a></h1>
<p>The first step to indexing any documents is defining the fields to store.</p>
<p>The default configurations are as follows, already setup for interfacing with the <code>@morsels/search-ui</code> package.</p>
<p>If you are using morsels‚Äô search UI <strong>as-is</strong> (e.g. not adding additional fields to display), you can likely skip configuring <code>fields_config.fields</code>.</p>
<p>You may want to briefly take note of the other parameters under <code>fields_config</code> however, which can be used to adjust response times / file bloat. The possible adjustments are discussed later in <a href="indexer/../tradeoffs.html">Tradeoffs</a>.</p>
<pre><code class="language-json">{
  &quot;fields_config&quot;: {
    &quot;cache_all_field_stores&quot;: true,
    &quot;field_store_block_size&quot;: 10000,
    &quot;num_stores_per_dir&quot;: 1000,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;title&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 2.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.15
      },
      {
        &quot;name&quot;: &quot;heading&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 1.5,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.25
      },
      {
        &quot;name&quot;: &quot;body&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 1.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;headingLink&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      // Internal, hardcoded field (see &quot;Special Fields&quot;)
      {
        &quot;name&quot;: &quot;_relative_fp&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      }
    ]
  }
}
</code></pre>
<p><strong><code>field_store_block_size</code>, <code>num_stores_per_dir</code>, and <code>do_store</code></strong></p>
<p>Morsels stores fields that have <code>do_store: true</code> specified in the field configuration into a json file in the output folder.</p>
<p>At search time, the fields saved in this manner from the json files are retrieved for result preview generation.</p>
<p>The <code>field_store_block_size</code> parameter controls how many documents to store in one such json file. Batching multiple files together if the fields stored are small can lead to less files and better browser caching. The <code>num_stores_per_dir</code> parameter controls how many json files should be stored together in one directory.</p>
<blockquote>
<p>‚ö†Ô∏è Ensure <code>field_store_block_size</code> is a clean multiple or divisor of the <code>num_docs_per_block</code> parameter elaborated under <a href="indexer/./indexing.html">indexing</a> later.<br>
This is a rather arbitiary limitation chosen to reduce the field store indexing scheme complexity,
but should work well enough for most use cases.</p>
</blockquote>
<p><strong><code>cache_all_field_stores</code></strong></p>
<p>This is the same as the configuration option under <a href="indexer/../search_configuration.html#search-library-options">search configuration</a>.
If both are specified, the value specified in the <code>initMorsels</code> call will take priority.</p>
<p>All fields specified with <code>do_store=true</code> would be cached up front on initialisation of the search library.</p>
<p>Its usage alongside other options is discussed in more detail under the chapter <a href="indexer/../tradeoffs.html">Tradeoffs</a>.</p>
<p><strong><code>weight</code></strong></p>
<p>This parameter is a boost / penalty multiplied to a individual field‚Äôs score.</p>
<p>Specifying <code>0.0</code> will result in the field not being indexed (although, it can still be stored for retrieval using <code>do_store</code>).</p>
<p><strong><code>k</code> &amp; <code>b</code></strong></p>
<p>These are Okapi BM25 model parameters. The following <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/pluggable-similarites.html#bm25-tunability">article</a> provides a good overview on how to configure these if the defaults are unsuitable for your use case.</p>
<h2 id="default-fields-in-morselssearch-ui"><a class="header" href="#default-fields-in-morselssearch-ui">Default Fields in <code>@morsels/search-ui</code></a></h2>
<p>The functions of the default fields for the user interface are as follows:</p>
<img alt="annotation for fields" src="indexer/../images/fields_annotated.png" />
<ul>
<li><code>title</code>: This is the header for a single document match. </li>
<li><code>heading</code>: These are section headers which appear on the left of corresponding <code>body</code> fields. THey are sourced from <code>&lt;h1-6&gt;</code> tags by default.</li>
<li><code>headingLink</code>: These are the <code>id</code> attributes of corresponding <code>&lt;h1-6&gt;</code> tags. If available, an <code>#anchor</code> is attached to the linked document for the particular heading</li>
<li><code>body</code>: This field is the text that appears to the right of headings (or on its own if there is no corresponding heading).</li>
<li><code>_relative_fp</code> <strong>or</strong> <code>link</code>: If the <code>title</code> field is missing for any document, this field takes its place in the header. It is also used to link to the source document (in the <code>&lt;a /&gt;</code> tag) or for generating result previews (more <a href="indexer/../search_configuration.html#default-rendering-output--purpose">here</a>).
<ul>
<li>Note: The <code>link</code> field is not setup by default; The combination of <code>sourceFilesUrl</code> + <code>_relative_fp</code> serves the same purpose. The <code>link</code> field serves to accomodate more custom use cases (e.g. linking to another site, or linking to a HTML page by indexing a json document).</li>
</ul>
</li>
</ul>
<h2 id="mapping-file-data-to-fields"><a class="header" href="#mapping-file-data-to-fields">Mapping File Data to Fields</a></h2>
<p>Defining fields is all good, but you may also need a way to map custom-formatted file data to each of these fields if the default mappings are insufficient. This is discussed later under <a href="indexer/./indexing.html#mapping-file-data-to-fields-loader_configs">indexing</a>.</p>
<p>The exception are ‚Äúspecial‚Äù fields below, which sources data from elsewhere.</p>
<h3 id="special-fields"><a class="header" href="#special-fields">Special Fields</a></h3>
<p><strong><code>_relative_fp</code></strong></p>
<p>This is a ‚Äúhardcoded‚Äù field generated by the indexer, in that its value is fixed as the relative file path from your source folder path to the file.</p>
<p>It is included in the default configuration to allow <code>@morsels/search-ui</code> to retrieve the source file for result preview generation, and to link to the document itself (via an <code>&lt;a&gt;&lt;/a&gt;</code> tag). You may refer back to <a href="indexer/../search_configuration.html#options-for-generating-result-previews">this section</a> for more details.</p>
<p>If this is removed, this field simply won‚Äôt be indexed nor stored.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="lang_config"><a class="header" href="#lang_config"><code>lang_config</code></a></h1>
<p>The snippet below shows the default values for language configuration. The key controlling the main tokenizer module to use is <code>lang</code>, while the <code>options</code> key supplies tokenization options unique to each module.</p>
<blockquote>
<p>These options are also applied to the search user interface and library where appropriate, and is stored in a metadata file in the index output directory.</p>
</blockquote>
<pre><code class="language-json">{
  &quot;lang_config&quot;: {
    &quot;lang&quot;: &quot;ascii&quot;,
    &quot;options&quot;: {
      // Language dependent
    }
  }
}
</code></pre>
<p>Only the following 3 tokenizers are supported for now:</p>
<h2 id="ascii-tokenizer"><a class="header" href="#ascii-tokenizer">Ascii Tokenizer</a></h2>
<p>The default tokenizer splits on sentences, then whitespaces to obtain tokens.</p>
<p>An <a href="https://github.com/tantivy-search/tantivy/blob/main/src/tokenizer/ascii_folding_filter.rs">asciiFoldingFilter</a> is then applied to these tokens, followed by punctuation and non-word boundary removal.</p>
<pre><code class="language-json">{
  &quot;lang&quot;: &quot;ascii&quot;,
  &quot;options&quot;: {
    &quot;stop_words&quot;: [
      &quot;a&quot;, &quot;an&quot;, &quot;and&quot;, &quot;are&quot;, &quot;as&quot;, &quot;at&quot;, &quot;be&quot;, &quot;but&quot;, &quot;by&quot;, &quot;for&quot;,
      &quot;if&quot;, &quot;in&quot;, &quot;into&quot;, &quot;is&quot;, &quot;it&quot;, &quot;no&quot;, &quot;not&quot;, &quot;of&quot;, &quot;on&quot;, &quot;or&quot;,
      &quot;such&quot;, &quot;that&quot;, &quot;the&quot;, &quot;their&quot;, &quot;then&quot;, &quot;there&quot;, &quot;these&quot;,
      &quot;they&quot;, &quot;this&quot;, &quot;to&quot;, &quot;was&quot;, &quot;will&quot;, &quot;with&quot;
    ],
    &quot;ignore_stop_words&quot;: true,

    // Hard limit = 250
    &quot;max_term_len&quot;: 80
  }
}
</code></pre>
<h2 id="latin-tokenizer"><a class="header" href="#latin-tokenizer">Latin Tokenizer</a></h2>
<p>This is essentially the same as the ascii tokenizer, but adds a <code>stemmer</code> option.</p>
<pre><code class="language-json">{
  &quot;lang&quot;: &quot;latin&quot;,
  &quot;options&quot;: {
    // ----------------------------------
    // Ascii Tokenizer options also apply
    // ...
    // ----------------------------------

    // Any of the languages here
    // https://docs.rs/rust-stemmers/1.2.0/rust_stemmers/enum.Algorithm.html
    // For example, &quot;english&quot;
    &quot;stemmer&quot;: &quot;english&quot;
  }
}
</code></pre>
<p>It is separated from the ascii tokenizer to reduce binary size (about ~<code>220KB</code> savings before gzip).</p>
<h2 id="chinese-tokenizer"><a class="header" href="#chinese-tokenizer">Chinese Tokenizer</a></h2>
<p>A basic <code>chinese</code> tokenizer based on <a href="https://github.com/messense/jieba-rs">jieba-rs</a> is also available, although, it hasn‚Äôt been as extensively tested. Use at your own discretion!</p>
<p>This tokenizer applies jieba‚Äôs <code>cut</code> method to obtain various tokens, then applies a punctuation filter to these tokens. Thereafter, tokens are grouped into sentences.</p>
<pre><code class="language-json">{
  &quot;lang&quot;: &quot;chinese&quot;,
  &quot;options&quot;: {
    &quot;stop_words&quot;: [],
    &quot;ignore_stop_words&quot;: true
  }
}
</code></pre>
<h2 id="stop-words"><a class="header" href="#stop-words">Stop Words</a></h2>
<p>All tokenizers support forcibly removing stop words using the <code>ignore_stop_words</code> option, should you wish to keep the index size down.</p>
<p>Keeping stop words enables the following:</p>
<ul>
<li>Processing phrase queries such as <code>&quot;for tomorrow&quot;</code></li>
<li>Boolean queries of stop words (e.g. <code>if AND forecast AND sunny</code>)</li>
<li>More accurate ranking for free text queries, which employ an inverse document frequency heuristic to prune stop words only when their impact is small (far from always the case!). </li>
</ul>
<blockquote>
<p>If you are using any of the 2 <code>large</code> presets covered in <a href="indexer/./presets.html">section 5.4</a>, which generates a sharded index, stop words are not removed by default. This is because these options split up the index, which means that such commonly occuring words are likely to be separately placed into one file. (and never requested until necessary)</p>
</blockquote>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="indexing_config"><a class="header" href="#indexing_config"><code>indexing_config</code></a></h1>
<p>The configurations in this section mainly specify <strong>how (mapping file contents to fields)</strong> and <strong>which</strong> files to index.</p>
<p>All configurations are optional, save for the <code>loader_configs</code> key. The cli tool will simply do nothing if no loaders are specified.</p>
<p>The snippet below shows the default values:</p>
<pre><code class="language-json">{
  &quot;indexing_config&quot;: {
    &quot;num_threads&quot;: &lt;number of physical cpus&gt; - 1,

    &quot;num_docs_per_block&quot;: 1000,

    &quot;exclude&quot;: [
      &quot;morsels_config.json&quot;
    ],

    &quot;loader_configs&quot;: {
      &quot;HtmlLoader&quot;: {}
    },
    
    &quot;pl_limit&quot;: 4294967295,

    &quot;pl_cache_threshold&quot;: 0,

    &quot;num_pls_per_dir&quot;: 1000,

    &quot;with_positions&quot;: false
  }
}
</code></pre>
<h2 id="mapping-file-data-to-fields-1"><a class="header" href="#mapping-file-data-to-fields-1">Mapping File Data to Fields</a></h2>
<p><strong><code>loader_configs</code></strong></p>
<p>The indexer is able to handle data from HTML, json, csv or txt files. Support for each file type is provided by a <code>Loader</code> abstraction.</p>
<p>You may configure loaders by <strong>including them under the <code>loader_configs</code> key</strong>, with any applicable options.</p>
<br>
<p><strong><code>loader_configs.HtmlLoader</code></strong></p>
<pre><code class="language-json">&quot;loader_configs&quot;: {
  &quot;HtmlLoader&quot;: {
    // list of selectors to exclude from indexing
    &quot;exclude_selectors&quot;: [
      &quot;script,style,pre&quot;
    ],
    &quot;selectors&quot;: [
      {
        &quot;attr_map&quot;: {},
        &quot;field_name&quot;: &quot;title&quot;,
        &quot;selector&quot;: &quot;title&quot;
      },
      {
        &quot;attr_map&quot;: {},
        &quot;field_name&quot;: &quot;body&quot;,
        &quot;selector&quot;: &quot;body&quot;
      },
      {
        &quot;attr_map&quot;: {
          &quot;id&quot;: &quot;headingLink&quot; // &quot;store the id attribute under headingLink&quot;
        },
        &quot;field_name&quot;: &quot;heading&quot;,
        &quot;selector&quot;: &quot;h1,h2,h3,h4,h5,h6&quot;
      }
    ]
  }
}
</code></pre>
<p>The html loader traverses the document depth-first, in the order text nodes and attributes appear.</p>
<p>At each element, it checks if any of the selectors under the <code>selectors.selector</code> key matches the element. If so, all descendants (elements, text) under this element will then be indexed under the field specified by the corresponding <code>field_name</code>. If another of the element‚Äôs descendants matched a different selector however, the configuration is then overwritten for that descendant (and its descendants).</p>
<p>The <code>attr_map</code> option allows indexing attributes of each element under fields as well.</p>
<br>
<p><strong><code>loader_configs.JsonLoader</code></strong></p>
<pre><code class="language-json">&quot;loader_configs&quot;: {
  &quot;JsonLoader&quot;: {
    &quot;field_map&quot;: {
      &quot;chapter_text&quot;: &quot;body&quot;,
      &quot;book_link&quot;: &quot;link&quot;,
      &quot;chapter_title&quot;: &quot;title&quot;
    },
    // Order in which to index the keys of the json {} document
    &quot;field_order&quot;: [
      &quot;book_link&quot;,
      &quot;chapter_title&quot;,
      &quot;chapter_text&quot;
    ]
  }
}
</code></pre>
<p>Json files can also be indexed. The <code>field_map</code> key must be specified, which contains a mapping of <strong>json key -&gt; field name</strong>.
The <code>field_order</code> array controls the order in which these fields are indexed, which can have a minor influence on <a href="indexer/../search_features.html#ranking-specifics">query term proximity ranking</a>.</p>
<p>The json file can be either:</p>
<ol>
<li>An object, following the schema set out in <code>field_map</code></li>
<li>An array of objects following the schema set out in <code>field_map</code></li>
</ol>
<br>
<p><strong><code>loader_configs.CsvLoader</code></strong></p>
<pre><code class="language-json">&quot;loader_configs&quot;: {
  &quot;CsvLoader&quot;: {
    // ---------------------
    // Map data using csv headers
    &quot;use_headers&quot;: false,
    &quot;header_field_map&quot;: {},
    &quot;header_field_order&quot;: [],
    // ---------------------
    // Or simply csv header indices
    &quot;index_field_map&quot;: {
      &quot;0&quot;: &quot;link&quot;,
      &quot;1&quot;: &quot;title&quot;,
      &quot;2&quot;: &quot;body&quot;,
      &quot;4&quot;: &quot;heading&quot;
    },
    &quot;index_field_order&quot;: [
      1,
      4,
      2,
      0
    ],
    // ---------------------
    // Options for csv parsing, from the Rust &quot;csv&quot; crate
    &quot;parse_options&quot;: {
      &quot;comment&quot;: null,
      &quot;delimiter&quot;: 44,
      &quot;double_quote&quot;: true,
      &quot;escape&quot;: null,
      &quot;has_headers&quot;: true,
      &quot;quote&quot;: 34
    }
  }
}
</code></pre>
<p>Field mappings for csv files can be configured using one of the <code>field_map / field_order</code> key pairs. The <code>use_headers</code> parameter specifies which of the two pairs of settings to use.</p>
<p>The <code>parse_options</code> key specifies options for parsing the csv file. In particular, note that the <code>has_headers</code> key is distinct from and does not influence the <code>use_headers</code> parameter.</p>
<br>
<p><strong><code>loader_configs.TxtLoader</code></strong></p>
<pre><code class="language-json">&quot;loader_configs&quot;: {
  &quot;TxtLoader&quot;: {
    &quot;field&quot;: &quot;field_name&quot;,
  }
}
</code></pre>
<p>This loader simply reads <code>.txt</code> files and indexes all its contents into a single field.</p>
<h2 id="file-exclusions"><a class="header" href="#file-exclusions">File Exclusions</a></h2>
<p><strong><code>exclude</code></strong></p>
<p>Global file exclusions can be specified in this parameter, which is simply an array of file globs.</p>
<h2 id="indexing-performance"><a class="header" href="#indexing-performance">Indexing Performance</a></h2>
<p><strong><code>num_threads</code></strong></p>
<p>This is the number of threads to use, excluding the main thread. When unspecified, this is <code>max(num physical cores - 1, 1)</code>.</p>
<br>
<p><strong><code>num_docs_per_block</code></strong></p>
<p>This parameter roughly controls the memory usage of the indexer; You may think of it as ‚Äúhow many documents to keep in memory before flushing results‚Äù.</p>
<p>If your documents are very small, increasing this <em>may</em> help improve indexing performance.</p>
<blockquote>
<p>‚ö†Ô∏è Ensure <a href="indexer/./fields.html"><code>field_store_block_size</code></a> is a clean multiple or divisor of this parameter.</p>
</blockquote>
<h2 id="search-performance"><a class="header" href="#search-performance">Search Performance</a></h2>
<p><strong><code>pl_limit</code></strong></p>
<p>This is the main threshold parameter (in bytes) at which to ‚Äúcut‚Äù index (<strong>pl</strong> meaning <a href="https://en.wikipedia.org/wiki/Inverted_index">postings list</a>) files.</p>
<p>Increasing this value produces less but bigger files (which may take longer to retrieve), and vice versa.</p>
<p>Increasing the value may also be useful for caching when used in conjunction with <code>pl_cache_threshold</code> below, since fewer index files will be produced.</p>
<br>
<p><strong><code>pl_cache_threshold</code></strong></p>
<p>Index files that exceed this number will be cached by the search library at initilisation.</p>
<p>It can be used to configure morsels for response time (over scalability) for some use cases. This is discussed in more detail in <a href="indexer/../tradeoffs.html">Tradeoffs</a>.</p>
<h2 id="miscellaneous-options"><a class="header" href="#miscellaneous-options">Miscellaneous Options</a></h2>
<p><strong><code>num_pls_per_dir</code></strong></p>
<p>This parameter simply controls how many index files you want to store in a single directory.</p>
<p>While the default value should serve sufficiently for most use cases, some file systems are less efficient at handling large amounts of files in one directory. Tuning this parameter may help to improve performance when looking up a particular index file.</p>
<br>
<p><strong><code>with_positions</code></strong></p>
<p>This option controls whether positions will be stored.</p>
<p>Features such as phrase queries that require positional information will not work if this is disabled.</p>
<p>Turning this off for very large collections (~&gt; 1GB) can increase the tool‚Äôs scalability, at the cost of such features.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="scaling-presets"><a class="header" href="#scaling-presets">Scaling Presets</a></h1>
<p>5 configuration presets are designed primarily for use with Morsels‚Äô main intended use case of supporting static site search.</p>
<p>Each preset primarily makes a tradeoff between the document collection size it can support, and the number of rounds of network requests (<code>RTT</code>). Morsels also supports generating result previews from <a href="indexer/../search_configuration.html#1-from-source-documents">source files</a>, if it is preferable (e.g. to reduce file bloat from additional field stores).</p>
<p>The default preset is <code>small</code>, which generates a monolithic index and field store, much like other client side indexing tools.</p>
<p>Specify the <code>preset</code> key in your configuration file to change this.</p>
<pre><code class="language-json">{
    &quot;preset&quot;: &quot;small&quot; | &quot;medium&quot; | &quot;large&quot; | &quot;medium_source&quot; | &quot;large_source&quot;
}
</code></pre>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<blockquote>
<p><code>small</code>, <code>medium</code> and <code>large</code> corresponds to 0, 1, or 2 rounds of network requests in the table below.</p>
</blockquote>
<table><thead><tr><th>Preset</th><th>Description</th></tr></thead><tbody>
<tr><td><code>small</code></td><td>Generates a monolithic index and field store. Identical to most other client side indexing tools.</td></tr>
<tr><td><code>medium</code></td><td>Generates a monolithic index but sharded (on a per document basis) field store. Only field stores of documents to generate result previews for a retrieved.</td></tr>
<tr><td><code>large</code></td><td>Generates both a sharded index and field store. Only index files that are required for the query are retrieved. Keeps <a href="indexer/./language.html#stop-words">stop words</a>. This is the preset used in the demo <a href="https://ang-zeyu.github.io/morsels-demo-1/">here</a>!</td></tr>
<tr><td><code>medium_source</code></td><td>Generates a monolithic index and field store of source document links. Uses the links to retrieve source documents for result preview generation.</td></tr>
<tr><td><code>large_source</code></td><td>Generates a sharded index and monolithic field store of source document links. Uses the links to retrieve source documents for result preview generation. Keeps <a href="indexer/./language.html#stop-words">stop words</a>.</td></tr>
</tbody></table>
<h2 id="modified-properties"><a class="header" href="#modified-properties">Modified Properties</a></h2>
<p>Presets modify the following properties:</p>
<ul>
<li>Search Configuration: 
<ul>
<li><a href="indexer/search_configuration.html#search-library-options"><code>cacheAllFieldStores</code></a></li>
</ul>
</li>
<li>Language Configuration:
<ul>
<li><a href="indexer/./language.html#stop-words"><code>ignore_stop_words</code></a></li>
</ul>
</li>
<li>Indexing Configuration:
<ul>
<li>What <a href="indexer/./fields.html">fields</a> are stored (<code>do_store</code>). Not set if <code>fields_config.fields</code> is present.</li>
<li><a href="indexer/./fields.html"><code>field_store_block_size</code></a></li>
<li><a href="indexer/./indexing.html#search-performance"><code>pl_limit</code></a></li>
<li><a href="indexer/./indexing.html#search-performance"><code>pl_cache_threshold</code></a></li>
</ul>
</li>
</ul>
<p>Any of these values specified in the configuration file will override that of the preset‚Äôs.</p>
<h3 id="other-options"><a class="header" href="#other-options">Other Options</a></h3>
<p>There are 2 other options especially worth highlighting that can help reduce the index size (and hence support larger collections) in general.</p>
<ul>
<li><a href="indexer/./indexer/language.html#note-on-stop-words"><code>ignore_stop_words=false</code></a></li>
<li><a href="indexer/./indexer/indexing.html#miscellaneous-options"><code>with_positions=false</code></a><br>
Positional information takes up a considerable (up to <strong>3-4</strong> times larger) proportion of the index size!</li>
</ul>
<p>If you are willing to forgo some features (e.g. phrase queries, boolean queries of stop words) in return for reducing the index size, you can enable / disable these options as appropriate.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="tradeoffs"><a class="header" href="#tradeoffs">Tradeoffs</a></h1>
<blockquote>
<p>This page goes <em>into detail</em> on how the various indexer presets (<code>small</code>, <code>medium</code>, ‚Ä¶) are configured, what tradeoffs they make, and is a (mostly) optional read, especially if your collection isn‚Äôt too large.</p>
</blockquote>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>Each preset largely makes a tradeoff between your document collection size and the number of rounds of network requests to make. File bloat is also discussed, if it is of concern.</p>
<blockquote>
<p>The last column, <code>RTT=3</code>, is included only for hypothetical discussion but not present in any of the presets!</p>
</blockquote>
<p>The possible tradeoffs are marked with ‚úîÔ∏è. Those that are likely impossible are marked ‚ùå (or in other words, you likely need a search server / SaaS for these options). Options that are possible but are relatively undesirable (for which better equivalent options exist) are marked ‚ö™. The default tradeoff is marked ‚≠ê. Some roughly equivalent / adjacent options are marked ‚úîÔ∏è as it would depend on your collection, use case and some other factors elaborated below.</p>
<p>Latency is labelled in terms of <code>RTT</code> (round trip time), the maximum of which is <code>3</code>. Also note that the labelled <code>RTT</code> times are <strong>maximums</strong>. (e.g. if files are served from cache instead)</p>
<table><thead><tr><th>Factor</th><th><code>RTT=0</code></th><th><code>RTT=1</code></th><th><code>RTT=2</code></th><th><code>RTT=3</code></th></tr></thead><tbody>
<tr><td>Fair Scalability,<br><span style="color: green">Little</span> File bloat</td><td>‚≠ê</td><td>‚ö™</td><td>‚ö™</td><td>‚ö™</td></tr>
<tr><td>Fair Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>‚ö™</td><td>‚ö™</td><td>‚ö™</td><td>‚ö™</td></tr>
<tr><td>Fair Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>‚ö™</td><td>‚ö™</td><td>‚ö™</td><td>‚ö™</td></tr>
<tr><td>Good Scalability,<br><span style="color: green">Little</span> File bloat</td><td>‚ùå</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td><td>‚ö™</td></tr>
<tr><td>Good Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>‚ùå</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td><td>‚ö™</td></tr>
<tr><td>Good Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>‚ùå</td><td>‚úîÔ∏è</td><td>‚úîÔ∏è</td><td>‚ö™</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: green">Little</span> File bloat</td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úîÔ∏è</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úîÔ∏è</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>‚ùå</td><td>‚ùå</td><td>‚úîÔ∏è</td><td>‚ö™</td></tr>
<tr><td>Beyond Excellent Scalability<br>(consider running a<br>search server / SaaS)</td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td></tr>
</tbody></table>
<h3 id="monolithic-index"><a class="header" href="#monolithic-index">Monolithic Index</a></h3>
<p>Of particular note, the only possible option under <code>RTT=0</code> is equivalent to using some other existing client side search library and generating a monolithic prebuilt index <strong>and</strong> document/field store (used for generating result previews).</p>
<p>You may still want to use morsels since it packages a search UI, or, if you prefer the simplicity of a cli indexer tool (e.g. for CI build tools).</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<blockquote>
<p>This section assumes some knowledge on the options listed below in chapters 4 (barring 4.1) and 5, which will be discussed in briefer detail here:</p>
</blockquote>
<ul>
<li>Search Configuration: 
<ul>
<li>‚≠ê‚≠ê The method of <a href="search_configuration.html#default-rendering-output--purpose">result preview generation</a></li>
<li><a href="search_configuration.html#search-library-options"><code>cacheAllFieldStores</code></a></li>
</ul>
</li>
<li>Indexing Configuration:
<ul>
<li>what <a href="./indexer/fields.html">fields</a> are stored (<code>do_store</code>)</li>
<li><a href="./indexer/fields.html"><code>field_store_block_size</code></a></li>
<li><a href="./indexer/indexing.html#search-performance"><code>pl_limit</code></a></li>
<li><a href="./indexer/indexing.html#search-performance"><code>pl_cache_threshold</code></a></li>
</ul>
</li>
</ul>
<p>The following sections discusses some combinations of options that generate the tradeoff results in the table above.</p>
<h3 id="1-rtt0-fair-scalability-little-file-bloat"><a class="header" href="#1-rtt0-fair-scalability-little-file-bloat">1. <code>RTT=0</code>, Fair Scalability, Little File Bloat</a></h3>
<p>To achieve this result, you will need to ensure <strong>everything</strong> that is potentially needed is retrieved up front.</p>
<ol>
<li>Set <code>pl_limit</code> to an arbitrarily large number. This compresses the inverted index into just one or a few files.</li>
<li>Ensure <code>pl_cache_threshold</code> is set to a very low number (or, at least smaller than the generated inverted index file size), so that all postings lists are loaded up front and cached in memory.</li>
<li>You would also want to set <code>field_store_block_size</code> to a fairly high number, and correspondingly set <code>cacheAllFieldStores</code> to <code>true</code>. This allows morsels to load the few field stores during initilisation and persistently cache them.</li>
</ol>
<blockquote>
<p>‚≠ê This is what‚Äôs being used by this documentation, since it is fairly small.<br><br>Nevertheless, <code>RTT=1/2</code> are still very acceptable settings under good network conditions. <code>RTT=3</code> may be slightly slow (<code>~600ms</code> assuming decent network conditions), but still quite acceptable depending on your use case since it reduces file bloat.<br><br></p>
</blockquote>
<h3 id="2-rtt12-good-scalability-moderate--heavy-file-bloat"><a class="header" href="#2-rtt12-good-scalability-moderate--heavy-file-bloat">2. <code>RTT=1/2</code>, Good Scalability, Moderate / Heavy File Bloat</a></h3>
<p>The impacts of the two options here are discussed under the 2 main methods of result preview generation in the <a href="search_configuration.html#options-for-generating-result-previews">earlier chapter</a>.</p>
<h4 id="21-generating-result-previews-from-source-files"><a class="header" href="#21-generating-result-previews-from-source-files">2.1. Generating Result Previews from Source Files</a></h4>
<p>(<code>RTT=2</code>, Little-Moderate file bloat, Good scalability)</p>
<p>Generating result previews from source files greatly reduces file bloat, but it does mean that an extra round (<code>RTT</code>) of network requests has to be made to retrieve said source files.</p>
<p>However, it is also more feasible with this option to reduce a round of network requests by <strong>caching all field stores</strong> up front, as field stores here only store the <a href="indexer/fields.html#special-fields">relative file path / link</a> from which to retrieve the source files, and are therefore fairly small.</p>
<blockquote>
<p>For example, assuming each link takes an average of <code>25</code> bytes to encode (including json fluff), and <code>3MB</code> (ungzipped) is your comfort zone, you can store up to <code>120000</code> document links in a single, cached field store!</p>
</blockquote>
<p>The relevant options here are <code>field_store_block_size</code> and <code>cacheAllFieldStores</code> (simply configure them similar to the earlier <code>RTT=0</code> case).</p>
<h4 id="22-generating-result-previews-from-field-stores"><a class="header" href="#22-generating-result-previews-from-field-stores">2.2. Generating Result Previews from Field Stores</a></h4>
<p>(<code>RTT=2</code>, Moderate-Heavy file bloat, Good scalability)</p>
<p>Generating result previews directly from field stores (using the <a href="./indexer/fields.html"><code>do_store</code></a> option) avoids having to make an extra round of network requests to retrieve said source files.</p>
<p>This however requires fragmenting the field stores, increasing file bloat.</p>
<p>You may want to use this option over <strong>2.1</strong> nevertheless if:</p>
<ul>
<li>Result previews cannot be generated from source files (<code>csv</code> files)</li>
<li>You want to increase result preview generation performance (mentioned <a href="search_configuration.html#2-from-field-stores">here</a>)</li>
</ul>
<blockquote>
<p>Refer <a href="https://ang-zeyu.github.io/morsels-demo-1/">here</a> for a demo of what <code>RTT=2</code> is like.</p>
</blockquote>
<h4 id="improving-21-or-22-to-rtt1"><a class="header" href="#improving-21-or-22-to-rtt1">Improving 2.1 or 2.2 to <code>RTT=1</code></a></h4>
<p>For moderately sized collections, we may also surmise that the <strong>size of the index</strong> (a low-level, compressed inverted index) is often far smaller than the <strong>size of field stores</strong> (which contain the raw document texts).</p>
<p>The idea here therefore is to additionally <strong>cache the index</strong> (using <code>pl_limit</code>, <code>pl_cache_threshold</code>), removing an entire round of network requests.</p>
<p>This corresponds to the <code>medium</code> presets in the previous page.</p>
<h3 id="3-excellent-scalability"><a class="header" href="#3-excellent-scalability">3. Excellent Scalability</a></h3>
<p>The presets here follow from the section directly above, disregarding the assumptions. That is,</p>
<h4 id="31-generating-result-previews-from-source-files"><a class="header" href="#31-generating-result-previews-from-source-files">3.1. Generating Result Previews from Source Files</a></h4>
<p>(<code>RTT=3</code>, Little-Moderate File Bloat, Excellent Scalability)</p>
<p>Per <strong>section 2.1</strong>, The <code>RTT</code> compromise is accepted as is in this case, without performing the caching of field stores mentioned.</p>
<p>This is because as the collection grows, we cannot guarantee that document links are at a size that can be feasibly and monolithically cached, although, this is highly unlikely even for the most extreme intended use cases of Morsels (see the earlier example calculation of <code>120000</code> documents).</p>
<h4 id="32-generating-result-previews-from-field-stores"><a class="header" href="#32-generating-result-previews-from-field-stores">3.2. Generating Result Previews from Field Stores</a></h4>
<p>(<code>RTT=2</code>, Heavy File Bloat, Excellent Scalability)</p>
<p>This follows <strong>section 2.2</strong>. No changes are needed here, as both the field stores and index are fragmented.</p>
<p>As the collection size grows however, many fragmented files will inevitably be generated, which may be of concern for your use case.</p>
<h2 id="other-performance-considerations"><a class="header" href="#other-performance-considerations">Other Performance Considerations</a></h2>
<p>This section discusses some other numbers regarding scaling, and is a <em>really</em> optional read.</p>
<h3 id="gzip"><a class="header" href="#gzip">Gzip</a></h3>
<p>Gzip can work hand in hand with the morsels‚Äô own compression schemes.</p>
<p>With a monolithic index, expect about 3-4x compression ratios <strong>without positions</strong> indexed.</p>
<p>Compression ratios with positions tends to be poorer from some empircal testing, likely since the number of unique positions is fairly large.</p>
<p>When opting to fragment the index heavily however, also note gzip would serve little to no purpose as:</p>
<ul>
<li>The fragmented files are already very small</li>
<li>Compression ratios for smaller files tends to be poorer</li>
</ul>
<blockquote>
<p>‚≠ê Morsels‚Äô binary output files are named <code>.json</code> by default, so you shouldn‚Äôt have to manually configure the relevant settings in your server.</p>
</blockquote>
<h3 id="limits-of-scalability"><a class="header" href="#limits-of-scalability">Limits of Scalability</a></h3>
<p>Scaling the tool requires splitting the index into many chunks. Some of these chunks may however exceed the index fragment size limit (<code>pl_limit</code>), especially when the chunk contains a very common term (e.g. a stop word like ‚Äúthe‚Äù). While the information for this term could be further split into multiple chunks, this would be almost pointless as all such chunks would still have to be retrieved when the term is searched.</p>
<p>This impacts (depending on the configuration):</p>
<ul>
<li>The total size of index chunks retrieved upfront and persistently cached, which exceed the defined <code>pl_cache_threshold</code>.</li>
<li>The total size of the index chunks that need to be retrieved for the query, which is relevant when <code>pl_cache_threshold</code> is fairly high (such that no files are cached).</li>
</ul>
<h4 id="some-data--estimations"><a class="header" href="#some-data--estimations">Some Data &amp; Estimations</a></h4>
<p>As a rough estimate from testing, this library should be able to handle text collections &lt; <code>800MB</code> with positional indexing and stop words kept.</p>
<p>The following distribution of index chunk file sizes (before gzip) under the default <code>pl_limit</code> was produced with:</p>
<ul>
<li>A <code>380MB</code> <strong>csv</strong> corpus (no HTML soup!)</li>
<li>Duplicated once to total about <code>760MB</code>, and 19088 documents</li>
</ul>
<pre><code># Counts
[7335  219   76   13    7    14    4     1     1     1     0     0     0     1]
# (Left) Bin Edges, in KB
[0     100   250  500   750  1000  2000  3000  4000  5000  6000  7000  8000  9000]
</code></pre>
<p>Most of the index chunks are well below the default <code>pl_cache_threshold</code> of <code>1048576</code> bytes, while the select few above it totals roughly <code>45MB</code>. Therefore, on startup, <code>45MB</code> of index chunks are fetched and cached. The remaining bulk of index chunks are retrieved on-demand.</p>
<h5 id="disabling-positions"><a class="header" href="#disabling-positions">Disabling Positions</a></h5>
<p>Without positional indexing, the index shrinks <strong>3-4 fold</strong>, making it potentially possible to index collections <code>~2gb</code> in size, or even more.</p>
<p>In addition, large postings lists are all but removed in this case:</p>
<pre><code># Counts with positional information removed
[4350    0    0    0    0    0    0    0    0    0    0    0    0    0]
</code></pre>
<h5 id="removing-stop-words"><a class="header" href="#removing-stop-words">Removing Stop Words</a></h5>
<p>If disabling caching via setting a very high <code>pl_cache_threshold</code>, <a href="./indexer/language.html#note-on-stop-words">removing stop words</a> when indexing would have little to no effect as such terms are already separated into different postings lists and never retrieved unless necessary.</p>
<p>On the other hand, removing stop words with a lower <code>pl_cache_threshold</code> would help to avoid caching the ‚Äúoutliers‚Äù on the right of the distribution up front, if initial network usage is a concern.</p>
<pre><code># Counts with stop words removed
[7234  209   65   11    5    1    0    0    0    0    0    0    0    0]
</code></pre>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui-light.css">
<style>.light .morsels-root,
.rust .morsels-root,
.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-bg: var(--bg);
    --morsels-item-box-shadow: 0 1px 5px rgba(196, 192, 187, 0.8);
    --morsels-item-sub-border: 0;
    --morsels-title-fg: var(--fg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--fg);
    --morsels-title-hover-bg: var(--table-header-bg);
    --morsels-heading-fg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-fg: var(--fg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-fg: var(--fg);
    --morsels-body-bg: var(--bg);
    --morsels-body-hover-fg: var(--fg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-highlight-bg: none;
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-loading-secondary-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fs-box-shadow: none;
    --morsels-fs-header-bg: var(--sidebar-bg);
    --morsels-fs-header-border-bottom: none;
    --morsels-fs-header-close-fg: var(--sidebar-fg);
    --morsels-fs-header-close-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-bg: var(--table-header-bg);
    --morsels-fs-header-close-hover-fg: var(--fg);
    --morsels-fs-header-close-active-bg: var(--table-header-bg);
    --morsels-fs-header-close-active-fg: var(--fg);
}

.ayu .morsels-root,
.rust .morsels-root {
    --morsels-fs-header-close-hover-bg: var(--sidebar-bg);
    --morsels-fs-header-close-hover-fg: white;
    --morsels-fs-header-close-active-bg: var(--sidebar-bg);
    --morsels-fs-header-close-active-fg: white;
}

.coal .morsels-root,
.navy .morsels-root,
.ayu .morsels-root {
    --morsels-item-box-shadow: 0 1px 5px rgb(50, 50, 50);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
    margin: 0;
    padding: 0;
}
</style>
<p><input
    type="search"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<ul class="morsels-root" id="morsels-mdbook-target"></ul>
<h1 id="incremental-indexing"><a class="header" href="#incremental-indexing">Incremental Indexing</a></h1>
<p><em>Incremental</em> indexing is also supported by the indexer cli tool.</p>
<p>Detecting <strong>deleted, changed, or added files</strong> is done by storing an <strong>internal file path ‚Äì&gt; last modified timestamp</strong> map.</p>
<p>To use it, simply pass the <code>--incremental</code> or <code>-i</code> option when running the indexer.</p>
<h2 id="how-it-works-1"><a class="header" href="#how-it-works-1">How it Works</a></h2>
<p>As the core idea of Morsels is to split up the index into many tiny parts, the incremental indexing feature works by ‚Äúpatching‚Äù only the files which were updated during the current run. This means that at search time, the same amount of index files are retrieved and searched through as before, to reduce the number of network requests.</p>
<p>This is in contrast to a more traditional ‚Äúsegment‚Äù based approach you might find in search servers, whereby each incremental indexing run generates an entirely separate ‚Äúsegment‚Äù, and segments are merged together at runtime (during search). While this makes sense for traditional search tools, it may unfortunately generate too many network requests for index files and search overhead from merging files, something Morsels is trying to minimise.</p>
<h2 id="content-based-hashing"><a class="header" href="#content-based-hashing">Content Based Hashing</a></h2>
<p>The default change detection currently relies on the last modified time in file metadata. This may not always be guaranteed by the tools that generate the files Morsels indexes, or be an accurate reflection of whether a file‚Äôs contents were updated.</p>
<p>If file metadata is <em>unavailable</em> for any given file, the file would always be re-indexed as well.</p>
<p>You may specify the <code>--incremental-content-hash</code> option in such a case to opt into using a crc32 hash comparison for all files instead. This option should also be specified when running a full index and intending to run incremental indexing somewhere down the line.</p>
<p>It should only be marginally more expensive for the majority of cases, and may be the default option in the future.</p>
<h2 id="circumstances-that-trigger-a-full-reindex"><a class="header" href="#circumstances-that-trigger-a-full-reindex">Circumstances that Trigger a Full (Re)Index</a></h2>
<p>Note also, that the following circumstances will forcibly trigger a <strong>full</strong> reindex:</p>
<ul>
<li>If the output folder path does not contain any files indexed by morsels</li>
<li>It contains files indexed by a different version of morsels</li>
<li>The configuration file (<code>morsels_config.json</code>) was changed in any way</li>
<li>Usage of the <code>--incremental-content-hash</code> option changed</li>
</ul>
<h2 id="caveats"><a class="header" href="#caveats">Caveats</a></h2>
<p>There are some additional caveats to note when using this option. Whenever possible, try to run a full reindex of the documents, utilising incremental indexing only when indexing speed is of concern ‚Äì for example, updating the index repeatedly when developing this documentation (although, the mdbook plugin this documentation is built on currently dosen‚Äôt do that).</p>
<h3 id="collection-statistics"><a class="header" href="#collection-statistics">Collection Statistics</a></h3>
<p>Collection statistics used to rank documents will tend to drift off when deleting documents (which also entails updating documents). This is because such documents may contain <strong>terms that were not encountered</strong> during the current run of incremental indexing (from added / updated documents). Detecting such terms is difficult, as there is no guarantee the deleted documents are available anymore. The alternative would be to store such information in a non-inverted index, but that again takes up extra space =(.</p>
<p>As such, the information for these terms may not be ‚Äúpatched‚Äù. You <em>may</em> notice some slight drifting in the relative ranking of documents returned after some number of incremental indexing runs, until said terms are encountered again in some other document.</p>
<h3 id="file-bloat"><a class="header" href="#file-bloat">File Bloat</a></h3>
<p>When deleting documents or updating documents, old field stores are not removed. This may lead to file bloat after many incremental indexing runs.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

document.getElementById('morsels-search').addEventListener('keydown', (ev) => {
  if (['ArrowLeft', 'ArrowRight'].includes(ev.key)) {
    ev.stopPropagation(); // used in global listener to change pages
    return;
  }
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>



        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="src/morsels-theme.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
