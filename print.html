<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Morsels Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/morsels-theme.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="search_features.html"><strong aria-hidden="true">2.</strong> Search Features</a></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting_started_mdbook.html"><strong aria-hidden="true">3.1.</strong> Mdbook</a></li><li class="chapter-item expanded "><a href="getting_started_others.html"><strong aria-hidden="true">3.2.</strong> Others</a></li></ol></li><li class="chapter-item expanded "><a href="search_configuration.html"><strong aria-hidden="true">4.</strong> Search UI Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="search_configuration_renderers.html"><strong aria-hidden="true">4.1.</strong> Renderers</a></li></ol></li><li class="chapter-item expanded "><a href="indexing_configuration.html"><strong aria-hidden="true">5.</strong> Indexing Configuration</a></li><li class="chapter-item expanded "><a href="tradeoffs.html"><strong aria-hidden="true">6.</strong> Tradeoffs</a></li><li class="chapter-item expanded "><a href="dynamic_indexing.html"><strong aria-hidden="true">7.</strong> Dynamic Indexing</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Search API</div></li><li class="chapter-item expanded "><a href="future_plans.html"><strong aria-hidden="true">9.</strong> Future Plans</a></li><li class="chapter-item expanded "><a href="contributing.html"><strong aria-hidden="true">10.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developers_setting_up.html"><strong aria-hidden="true">10.1.</strong> Setting Up</a></li><li class="chapter-item expanded "><a href="developers_developing.html"><strong aria-hidden="true">10.2.</strong> Developing</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Morsels Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ang-zeyu/morsels" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Morsels is a client-side search library and user-interface that depends on a <strong>pre-built index</strong> generated by its <strong>cli build tool</strong>.</p>
<p>The difference with other search libraries like lunr.js is that this tool is focused on providing more <strong>scalability</strong> (but not infinitely so) using a pre-built index split into many small files. (versus other tools that provide this in a monolithic format)</p>
<h2 id="what"><a class="header" href="#what">What</a></h2>
<p>The core idea of this tool is to split up a monolithic postings list into many smaller files (hence the name <em>“Morsels”</em>), organised by the indexed terms. Multiple index files are batched into the same file, keeping to <code>16383</code> bytes (configurable) as much as possible.</p>
<p>On the client, supporting information (e.g. dictionary, document lengths, field weights) is retrieved on startup, which is usually less than a few MB even for fairly large collections.</p>
<p>The index files containing searched terms will be requested only on-demand from a static file server.</p>
<h2 id="limits"><a class="header" href="#limits">Limits</a></h2>
<p>The practicality / scalability of this tool is mainly bound by the following 2 factors as such.</p>
<h3 id="size-of-the-largest-index-chunk-retrieved"><a class="header" href="#size-of-the-largest-index-chunk-retrieved">Size of the Largest Index Chunk Retrieved</a></h3>
<p>While the index is split into many chunks, some chunks may exceed the “split size” of <code>16383</code> bytes at times. This occurs when the chunk contains a very common term (e.g. a stop word like “the”). While the information for this term could be further split into multiple chunks, all such chunks will still inevitably have to be retrieved when the term is searched, diminishing its benefit.</p>
<p>Certain <a href="./indexing_configuration.html">indexing options</a> like removing positions and pre-caching larger chunks on startup are available to alleviate this to some extent, though not infinitely.</p>
<h4 id="estimations"><a class="header" href="#estimations">Estimations</a></h4>
<p>As a rough estimate from testing, this library should be able to handle collections &lt; <code>800mb</code> with positional indexing. Without it, the index shrinks 3-4 fold, making it potentially possible to index collections <code>~2gb</code> in size.</p>
<h3 id="hardware-capabilities"><a class="header" href="#hardware-capabilities">Hardware Capabilities</a></h3>
<p>Device capabilities is also another concern (performance when ranking and populating results), although in practice, you should be hitting limits due to the first factor (network transfer times) long before experiencing issues with this.</p>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<p>In short, this tool is tailored for a very specific audience:</p>
<ul>
<li>You have a fairly large collection of html, csv, or json (only these are supported for now) files that cannot be monolithically retrieved feasibly</li>
<li>You don’t want or can’t run a search server / search Saas (eg. Algolia Docsearch)</li>
<li>You don’t want the user downloading and loading a gigantic <code>&gt; 50mb</code> index, blowing up memory usage everytime they visit your site.</li>
<li>You want a complete, end-to-end and customisable search UI and file indexing solution.</li>
</ul>
<blockquote>
<p>⚠️ 
It is <strong>not possible</strong> to use morsels for client-side indexing + searching as such since the indexer is a cli tool.</p>
<p>If this is the use case, consider other lighter-weight libraries like lunr.js that already fit well.</p>
</blockquote>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<p>This project is made up of 3 crates and 2 packages, which may be referred to in the subsequent sections of the documentation.</p>
<h4 id="rust-crates"><a class="header" href="#rust-crates">Rust crates:</a></h4>
<ul>
<li><strong>morsels_indexer</strong>: the cli tool providing indexing functionalities for several file formats</li>
<li><strong>morsels_search</strong>: internal rust wasm crate, used by the <strong>@morsels/search-lib</strong> package below.</li>
<li><strong>morsels_common</strong>: internal library containing common functionalities for the above 2 crates.</li>
</ul>
<h4 id="npm-packages"><a class="header" href="#npm-packages">Npm packages:</a></h4>
<ul>
<li><strong>@morsels/search-ui</strong>: interfaces with @morsels/search-lib to provide basic search UI functionalities (e.g. SERP generation)</li>
<li><strong>@morsels/search-lib</strong>: a small companion library to morsels_search for interfacing with the wasm crate. This may be used without the <code>@morsels/search-ui</code> package in the future. For now, it only serves to separate some concerns from the UI package.</li>
<li><strong>@morsels/lang-XX</strong>: internal tokenizer packages for different languages generated by wasm pack.</li>
</ul>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="search-features"><a class="header" href="#search-features">Search Features</a></h1>
<p>This page outlines the available search features common to both <code>@morsels/search-ui</code> and <code>@morsels/search-lib</code>.</p>
<h2 id="boolean-operators-parentheses"><a class="header" href="#boolean-operators-parentheses">Boolean Operators, Parentheses</a></h2>
<p><code>AND</code> and <code>NOT</code> operators are supported.
<code>OR</code> operators are not supported, but is implicitly left to the tokenizer (see below for an example).
Parentheses <code>(...)</code> can be used to group expressions together.</p>
<pre><code>lorem ipsum                 - documents containing either lorem or ipsum.
lorem AND ipsum             - documents with both &quot;lorem&quot; and &quot;ipsum&quot;
lorem AND NOT ipsum         - documents with &quot;lorem&quot; but not &quot;ipsum&quot;
lorem AND NOT (ipsum dolor) - documents with &quot;lorem&quot; but not (&quot;ipsum&quot; OR &quot;dolor&quot;)
</code></pre>
<h2 id="phrase-queries"><a class="header" href="#phrase-queries">Phrase Queries</a></h2>
<p>Phrase queries are also supported. However, these will not work if the <a href="./indexing_configuration.html"><code>withPositions</code></a> index feature is disabled.</p>
<pre><code>&quot;lorem ipsum&quot; - documents containing &quot;lorem&quot; and &quot;ipsum&quot; appearing one after the other
</code></pre>
<h2 id="field-search"><a class="header" href="#field-search">Field Search</a></h2>
<p>Field queries are supported via the following syntax <code>field_name:</code>, following the same syntax rules as the <code>NOT</code> operator.</p>
<pre><code>title:lorem             - documents containing &quot;lorem&quot; in the field &quot;title&quot;
title:(lorem AND ipsum) - documents with both &quot;lorem&quot; and &quot;ipsum&quot; in the
                          field &quot;title&quot; only
lorem AND title:ipsum   - documents with &quot;ipsum&quot; in the title and &quot;lorem&quot; in any field
</code></pre>
<h2 id="escaping-search-operators"><a class="header" href="#escaping-search-operators">Escaping Search Operators</a></h2>
<p>All search operators can also be escaped using the <code>\</code> character like such:</p>
<pre><code>lorem\ AND ipsum            - interpreted literally as &quot;lorem AND ipsum&quot;
\NOT lorem                  - interpreted literally as &quot;NOT lorem&quot;
\(not a parentheses group\)
\&quot;not a phrase query\&quot;
&quot;phrase query with qu\&quot;ote inside&quot;
title\:lorem
</code></pre>
<h2 id="other-details"><a class="header" href="#other-details">Other Details</a></h2>
<p>This section briefly details some non user-facing features.</p>
<h3 id="webworker-built-in"><a class="header" href="#webworker-built-in">WebWorker Built-in</a></h3>
<p>Most of the search library operates on a WebWorker where it matters (e.g. setup), so you don’t have to worry about blocking the UI thread.</p>
<p>Population of stored document fields is however done on the main thread, as copying large documents to-and-fro WebWorker interfaces incurs substantial overhead.</p>
<p>Search UI (@morsels/search-ui) related functionalities, for example SERP generation, is also done on the main thread.
One of the main reasons is that there is simply no way of parsing html (the original html document can be used as an alternative to storing document fields) faster than the implementations provided by the browser.</p>
<h3 id="ranking-specifics"><a class="header" href="#ranking-specifics">Ranking Specifics</a></h3>
<p>Top-level disjunctive expressions (e.g. <code>lorem ipsum</code>) are ranked using the BM25 model.</p>
<p>Pure free-text queries (e.g. “lorem ipsum”) also use the <a href="https://www.elastic.co/blog/faster-retrieval-of-top-hits-in-elasticsearch-with-block-max-wand">WAND algorithm</a> to improve query speed, although, the benefits should be marginal for most cases.</p>
<p>Query term proximity ranking is also supported and enabled by default - results are scaled in an inverse logarithmic manner according to how close disjunctive search expressions are to one another.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>This page assumes the following use case:</p>
<ul>
<li>You have some <code>.html</code> files you want to index</li>
<li>These <code>.html</code> files are served in a static file server, and are accessible by the search-ui to generate result previews</li>
<li>You have a input element to attach a search dropdown to
<ul>
<li>For mobile devices, a fullscreen UI will show instead when this input element is focused.</li>
<li>Note that this documentation is using an alternative UI mode (try the search function!), which is covered later under <a href="./search_configuration.html#ui-mode">search configuration</a>.</li>
<li>To preview the default mode, head on over to the mdbook page <a href="./getting_started_mdbook.html#preview">here</a>, and click on the <strong>auto</strong> button.</li>
</ul>
</li>
</ul>
<p>If you require more, have a look through here first, then jump into the subsequent configuration pages to learn more.</p>
<h2 id="installing-the-indexer"><a class="header" href="#installing-the-indexer">Installing the indexer</a></h2>
<p>If you have the rust / cargo toolchain setup, simply run <code>cargo install morsels_indexer</code>.</p>
<p>The cli binaries are also available <a href="https://github.com/ang-zeyu/morsels/releases">here</a> if preferred.</p>
<h2 id="running-the-indexer"><a class="header" href="#running-the-indexer">Running the indexer</a></h2>
<p>Run the executable as such, replacing <code>&lt;source-folder-path&gt;</code> with the relative or absolute folder path of your source html files, and <code>&lt;output-folder-path&gt;</code> with your desired index output folder.</p>
<pre><code>morsels &lt;source-folder-path&gt; &lt;output-folder-path&gt;
</code></pre>
<h3 id="other-cli-options"><a class="header" href="#other-cli-options">Other Cli Options</a></h3>
<p>While optional, if it is your first time running the tool, you can run the above command with the <code>--init</code> or <code>-i</code> flag, then run it again without this flag.
This flag outputs the default <code>morsels_config.json</code> that can be used to <a href="./indexing_configuration.html">configure the indexer</a> later on.</p>
<p>You may also change the config file location (relative to the <code>source-folder-path</code>) using the <code>-c &lt;config-file-path&gt;</code> option.</p>
<p><strong>All existing contents</strong> in the output folder are also <strong>removed</strong> when running a full index. Specify the <code>--preserve-output-folder</code> option to avoid this.</p>
<h2 id="installing-the-search-library--ui"><a class="header" href="#installing-the-search-library--ui">Installing the search library / UI</a></h2>
<h3 id="installation-via-cdn"><a class="header" href="#installation-via-cdn">Installation via CDN</a></h3>
<pre><code class="language-html">&lt;!-- Replace &quot;v0.0.2&quot; as appropriate --&gt;

&lt;!--  Search UI package script, which bundles the search library together with it --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.0.2/packages/search-ui/dist/search-ui.bundle.js&quot;&gt;&lt;/script&gt;
&lt;!-- Search UI css, this provides very basic styling for the search dropdown, and can be omitted if desired --&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/gh/ang-zeyu/morsels@v0.0.2/packages/search-ui/dist/search-ui.css&quot;&gt;&lt;/script&gt;
</code></pre>
<blockquote>
<p>⚠️ Ensure the versions here tally with the indexer version installed.</p>
</blockquote>
<h4 id="hosting-the-files-locally"><a class="header" href="#hosting-the-files-locally">Hosting the Files Locally</a></h4>
<p>If you wish to serve the files locally instead, you can find the latest versions in <a href="https://github.com/ang-zeyu/morsels/tree/main/packages/search-ui/dist">this folder</a>, or in the release packages <a href="https://github.com/ang-zeyu/morsels/releases">here</a>.</p>
<p>The following files will be present in each release:</p>
<ul>
<li><code>search-ui.bundle.js</code></li>
<li><code>search-ui.css</code></li>
<li><code>search.worker.bundle.js</code></li>
<li>Multiple (as many supported languages / tokenizers as there are):
<ul>
<li><code>wasm.lang-latin-index-js.bundle</code></li>
<li>an accompanying wasm binary</li>
</ul>
</li>
</ul>
<p>Note that <code>search.worker.bundle.js</code> and the wasm files are expected to be accessible in the same folder relative to the linked <code>search-ui.bundle.js</code>.</p>
<h3 id="installation-via-bundlers"><a class="header" href="#installation-via-bundlers">Installation via Bundlers</a></h3>
<p>As morsels consists of a javascript (typescript) and rust portion enabled by WebAssembly, including it into your project’s bundling / build process is likely infeasible, as rust / wasm compilation takes a lot of time (and requires <a href="./developers_setting_up.html">extra toolchains</a>).</p>
<p>Instead, use the file copying functionalities of your bundler to copy morsels’ assets into the appropriate output directories.</p>
<p>For example, using the <a href="https://webpack.js.org/plugins/copy-webpack-plugin/">CopyWebpackPlugin</a>, the following (untested) setup should be all you need:</p>
<pre><code class="language-js">// Under plugins configuration
new CopyPlugin({
  patterns: [
    {
      from: path.join(require.resolve('@morsels/search-ui'), 'dist'),
      to: &quot;dest&quot; // change as appropriate
    },
  ],
})
</code></pre>
<pre><code class="language-html">&lt;!-- Replace links as appropriate --&gt;
&lt;script src=&quot;.../search-ui.bundle.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;.../search-ui.css&quot;&gt;&lt;/script&gt;
</code></pre>
<h3 id="initialisation-call"><a class="header" href="#initialisation-call">Initialisation Call</a></h3>
<p>Once you have loaded the bundles, to initialise morsels, simply call the <code>initMorsels</code> function.</p>
<p>This requires an input element with an id of <code>morsels-search</code> to be present in the page by default, which can be configured differently via <code>uiOptions.input</code>.</p>
<pre><code class="language-ts">initMorsels({
  searcherOptions: {
    // Output folder url specified as the second parameter in the cli command
    url: 'http://192.168.10.132:3000/output/',
  },
  uiOptions: {
    // Input / source folder url, specified as the first parameter in the cli command
    sourceFilesUrl: 'http://192.168.10.132:3000/source/',
  }
});
</code></pre>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="mdbook-morsels"><a class="header" href="#mdbook-morsels">mdbook-morsels</a></h1>
<p><code>mdbook-morsels</code> is a simple search plugin replacement for <a href="https://github.com/rust-lang/mdBook">mdbook</a> to use morsels’ search interface and library instead of elasticlunr.js.</p>
<p>It uses the css variables provided by the 5 main default themes in mdbook to style the search user interface. You can switch the themes in this documentation to try out the different themes.</p>
<p>Note: The “Morsels” theme is not included in the plugin and is specific to this documentation. It is included only to show the default styling (without mdbook-morsels).</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>You will need to have installed the following command-line crates (<code>cargo install &lt;crate-name&gt;</code> or with the binaries in your <code>PATH</code>):</p>
<ul>
<li>mdbook</li>
<li>mdbook-morsels</li>
<li>morsels_indexer</li>
</ul>
<blockquote>
<p>⚠️ Ensure the mdbook-morsels and morsels_indexer versions are the same.</p>
</blockquote>
<p>Then, minimally add the first two configuration sections below to your <code>book.toml</code> configuration file:</p>
<pre><code class="language-toml">[output.html.search]
enable = false               # disable the default mdbook search feature implementation

[preprocessor.morsels]
command = &quot;mdbook-morsels&quot;
renderer = [&quot;html&quot;]          # this should only be run for the html renderer

# Plugin configuration options (optional)
[output.morsels]

# See search configuration page
mode = &quot;target&quot;

# Relative path to the indexer configuration file from the root project directory
# This will automatically be created if it dosen't exist.
config = &quot;morsels_config.json&quot;

# Don't add the default stylesheet from morsels/search-ui,
# nor the inline css variables for the default mdbook themes
#
# Only needed if you want to use some custom styling
no-css = false

# This scales some settings of the indexer according to your collection size
# (see chapter on &quot;Tradeoffs&quot;)
scaling = true
</code></pre>
<h2 id="preview"><a class="header" href="#preview">Preview</a></h2>
<p>Use the following (non-canonical, documentation specific) buttons to try out the different <a href="search_configuration.html#ui-mode"><strong><code>mode</code></strong> parameters</a>.</p>
<style>
    .demo-btn {
        padding: 5px 9px;
        margin: 0 8px 8px 8px;
        border: 2px solid var(--sidebar-bg) !important;
        border-radius: 10px;
        transition: all 0.15s linear;
        color: var(--fg) !important;
        text-decoration: none !important;
        font-weight: 600 !important;
    }

    .demo-btn:hover {
        color: var(--sidebar-fg) !important;
        background: var(--sidebar-bg) !important;
    }

    .demo-btn:active {
        color: var(--sidebar-active) !important;
    }
</style>
<div style="display: flex; justify-content: center; flex-wrap: wrap;">
    <a class="demo-btn" href="?mode=auto">Auto</a>
    <a class="demo-btn" href="?mode=dropdown">Dropdown</a>
    <a class="demo-btn" href="?mode=fullscreen">Fullscreen</a>
    <a class="demo-btn" href="?mode=target">Target</a>
</div>
<p>You can also try out the different <strong>themes</strong> on this documentation using mdbook’s paintbrush icon!</p>
<figure>
<p><img src="./images/mdbook-preview.gif" alt="mdbook morsels plugin preview" /></p>
<figcaption style="text-align: center;"><em>Gif of `mode='fullscreen'` across the different themes</em></figcaption>
</figure>
<p>Also note that unlike the default search feature, the search bar is always there – there is no search icon on the navbar to click. I am still trying to figure how to add this nicely (without runtime hacks) within mdbook’s plugin framework :)</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="other-use-cases"><a class="header" href="#other-use-cases">Other Use Cases</a></h1>
<p>Since its indexer is essentially just a CLI tool, morsels could in-theory be used almost anywhere (e.g. other static site generators) easily without a custom wrapper implementation (such as the Mdbook plugin).</p>
<p>For example, to deploy another static site generator to gh-pages using github actions, simply chain the morsels tool on top of the static site generator output:</p>
<pre><code class="language-yml">name: docs
on:
  push:
    branches:
      - docs
jobs:
  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build documentation
        run: # &lt;insert your favourite ssg build command&gt;
      - name: Install Morsels
        run: cargo install morsels_indexer # or, using the binary release
      - name: Run Morsels
        run: morsels &lt;docs_build_folder&gt; &lt;docs_build_folder/morsels_output&gt; -c &lt;morsels_config_path&gt;
      - name: Deploy to github pages 🚀
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages
          folder: &lt;docs_build_folder&gt;
</code></pre>
<h2 id="custom-data-formats-non-html"><a class="header" href="#custom-data-formats-non-html">Custom Data Formats (non <code>.html</code>)</a></h2>
<p>Some use cases may not always have <code>.html</code> files readily available (e.g. pure client-side rendered ones) or in the right format.</p>
<p>In such cases, morsels also supports <code>.json</code> and <code>.csv</code> files, which is covered in greater detail later under <a href="./indexing_configuration.html">indexing configuration</a>.</p>
<p>Another simpler (but likely slow) alternative you could consider specifically for client-side rendered projects is to display the page in a headless browser, then index said html file.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="search-configuration"><a class="header" href="#search-configuration">Search Configuration</a></h1>
<p>All search time related options can be provided through the <code>initMorsels</code> function, exposed by <code>@morsels/search-ui</code>.</p>
<p>There are 2 categories of options, the first being related to the search library (<code>@morsels/search-lib</code>), and the second the user interface (<code>@morsels/search-ui</code>).</p>
<h2 id="forenote-on-mobile-device-detection"><a class="header" href="#forenote-on-mobile-device-detection">Forenote on Mobile Device Detection</a></h2>
<p>Several options in both the search library and UI are by default tuned based on whether the client is a mobile device.</p>
<p>Some examples of tuned settings for mobile devices:</p>
<ul>
<li>Query term proximity ranking is disabled</li>
<li>Whether to use the fullscreen version (more later) of the user interface instead</li>
</ul>
<p>The check is done through a simple <code>window.matchMedia('only screen and (max-width: 1024px)').matches</code> query at initialisation time, which may not be robust enough for your use case.</p>
<p>An override may be provided through the <code>isMobileDevice</code> option shown below, which is simply a function returning a boolean.</p>
<pre><code class="language-ts">initMorsels({
    isMobileDevice: () =&gt; true,
})
</code></pre>
<hr />
<h2 id="search-ui-options"><a class="header" href="#search-ui-options">Search UI Options</a></h2>
<p>Search UI options are organised under the <code>uiOptions</code> key:</p>
<pre><code class="language-ts">initMorsels({
    uiOptions: {
        // ... options go here ...
    }
})
</code></pre>
<p>For brevity, this page covers only a subset of the most important options.</p>
<p>The subsequent section on <a href="./search_configuration_renderers.html">renderers</a> provides a more advanced API to customise the html output. If you have a configuration use case that cannot be achieved without these APIs, and you think should be included as a simpler configuration option here, feel free to raise a feature request!</p>
<h3 id="input-element"><a class="header" href="#input-element">Input Element</a></h3>
<table><thead><tr><th>Option</th><th>Default Value</th><th>Description</th></tr></thead><tbody>
<tr><td><code>input</code></td><td><code>'morsels-search'</code></td><td>id of the input element or a html element reference</td></tr>
<tr><td><code>inputDebounce</code></td><td><code>100</code></td><td>debounce time of keystrokes to the input element</td></tr>
<tr><td><code>preprocessQuery</code></td><td><code>(q) =&gt; q</code></td><td>any function for preprocessing the query. Can be used to add a <a href="./search_features.html#field-search">field filter</a> for example.</td></tr>
</tbody></table>
<p>The <code>input</code> option is the most important option, and required in most use cases. Its purpose varies depending on the ui mode specified below.</p>
<h3 id="ui-mode"><a class="header" href="#ui-mode">UI Mode</a></h3>
<p><code>mode = 'auto'</code></p>
<p>The search UI provides 4 main different behaviours.</p>
<p>To try the different modes out, head on over to the <a href="./getting_started_mdbook.html#preview">mdbook plugin</a> page, which provides various buttons for switching the modes in this documentation.</p>
<table><thead><tr><th>Mode</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&quot;auto&quot;</code></td><td>This option is the <strong>default</strong>, and combines the <code>dropdown</code> and <code>fullscreen</code> options below. If a mobile device is detected as per the <a href="search_configuration.html#forenote-on-mobile-device-detection">earlier section</a>, the <code>fullscreen</code> mode is used. Otherwise, the <code>dropdown</code> mode is used.<br><br>A debounced window resize handler is also attached that reruns the mobile device check whenever the window is resized.</td></tr>
<tr><td><code>&quot;dropdown&quot;</code></td><td>This wraps the specified <code>input</code> element with a root container. Search results are displayed using an additional container attached to this root container.</td></tr>
<tr><td><code>&quot;fullscreen&quot;</code></td><td>This option creates a completely distinct root container with its own input element, and attaches it to the <code>&lt;body&gt;</code> element. Under the default stylesheet, the user interface is fullscreen for devices satisfying <code>max-width: 1025px</code>, and takes up roughly 50% - 75% of the screen otherwise.<br><br>If the <code>input</code> element is specified, the root container is attached whenever the <code>input</code> is focused.<br><br>Alternatively, one may use the <code>showFullscreen</code> and <code>hideFullscreen</code> functions returned by the <code>initMorsels</code> function to toggle the UI. This is also the only use case where you would not need to specify the <code>input</code> element.</td></tr>
<tr><td><code>&quot;target&quot;</code></td><td>This option is the most flexible, and is used by the mdbook plugin and this documentation by default. The <code>input</code> element must be specified, but only for attaching keystroke listeners. No dom manipulation is performed unlike the <code>dropdown</code> or <code>auto</code> modes.<br><br>The search results are output to a custom target element of choice.</td></tr>
</tbody></table>
<h4 id="ui-mode-specific-options"><a class="header" href="#ui-mode-specific-options">UI Mode Specific Options</a></h4>
<p>There are also several options specific to each UI. Note that <code>dropdown</code> and <code>fullscreen</code> options are both applicable to the <code>auto</code> mode.</p>
<table><thead><tr><th>Mode</th><th>Option</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>dropdown</code></td><td><code>dropdownAlignment</code></td><td><code>'bottom-end'</code></td><td><code>'bottom-start'</code> or <code>'bottom-end'</code>. Which side of the input element to align the dropdown results container and dropdown seperator against. The alignment of the dropdown container will be automatically flipped horizontally to ensure the most optimal size (see <a href="https://floating-ui.com/docs/size#using-with-flip">floating-ui</a> ’s docs for a demonstration).</td></tr>
<tr><td><code>fullscreen</code></td><td><code>fullscreenContainer</code></td><td><code>&lt;body&gt;</code> element</td><td>Id of the element, or an element reference to attach the separate root container to.</td></tr>
<tr><td><code>target</code></td><td><code>target</code></td><td>-</td><td>Id of the element, or an element reference to attach results to. Required if using <code>mode='target'</code>.</td></tr>
</tbody></table>
<h4 id="manually-showing--hiding-the-fullscreen-ui"><a class="header" href="#manually-showing--hiding-the-fullscreen-ui">Manually Showing / Hiding the Fullscreen UI</a></h4>
<pre><code class="language-ts">const { showFullscreen, hideFullscreen } = initMorsels(/* ... */);
</code></pre>
<p>The default behaviour of showing the fullscreen search UI when focusing the input may be insufficient, for example to show the UI when clicking a “search icon”.</p>
<p>You may call the <code>showFullscreen()</code> function returned by the initMorsels call in such a case for manual control. Correspondingly, the <code>hideFullscreen()</code> method hides the fullscreen interface, although, this shouldn’t be needed since a close button (or by pressing <code>esc</code>) is available by default.</p>
<p>These functions can also be used under <code>mode='auto'</code> if desired.</p>
<h3 id="options-for-generating-result-previews"><a class="header" href="#options-for-generating-result-previews">Options for Generating Result Previews</a></h3>
<p>There are 3 ways to generate result previews, the first of the below being the default.</p>
<p>Unless you have modified the default result renderer (covered in the next page on renderers), morsels requires <strong>at least</strong> one of the <code>body</code> / <code>heading</code> / <code>title</code> fields. This is configured by default, and covered in the next section on indexing configuration in more detail.</p>
<h3 id="default-rendering-output--purpose"><a class="header" href="#default-rendering-output--purpose">Default Rendering Output / Purpose</a></h3>
<p>The default result generation assumes the simple but common use case of <strong>linking to a source document</strong> (<code>&lt;a /&gt;</code> tag). </p>
<p>Therefore, source documents are assumed to be available. To generate alternative outputs (e.g. buttons, perform some action), you will need to use option 3 below.</p>
<h4 id="1-from-source-documents-default"><a class="header" href="#1-from-source-documents-default">1. From Source Documents (default)</a></h4>
<p><code>sourceFilesUrl</code></p>
<p>When option 2 below (field stores) is not configured or unavailable, morsels will attempt to fetch the source document from <strong><code>sourceFilesUrl</code> adjoined with the relative file path of the document</strong> at the time of indexing. The source document is then reparsed, and its fields are extracted again in order to generate result previews.</p>
<p>The <code>_relative_fp</code> field is an internally generated field that can be stored during indexing, and retrieved during search time. The combination of the base url from which to retrieve these source files (<code>sourceFilesUrl</code>) and this field forms the full source document link, used for:</p>
<ul>
<li>Attaching a link to the source document in the generated result match</li>
<li>Retrieving the source document</li>
</ul>
<p>Note that this option is only applicable for indexed html and json files at this time.</p>
<p>As csv files are often used to hold multiple documents (and can therefore get very large), it is unsuitable to be used as a source for search result previews. In this case, options 2 or 3 can be used.</p>
<h4 id="2-from-field-stores"><a class="header" href="#2-from-field-stores">2. From Field Stores</a></h4>
<p>If source documents are unavailable, morsels is able to generate result previews from its own json field stores generated at indexing time.</p>
<p>In order to specify what fields to store, take a look at the <code>do_store</code> option in this <a href="./indexing_configuration.html#fields_config">section</a> of the indexing configuration page. To use this method of result preview generation for the default use case / result rendering behaviour, enable the <code>do_store</code> option for the relevant fields.</p>
<p>You may also wish to use this method even if source documents are available, if filesystem bloat isn’t too much of a concern. Apart from avoiding the additional http requests, the internal json field store comes packed in a format that is more performant to perform result preview generation on.</p>
<h4 id="3-alternative-rendering-outputs-advanced"><a class="header" href="#3-alternative-rendering-outputs-advanced">3. Alternative Rendering Outputs (advanced)</a></h4>
<p>It is also possible to create your own result <a href="./search_configuration_renderers.html">renderer</a> to, for example:</p>
<ul>
<li>attach an event handler to call a function when a user clicks the result preview</li>
<li>retrieve and generate result previews from some other API.</li>
</ul>
<p>Nevertheless, the section <a href="search_configuration.html#from-field-stores">“From Field Stores”</a> above would still be relevant as it provides the basis for retrieving a document’s fields (e.g. a document id with which to call an API).</p>
<p>This is covered in more detail in the next page.</p>
<h3 id="results-per-page"><a class="header" href="#results-per-page">Results Per Page</a></h3>
<p><code>resultsPerPage = 8</code></p>
<p>In all UI modes, an infinite scrolling intersection observer is attached to the last search result, if any. When triggered, search result previews are fetched and/or generated for a number of these results only.</p>
<p>Lowering this can have a noticeable performance improvement on result generation, as more <code>.html / .json</code> files have to be retrieved on-the-fly, parsed, and processed. This is especially true if using option 1 above.</p>
<hr />
<h2 id="search-library-options"><a class="header" href="#search-library-options">Search Library Options</a></h2>
<p>The options for the search library are rather brief, and can be summarised in this snippet:</p>
<pre><code class="language-js">initMorsels({
    // Options belonging to @morsels/search-lib, the search library package
    searcherOptions: {
        // Base url of output directory that the cli tool generated
        url: 'http://192.168.10.132:3000/output/',
        
        // Maximum number of terms for query term expansion
        numberOfExpandedTerms: 3,
        
        // Override for using query term proximity ranking or not.
        // Disabled for mobile devices by default
        useQueryTermProximity: true,

        // Whether to retrieve all field stores on initialisation
        // (see chapter &quot;Tradeoffs&quot; for more details)
        cacheAllFieldStores: true,
    },
});
</code></pre>
<h3 id="automatic-term-expansion"><a class="header" href="#automatic-term-expansion">Automatic Term Expansion</a></h3>
<p><code>numberOfExpandedTerms</code></p>
<p>By default, stemming is turned off in the <a href="indexing_configuration.html#language">language modules</a>. This does mean a bigger dictionary (but not that much anyway), and lower recall, but much more precise searches.</p>
<p>To provide a compromise for recall, query terms that are similar to the searched term are added to the query, although with a lower weight.</p>
<p>For both of the <a href="./indexing_configuration.html#latin-tokenizer">language</a> modules available currently, this is only applied for the last query term, and if the query string does not end with a whitespace. An implicit wildcard (suffix) search is performed on this term. (quite similar to Algolia Docsearch’s behaviour)</p>
<h3 id="term-proximity-ranking"><a class="header" href="#term-proximity-ranking">Term Proximity Ranking</a></h3>
<p><code>useQueryTermProximity</code></p>
<p>If positions are indexed, document scores are also scaled by how close query expressions or terms are to each other.
This may be costly for mobile devices however, and is disabled by default in such cases.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="renderers"><a class="header" href="#renderers">Renderers</a></h1>
<style>
    .alert-warning {
        color: #856404;
        background-color: #fff3cd;
        border-color: #ffeeba;
    }
    .alert {
        position: relative;
        padding: 0.75rem 1.25rem;
        margin-bottom: 1rem;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }
</style>
<div class="alert alert-warning" role="alert">
  Certain parts of the APIs here (highlighted in <span style="color: red;">red</span>) may be particularly unstable still.
</div>
<p>This page covers the a more advanced API, “renderers”, that allows you to customise the html output structure to some degree.</p>
<p>Some use cases for this include:</p>
<ul>
<li>The default structure is not sufficient for your styling needs</li>
<li>You need to attach additional event listeners to elements</li>
<li>You want to override or insert additional content sourced from custom fields / static content (e.g. a footer)</li>
<li>You want to change the <a href="./search_configuration.html#default-rendering-output--purpose">default use case</a> of following through on a result preview to its source document entirely</li>
</ul>
<p>If you only need to style the dropdown or search popup, you can include your own css file to do so <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/styles/search.css">and / or override the variables</a> exposed by the default css bundle.</p>
<p>These API options are similarly specified under the <code>uiOptions</code> key of the root configuration object.</p>
<pre><code class="language-ts">initMorsels({
    uiOptions: {
        // ...
    }
});
</code></pre>
<p>As the interfaces are rather low level, this page will cross reference the <code>UiOptions</code> interface <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/SearchUiOptions.ts">specification</a> directly.</p>
<h2 id="the-h-function"><a class="header" href="#the-h-function">The <code>h</code> function</a></h2>
<p><code>h</code></p>
<p>Almost all renderer functions are passed a “<code>h</code>” function. This is an <strong>optional</strong> helper function you may use to create your own renderer.</p>
<p>The method signature is as such:</p>
<pre><code class="language-ts">export type CreateElement = (
  // Element name
  name: string,

  // Element attribute map
  attrs: { [attrName: string]: string },

  // Child elements (HTMLElement) OR text nodes (just put the string)
  // string parameters utilise .textContent,
  // so you don't have to worry about escaping potentially malicious content
  ...children: (string | HTMLElement)[]
) =&gt; HTMLElement;
</code></pre>
<h2 id="passing-custom-options"><a class="header" href="#passing-custom-options">Passing Custom Options</a></h2>
<p><code>opts</code></p>
<p>All renderer functions are also passed an <code>opts</code> parameter. This is the original input object that you provided to the <code>initMorsels</code> call. Default parameters are however populated at this point.</p>
<p>i.e.,</p>
<pre><code>opts = export interface SearchUiOptions {
  searcherOptions?: SearcherOptions,
  uiOptions?: UiOptions,
  isMobileDevice: () =&gt; boolean,
  otherOptions: ArbitraryOptions
}
</code></pre>
<p>If you want to include some custom options (e.g. an API base url) somehwere, you can use the <code>otherOptions</code> key, which is guaranteed to be untouched by morsels.</p>
<h2 id="default-html-output-structure"><a class="header" href="#default-html-output-structure">Default Html Output Structure</a></h2>
<p>You can have a look at the documentation further below on each API to understand each renderer, then refer back to the following output placement snippet to understand which renderers are responsible for which parts of the html output.</p>
<p>The output also varies depending on the <a href="./search_configuration.html#ui-mode">UI mode</a> specified earlier. As usual, note that <code>dropdown</code> and <code>fullscreen</code> modes both apply to the <code>auto</code> mode.</p>
<details>
<summary><strong>Renderers and their output placement</strong></summary>
<pre><code class="language-html">&lt;!--
    dropdownRootRender - mode: 'dropdown'
    fsRootRender       - mode: 'fullscreen'
 --&gt;

&lt;!--
    **fsRootRender** START
    root element is a backdrop to facilitate backdrop dismiss
--&gt;
&lt;div class=&quot;morsels-fs-backdrop&quot;&gt;
  
  &lt;!-- **dropdownRootRender** START --&gt;
  &lt;!-- fsRootRender has an additional &quot;morsels-fs-root&quot; class on this element --&gt;
  &lt;div class=&quot;morsels-root&quot;&gt;

    &lt;!-- these two elements are for dropdownRootRender only --&gt;
    &lt;input id=&quot;morsels-search&quot; placeholder=&quot;Search&quot;&gt;
    &lt;div class=&quot;morsels-input-dropdown-separator&quot; style=&quot;display: none;&quot;&gt;&lt;/div&gt;

    &lt;!--
        this element is for fsRootRender only,
        for wrapping search box &amp; close button in a sticky header
    --&gt;
    &lt;div class=&quot;morsels-fs-input-button-wrapper&quot;&gt;
        &lt;input class=&quot;morsels-fs-input&quot; type=&quot;text&quot;&gt;
        &lt;button class=&quot;morsels-input-close-fs&quot;&gt;&lt;/button&gt;
    &lt;/div&gt;

    &lt;ul class=&quot;morsels-list&quot; style=&quot;display: none;&quot;&gt;
    &lt;!--
        **dropdownRootRender / fsRootRender** END
        
        NOTE: If using mode = 'target', the above ul element is
              substituted for the target element you specify
    --&gt;

        &lt;!-- **noResultsRender** START --&gt;
        &lt;div class=&quot;morsels-no-results&quot;&gt;No results found&lt;/div&gt;
        &lt;!-- **noResultsRender** END --&gt;

        &lt;!-- **fsBlankRender** START
          Shown for the fullscreen version, when the search box is empty
          This is the shown text &quot;Start Searching Above!&quot; when the input is empty,
          implemented inside a ::before pseudo class for easy overriding.
        --&gt;
        &lt;div class=&quot;morsels-fs-blank&quot;&gt;&lt;/div&gt;
        &lt;!-- **fsBlankRender** END --&gt;

        &lt;!--
          **loadingIndicatorRender** START (blank by default)

          Shown when making the initial search from a blank search box.
          Subsequent searches (ie. when there are some results already)
          will not show this indicator.
        --&gt;
        &lt;span class=&quot;morsels-loading-indicator&quot;&gt;&lt;/span&gt;
        &lt;!-- **loadingIndicatorRender** END --&gt;

        &lt;!-- **termInfoRender** START (intentionally blank by default) --&gt;
        &lt;div&gt;&lt;/div&gt;
        &lt;!-- **termInfoRender** END --&gt;

        &lt;!-- results placeholder (refer to &quot;rendering search results&quot;) --&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
</details>
<p>You can find the latest default implementations of the renderers <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/search.ts">here</a>.</p>
<h2 id="root-elements"><a class="header" href="#root-elements">Root Elements</a></h2>
<h3 id="dropdown"><a class="header" href="#dropdown">Dropdown</a></h3>
<p><code>dropdownRootRender(h, opts, inputEl): { root: HTMLElement, listContainer: HTMLElement }</code></p>
<p>This API renders the root element for the <strong>dropdown version</strong> of the user interface.</p>
<ul>
<li><code>inputEl</code>: Input element found by the <code>input</code> configuration option</li>
</ul>
<p>It should return 2 elements:</p>
<ul>
<li><code>root</code>: The root element. This is passed to the <code>hide / show</code> APIs below.</li>
<li><code>listContainer</code>: The element to attach elements rendered by <code>listItemRender</code> (matches for a single document) to.
<ul>
<li>in the above snippet, this is the <code>&lt;ul class=&quot;morsels-list&quot;&gt;&lt;/ul&gt;</code> element</li>
</ul>
</li>
</ul>
<h4 id="supplementary-mandatory-functions"><a class="header" href="#supplementary-mandatory-functions">Supplementary Mandatory Functions</a></h4>
<p>The following two functions should be implemented <strong>in tandem</strong> with the above function; They are used internally to show / hide the dropdown on certain events (for example, on input focus / blur).</p>
<p><code>showDropdown?: (root: HTMLElement, opts: SearchUiOptions) =&gt; void</code></p>
<p><code>hideDropdown?: (root: HTMLElement, opts: SearchUiOptions) =&gt; void</code></p>
<p>For example, the default <code>showDropdown</code> implementation is as such:</p>
<pre><code class="language-ts">(root, listContainer) =&gt; {
  if (listContainer.childElementCount) {
    listContainer.style.display = 'block';
    (listContainer.previousSibling as HTMLElement).style.display = 'block';
  }
}
</code></pre>
<p>It first checks if the <code>listContainer</code> (the dropdown), which contains result matches, has any child elements. If so, it sets <code>style=display:block;</code> on it, and its previous sibling, which is the triangle dropdown separator container.</p>
<h3 id="fullscreen"><a class="header" href="#fullscreen">Fullscreen</a></h3>
<p><code>fsRootRender(h, opts, fsCloseHandler): { root: HTMLElement, listContainer: HTMLElement, input: HTMLInputElement }</code></p>
<p>This API renders the root element for the <strong>fullscreen version</strong> of the user interface.</p>
<ul>
<li><code>fsCloseHandler</code>: A void function used for closing the fullscreen UI. This may also be used to check if the current render is for the fullscreen UI or dropdown UI.</li>
</ul>
<p>It should return 3 elements:</p>
<ul>
<li><code>root</code>: The root element. This is passed to the <code>hide / show</code> APIs below.</li>
<li><code>listContainer</code>: The element to attach elements rendered by <code>listItemRender</code> (matches for a single document) to.</li>
<li><code>input</code>: Input element. This is required for morsels to attach input event handlers.</li>
</ul>
<h4 id="supplementary-mandatory-functions-1"><a class="header" href="#supplementary-mandatory-functions-1">Supplementary Mandatory Functions</a></h4>
<p>Similarly, there are two <code>show / hide</code> variants for the fullscreen version:</p>
<pre><code class="language-ts">showFullscreen?: (
  root: HTMLElement,
  listContainer: HTMLElement,
  fullscreenContainer: HTMLElement,
  opts: SearchUiOptions,
) =&gt; void,

hideFullscreen?: (
  root: HTMLElement,
  listContainer: HTMLElement,
  fullscreenContainer: HTMLElement,
  opts: SearchUiOptions
) =&gt; void,
</code></pre>
<p>The <code>fullscreenContainer</code> (by default the <code>&lt;body&gt;</code> element) to which to append the root element is also provided. You may also want to for example, refocus the fullscreen version’s <code>&lt;input&gt;</code> element once UI is shown.</p>
<h3 id="target"><a class="header" href="#target">Target</a></h3>
<p>There is no root element for the target, as it is specified by the <code>target</code> option. The equivalent of the <code>target</code> element would be the <code>listContainer</code> element for the dropdown / fullscreen versions  above.</p>
<h2 id="miscellaneous-renderers"><a class="header" href="#miscellaneous-renderers">Miscellaneous Renderers</a></h2>
<table><thead><tr><th>Function</th><th>Return</th><th>Description</th></tr></thead><tbody>
<tr><td><code>noResultsRender(h, opts)</code></td><td><code>HTMLElement</code></td><td>This API renders the element attached under the <code>listContainer</code> (or the target element when using <code>mode = 'target'</code>) when there are no results found for a given query.                                                                                     </td></tr>
<tr><td><code>loadingIndicatorRender(h, opts)</code></td><td><code>HTMLElement</code></td><td>This API renders the loading indicator attached under the <code>listContainer</code>. The loading indicator is shown when making the initial search (the first search from an empty search box).</td></tr>
<tr><td><code>termInfoRender(h, opts, queryParts: QueryPart[])</code></td><td><code>HTMLElement[]</code></td><td>This API renders element(s) attached under the <code>listContainer</code> related to the searched terms, and is blank by default.<br><br>This can be used to render messages like “<em>Did you mean <u>spelling</u>?</em> “.</td></tr>
<tr><td><code>fsBlankRender(h, opts)</code><br><br>( <code>mode='fullscreen'</code> only )</td><td><code>HTMLElement</code></td><td>This API renders the element attached under the <code>listContainer</code> when the search box is empty for the fullscreen UI.<br><br>This contrasts with the dropdown UI which is hidden in such a case.</td></tr>
</tbody></table>
<h3 id="queryparts-parameter"><a class="header" href="#queryparts-parameter"><code>queryParts</code> Parameter</a></h3>
<p>This parameter to the <code>termInfoRender</code> function is the parsed structure of the input query string.</p>
<p>Its interface is as follows:</p>
<pre><code class="language-ts">export interface QueryPart {
  partType: 'TERM' | 'PHRASE' | 'BRACKET' | 'AND' | 'NOT';

  // Raw, original term(s) contained, if any of the below 3 operations were applied
  originalTerms?: string[];

  isCorrected?: boolean;        // did this query part undergo spelling correction?
  isStopWordRemoved?: boolean;  // did this query part undergo stop word removal?
  isExpanded?: boolean;         // is this an added / expanded term?

  shouldExpand?: boolean;       // was this term a source for query term expansion?

  fieldName?: string;           // was a field filter applied?

  // Spelling corrected / Expanded / Stop word removed result
  terms?: string[];

  children?: QueryPart[];
}
</code></pre>
<h2 id="rendering-search-results"><a class="header" href="#rendering-search-results">Rendering Search Results</a></h2>
<p>The below <strong>2 remaining sets of APIs</strong> render the results for all document matches, and are <strong>mutually exclusive</strong> in that the second set of APIs are “building blocks” of the first (which only has one available API). So, reconfiguring the first API would invalidate any changes to the second.</p>
<p>Together, they are placed in the <code>&lt;!-- results placeholder (refer to &quot;rendering search results&quot;) --&gt;</code> comment earlier (see <a href="search_configuration_renderers.html#default-html-output-structure">html output structure</a>).</p>
<p>In the following snippet, APIs belonging to the first / second are annotated with <code>1.</code> &amp; <code>2.</code>.</p>
<details open>
<summary><strong>Remaining renderers and their output placement</strong></summary>
<pre><code class="language-html">&lt;!--
  **1. resultsRender** START matches for all documents
  **2. listItemRender** START A match for a single document
--&gt;
&lt;li class=&quot;morsels-list-item&quot;&gt;
  &lt;a class=&quot;morsels-link&quot; href=&quot;http://192.168.10.132:3000/...truncated.../index.html&quot;&gt;

    &lt;div class=&quot;morsels-title&quot;&gt;
      &lt;span&gt;
        This is the Document Title Extracted from the &quot;title&quot; Field
      &lt;/span&gt;
    &lt;/div&gt;

    &lt;!--
      **headingBodyRender** START
      a heading and/or body field pair match for the document
    --&gt;
    &lt;a class=&quot;morsels-heading-body&quot; href=&quot;http://192.168.10.132:3000/...truncated.../index.html#what&quot;&gt;
      &lt;!-- Sourced from the &quot;heading&quot; field --&gt;
      &lt;div class=&quot;morsels-heading&quot;&gt;&lt;span&gt;What&lt;/span&gt;&lt;/div&gt;
      &lt;div class=&quot;morsels-bodies&quot;&gt;
        &lt;!--
          The text under the following element is sourced from
          the &quot;body&quot; field, that follows the &quot;heading&quot; field above
          in the original document.

          Refer to the section on indexing configuration for more details.
        --&gt;
        &lt;div class=&quot;morsels-body&quot;&gt;
          &lt;!-- (the query here is &quot;foo bar&quot;) --&gt;
          &lt;span class=&quot;morsels-ellipsis&quot;&gt;&lt;/span&gt;

          &lt;span&gt; this is text before the first highlighted term &lt;/span&gt;
          &lt;!-- **highlightRender** START  --&gt;
          &lt;span class=&quot;morsels-highlight&quot;&gt;&lt;span&gt;foo&lt;/span&gt;&lt;/span&gt;
          &lt;!-- **highlightRender** END --&gt;
          &lt;span&gt; this is some text after the first highlighted term&lt;/span&gt;


          &lt;span class=&quot;morsels-ellipsis&quot;&gt;&lt;/span&gt;


          &lt;span&gt; this is text before the second highlighted term&lt;/span&gt;
          &lt;!-- **highlightRender** START --&gt;
          &lt;span class=&quot;morsels-highlight&quot;&gt;&lt;span&gt;bar&lt;/span&gt;&lt;/span&gt;
          &lt;!-- **highlightRender** END --&gt;
          &lt;span&gt; this is some text after the second highlighted term&lt;&lt; /span&gt;

          &lt;span class=&quot;morsels-ellipsis&quot;&gt;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/a&gt;
    &lt;!-- **headingBodyRender** END --&gt;

    &lt;!--
      **bodyOnlyRender** START
      a body-only field match for the document
      (no heading before it in the original document)
    --&gt;
    &lt;div class=&quot;morsels-body&quot;&gt;
      &lt;span class=&quot;morsels-ellipsis&quot;&gt;&lt;/span&gt;
      &lt;span&gt;&lt;/span&gt;
      &lt;!-- **highlightRender** START --&gt;
      &lt;span class=&quot;morsels-highlight&quot;&gt;&lt;span&gt;foo&lt;/span&gt;&lt;/span&gt;
      &lt;!-- **highlightRender** END --&gt;
      &lt;span class=&quot;morsels-ellipsis&quot;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;!-- **bodyOnlyRender** END --&gt;
  &lt;/a&gt;
&lt;/li&gt;
&lt;!-- **listItemRender** END --&gt;

&lt;!--
    ... Repeat (another search result) ...

    Note: an IntersectionObserver is attached to the
    last such &lt;li&gt; element for infinite scrolling
--&gt;
&lt;li class=&quot;morsels-list-item&quot;&gt;&lt;/li&gt;
&lt;!-- **resultsRender** END --&gt;
</code></pre>
</details>
<br>
<h3 id="1-rendering-all-results"><a class="header" href="#1-rendering-all-results">1. Rendering All Results</a></h3>
<p><code>async resultsRender(h, opts, config, results, query): Promise&lt;HTMLElement[]&gt;</code></p>
<p><span style="color: red;">(flexible but not too well documented yet, and may be unstable)</span></p>
<p>This API renders the results for <em>all</em> document matches.</p>
<p>Some examples use cases are:</p>
<ul>
<li>Altering the html output structure substantially (e.g. displaying results in a tabular form)</li>
<li>Calling external API calls to retrieve additional info for generating result previews.
<ul>
<li>For this reason, this is also the only <code>async</code> API</li>
</ul>
</li>
</ul>
<p>For example, the default implementation does the following:</p>
<ol>
<li>Check the <code>config.fieldInfos</code> if any of <code>body / title / heading</code> fields are stored by the indexer to generate result previews. (Skip to 3 if present)</li>
<li>If the document has the internal <code>_relative_fp</code> field and <code>sourceFilesUrl</code> is specified, retrieve the original document (<code>html</code> or <code>json</code>), and transform it into the same format as that generated by the indexer.</li>
<li>Transform and highlight the field stores using the <code>listItemRender</code> set of APIs below.</li>
</ol>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><code>config</code></td><td>This is the <strong>indexing</strong> configuration object.</td></tr>
<tr><td><code>results</code></td><td>an array of <code>Result</code> objects</td></tr>
<tr><td><code>query</code></td><td>a <code>Query</code> object</td></tr>
</tbody></table>
<p>You may also refer to the default implementation <a href="https://github.com/ang-zeyu/morsels/blob/main/packages/search-ui/src/searchResultTransform.ts#L369">here</a> to get an idea of how to use the API.</p>
<h3 id="2-rendering-a-single-result"><a class="header" href="#2-rendering-a-single-result">2. Rendering a Single Result</a></h3>
<p>The renderers under this key <strong>build up the default implementation of <code>resultsRender</code></strong>, and are grouped under <code>uiOptions.resultsRenderOpts</code> (instead of <code>uiOptions.XXX</code>).
If overriding <code>resultsRender</code> above, the following options will be ignored.</p>
<p>These APIs are more suited for performing smaller modifications for the default use case, for example, displaying an additionally indexed field (e.g. an icon).</p>
<div style="height:1px"></div>
<p><code>listItemRender(h, opts, fullLink, resultTitle, resultHeadingsAndTexts, fields): HTMLElement</code></p>
<p>This API renders the result for a single document match.</p>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td><code>fullLink</code></td><td>full resource link of the document</td></tr>
<tr><td><code>resultTitle</code></td><td>the first extracted <code>title</code> field of the document, if any</td></tr>
<tr><td><code>resultHeadingsAndTexts</code></td><td>An array of <code>string</code> or <code>HTMLElement</code> intended to be used as the last parameter of <code>h</code>.<br><br>This contains the highlighted heading-body pair matches, or body-only matches rendered from <code>headingBodyRender</code> and <code>bodyOnlyRender</code> further below.</td></tr>
<tr><td><code>fields</code></td><td>All stored fields for the document, as positioned <code>[fieldName, fieldValue]</code> pairs. Useful if adding additional fields.</td></tr>
</tbody></table>
<p>The following example shows the default implementation, and how to add an additional field, <code>subtitle</code>, to each result.</p>
<pre><code class="language-ts">const subTitleField = fields.find(field =&gt; field[0] === 'subtitle');

const linkEl = h(
  'a', { class: 'morsels-link' },
  h('div', { class: 'morsels-title' }, title,
    h('div', { class: 'morsels-subtitle' }, (subTitleField &amp;&amp; subTitleField[1]) || '')
  ),
  ...bodies
);

if (fullLink) {
  linkEl.setAttribute('href', fullLink);
}

return h(
  'li', { class: 'morsels-list-item' },
  linkEl,
);
</code></pre>
<h4 id="21-listitemrender-supporting-apis"><a class="header" href="#21-listitemrender-supporting-apis">2.1 <code>listItemRender</code> supporting APIs</a></h4>
<p>The remaining 3 APIs below are supplementary to <code>listItemRender</code>, and are responsible for generating the <code>resultTitle</code> and <code>resultHeadingsAndTexts</code> parameters for <code>listItemRender</code>.</p>
<p>Refer to the html snippet above and annotations below to understand which APIs are responsible for which parts.</p>
<pre><code class="language-ts">interface SearchUiRenderOptions {
  // Renders a &quot;heading&quot; field,
  // along with the highlighted &quot;body&quot; fields that follow it (in document order)
  headingBodyRender?: (
    h: CreateElement,

    // Heading text
    heading: string,    

    // The highlighted elements under .morsels-body. Intended to be used with the 'h' function.
    bodyHighlights: (HTMLElement | string)[], 

    // Url of the document + The matching heading's id, if any
    href?: string                             
  ) =&gt; HTMLElement,


  // Renders highlighted &quot;body&quot; fields without a heading preceding it
  bodyOnlyRender?: (
    h: CreateElement,

    // The highlighted elements under .morsels-body. Intended to be used with the 'h' function.
    bodyHighlights: (HTMLElement | string)[], 
  ) =&gt; HTMLElement,


  highlightRender?: (
    h: CreateElement,

    // matched term
    matchedPart: string,                      
  ) =&gt; HTMLElement,
}
</code></pre>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="indexer-configuration"><a class="header" href="#indexer-configuration">Indexer Configuration</a></h1>
<p>All indexer configurations are sourced from a json file. By default, the cli tool looks for <code>morsels_config.json</code> in the source folder (first argument specified in the command).</p>
<p>You can run the cli command with the <code>--init</code> option to initialise the default configuration file in the source folder.</p>
<h2 id="fields_config"><a class="header" href="#fields_config"><code>fields_config</code></a></h2>
<p>The first step to indexing any documents is defining the field configurations.</p>
<p>The default configurations are as follows, already setup for interfacing with the <code>@morsels/search-ui</code> package.</p>
<pre><code class="language-json">{
  &quot;fields_config&quot;: {
    &quot;cache_all_field_stores&quot;: false,
    &quot;field_store_block_size&quot;: 250,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;title&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.2,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.25
      },
      {
        &quot;name&quot;: &quot;heading&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.3,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.3
      },
      {
        &quot;name&quot;: &quot;body&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.5,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;headingLink&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      // Internal, hardcoded field sourced from the
      // relative file path of the file from the root directory
      //
      // Required for the default search ui preview generation methods
      // (see &quot;Generating Result Previews&quot; under search configuration)
      //
      // Nonetheless, if omitted, the field will not be stored.
      {
        &quot;name&quot;: &quot;_relative_fp&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      }
    ]
  }
}
</code></pre>
<p><strong><code>field_store_block_size</code> and <code>do_store</code></strong></p>
<p>Morsels stores fields that have <code>do_store: true</code> specified in the field configuration into a json file in the output folder.</p>
<p>At search time, the fields saved in this manner from the json files are retrieved as-is.</p>
<p>The <code>field_store_block_size</code> parameter controls how many documents to store in one such json file. Batching multiple files together if the fields stored are small can lead to less files and better browser caching.</p>
<blockquote>
<p>⚠️ Ensure <code>field_store_block_size</code> is a clean multiple or divisor of the <code>num_docs_per_block</code> parameter elaborated further below.<br>
This is a rather arbitiary limitation chosen to reduce the field store indexing scheme complexity,
but should work well enough for most use cases.</p>
</blockquote>
<p><strong><code>cache_all_field_stores</code></strong></p>
<p>This is the same as the configuration option under <a href="search_configuration.html#search-library-options">search configuration</a>.
If both are specified, the value specified in the <code>initMorsels</code> call will take priority.</p>
<p>All fields specified with <code>do_store=true</code> would be cached up front on initialisation of the search library.</p>
<p>Its usage alongside other options is discussed in more detail under the chapter <a href="./tradeoffs.html">Tradeoffs</a>.</p>
<p><strong><code>weight</code></strong></p>
<p>This parameter simply specifies the weight the field should have during scoring.</p>
<p>Specifying <code>0.0</code> will result in the field not being indexed (although, it can still be stored for retrieval using <code>do_store</code>).</p>
<p><strong><code>k</code> &amp; <code>b</code></strong></p>
<p>These are Okapi BM25 model parameters. The following <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/pluggable-similarites.html#bm25-tunability">article</a> provides a good overview on how to configure these, although, the defaults should serve sufficiently.</p>
<div style="display: none;">
<p><strong><code>type</code> (WIP)</strong></p>
<p>The only available types are <code>string</code> and <code>u32</code>.</p>
<p>This only affects how the fields are stored when the <code>do_store</code> parameter is specified (but not the indexing process).</p>
<p><code>string</code> fields are stored in the manner illustrated above.</p>
<p><code>u32</code> fields however are stored monolithically in a single file, for the purpose of fast random access.</p>
<p>Moreover, sorting (also WIP) operations are only supported on <code>u32</code> fields.</p>
</div>
<h3 id="special-fields"><a class="header" href="#special-fields">Special Fields</a></h3>
<p><strong><code>_relative_fp</code></strong></p>
<p>This is a “hardcoded” field generated by the indexer, in that its value is fixed as the relative file path from your source folder path to the file.</p>
<p>It is included in the default configuration to allow <code>@morsels/search-ui</code> to retrieve the source file for result preview generation, and to link to the document itself (via an <code>&lt;a&gt;&lt;/a&gt;</code> tag). You may refer back to <a href="./search_configuration.html#options-for-generating-result-previews">this section</a> for more details.</p>
<p>If this is removed, this field simply won’t be indexed nor stored.</p>
<h2 id="lang_config"><a class="header" href="#lang_config"><code>lang_config</code></a></h2>
<p>The snippet below shows the default values for language configuration. The key controlling the main tokenizer module to use is the <code>lang</code> key, while the <code>options</code> key supplies tokenization options unique to each module.</p>
<p>These options are also applied to <code>@morsels/search-ui</code>, which sources this information from the index output directory as specified in the <code>initMorsels</code> call.</p>
<pre><code class="language-json">{
  &quot;lang_config&quot;: {
    &quot;lang&quot;: &quot;latin&quot;,
    &quot;options&quot;: null
  }
}
</code></pre>
<h3 id="forenote-on-stop-words"><a class="header" href="#forenote-on-stop-words">Forenote on Stop Words</a></h3>
<p>A slightly different approach with stop words is taken <strong>by default</strong> in that stop words are only filtered at <strong>query time</strong> for certain types of queries (currently this is for free-text queries with more than two terms).</p>
<p>This is because splitting up the index means that we are already able to put each of such commonly occuring words into one file, so, information for stop words is never requested unless necessary:</p>
<ul>
<li>For processing phrase queries (eg. <code>&quot;for tomorrow&quot;</code>)</li>
<li>Boolean queries (eg. <code>if AND forecast AND sunny</code>)</li>
<li>One or two term free text queries containing stop words only. This is an unlikely use case, but it is nice having some results show up than none.</li>
</ul>
<p>Nevertheless, all tokenizers also support forcibly removing stop words using the <code>ignore_stop_words</code> option, should you wish to keep the index size down (discussed again under chapter on <a href="./tradeoffs.html">“Tradeoffs”</a>).</p>
<h3 id="ascii-tokenizer"><a class="header" href="#ascii-tokenizer">Ascii Tokenizer</a></h3>
<p>The default tokenizer splits on sentences, then whitespaces to obtain tokens.</p>
<p>An <a href="https://github.com/tantivy-search/tantivy/blob/main/src/tokenizer/ascii_folding_filter.rs">asciiFoldingFilter</a> is then applied to these tokens, followed by punctuation and non-word boundary removal.</p>
<pre><code class="language-json">&quot;lang_config&quot;: {
  &quot;lang&quot;: &quot;latin&quot;,
  &quot;options&quot;: {
    &quot;stop_words&quot;: [
      &quot;a&quot;, &quot;an&quot;, &quot;and&quot;, &quot;are&quot;, &quot;as&quot;, &quot;at&quot;, &quot;be&quot;, &quot;but&quot;, &quot;by&quot;, &quot;for&quot;,
      &quot;if&quot;, &quot;in&quot;, &quot;into&quot;, &quot;is&quot;, &quot;it&quot;, &quot;no&quot;, &quot;not&quot;, &quot;of&quot;, &quot;on&quot;, &quot;or&quot;,
      &quot;such&quot;, &quot;that&quot;, &quot;the&quot;, &quot;their&quot;, &quot;then&quot;, &quot;there&quot;, &quot;these&quot;,
      &quot;they&quot;, &quot;this&quot;, &quot;to&quot;, &quot;was&quot;, &quot;will&quot;, &quot;with&quot;
    ],
    &quot;ignore_stop_words&quot;: false,

    &quot;max_term_len&quot;: 80
  }
}
</code></pre>
<h3 id="latin-tokenizer"><a class="header" href="#latin-tokenizer">Latin Tokenizer</a></h3>
<p>This is essentially the same as the ascii tokenizer, but adds a <code>stemmer</code> option.</p>
<pre><code>&quot;lang_config&quot;: {
  &quot;lang&quot;: &quot;latin&quot;,
  &quot;options&quot;: {
    // ----------------------------------
    // Ascii Tokenizer options also apply
    // ...
    // ----------------------------------

    // Any of the languages here
    // https://docs.rs/rust-stemmers/1.2.0/rust_stemmers/enum.Algorithm.html
    // For example, &quot;english&quot;
    &quot;stemmer&quot;: &quot;english&quot;
  }
}
</code></pre>
<p>It is separated from the ascii tokenizer to reduce binary size (about ~<code>220KB</code> savings before gzip).</p>
<h3 id="chinese-tokenizer"><a class="header" href="#chinese-tokenizer">Chinese Tokenizer</a></h3>
<p>A basic <code>chinese</code> tokenizer based on <a href="https://github.com/messense/jieba-rs">jieba-rs</a> is also available, although, it is still a heavy WIP at the moment. Use at your own discretion.</p>
<p>This tokenizer applies jieba’s <code>cut</code> method to obtain various tokens, then applies a punctuation filter to these tokens. Thereafter, tokens are grouped into sentences.</p>
<pre><code class="language-json">&quot;lang_config&quot;: {
  &quot;lang&quot;: &quot;chinese&quot;,
  &quot;options&quot;: {
    &quot;stop_words&quot;: [],
    &quot;ignore_stop_words&quot;: false
  }
}
</code></pre>
<h3 id="remark-on-language-modules-flexibility"><a class="header" href="#remark-on-language-modules-flexibility">Remark on Language Modules’ Flexibility</a></h3>
<p>While using the same tokenizer for both indexing / search unifies the codebase, one downside is that code size has to be taken into account.</p>
<p>The chinese tokenizer for example, which uses <em>jieba-rs</em>, accounts for half of the wasm binary size alone.</p>
<p>Therefore, the tokenizers will aim to be reasonably powerful and configurable enough, such that the wasm bundle size dosen’t blow up.</p>
<p>Nonetheless, if you feel that a certain configuration option should be supported for a given tokenizer but isn’t, feel free to open up an issue!</p>
<h2 id="indexing_config"><a class="header" href="#indexing_config"><code>indexing_config</code></a></h2>
<p>The configurations in this section specify <strong>how and which</strong> files to index.</p>
<p>All configurations are optional (reasonable defaults provided otherwise), save for the <code>loader_configs</code> key. The cli tool <strong>will do nothing</strong> if no loaders are specified.</p>
<p>The snippet below shows the default values, which need not be altered if you are only indexing html files.</p>
<pre><code class="language-json">{
  &quot;indexing_config&quot;: {
    // Number of threads excluding the main thread
    &quot;num_threads&quot;: 5,      // when unspecified, this is max(num physical cores - 1, 1)

    // This roughly controls the memory usage of the indexer
    // If your documents are very small,
    // increasing this *may* help improve indexing performance.
    &quot;num_docs_per_block&quot;: 1000,

    // glob patterns to exclude from indexing
    &quot;exclude&quot;: [
      &quot;morsels_config.json&quot;
    ],

    // Specifies what types of files to index
    &quot;loader_configs&quot;: {
      &quot;HtmlLoader&quot;: {}     // enables support for .html files
    },
    
    // The threshold (in bytes) at which to &quot;cut&quot; index files
    //
    // Increasing this produces less but bigger files
    // (which may take longer to retrieve), and vice versa.
    
    &quot;pl_limit&quot;: 16383,

    // Any index files above this size (in bytes)
    // will be pre-loaded on initialisation of the search library
    &quot;pl_cache_threshold&quot;: 1048576,
    
    // Number of index files (&quot;morsels&quot;) to store per directory
    &quot;num_pls_per_dir&quot;: 1000,

    // Number of field stores (`.json` files) to store per directory
    &quot;num_stores_per_dir&quot;: 1000,

    // Whether positions will be stored.
    //
    // Phrase queries and Query Term Proximity Ranking
    // will be unavailable if this is false.
    //
    // You may want to turn this off for very large collections. (~&gt; 1GB)
    &quot;with_positions&quot;: true
  }
}
</code></pre>
<h3 id="loaders"><a class="header" href="#loaders">Loaders</a></h3>
<p>The indexer is able to handle html, json or csv files. Support for each file type is provided by a “<code>Loader</code>” abstraction.</p>
<p>You may configure loaders by including them under the <code>loader_configs</code> key, with any applicable options.</p>
<p>The below sections shows the available loaders and configuration options available for each of them.</p>
<p><strong><code>HtmlLoader</code></strong></p>
<pre><code class="language-json">{
  &quot;HtmlLoader&quot;: {
    // list of selectors to exclude from indexing
    &quot;exclude_selectors&quot;: [
      &quot;script,style&quot;
    ],
    &quot;selectors&quot;: [
      {
        &quot;attr_map&quot;: {},
        &quot;field_name&quot;: &quot;title&quot;,
        &quot;selector&quot;: &quot;title&quot;
      },
      {
        &quot;attr_map&quot;: {},
        &quot;field_name&quot;: &quot;body&quot;,
        &quot;selector&quot;: &quot;body&quot;
      },
      {
        &quot;attr_map&quot;: {
          &quot;id&quot;: &quot;headingLink&quot; // &quot;store the id attribute under headingLink&quot;
        },
        &quot;field_name&quot;: &quot;heading&quot;,
        &quot;selector&quot;: &quot;h1,h2,h3,h4,h5,h6&quot;
      }
    ]
  }
}
</code></pre>
<p>The html loader traverses the document depth-first.</p>
<p>At each element, it checks if any of the selectors under the <code>selectors.selector</code> key matches the element. If so, all descendants (elements, text) under this element will then be indexed under the field specified by <code>field_name</code>. If one the element’s descendants matched another selector however, the configuration is then overwritten for that descendant (and its descendants).</p>
<p>The <code>attr_map</code> allows indexing attributes of elements (not including descendants) under fields as well.</p>
<p><strong><code>JsonLoader</code></strong></p>
<pre><code class="language-json">{
  &quot;JsonLoader&quot;: {
    &quot;field_map&quot;: {
      &quot;body&quot;: &quot;body&quot;,
      &quot;heading&quot;: &quot;heading&quot;,
      &quot;link&quot;: &quot;_relative_fp&quot;,
      &quot;title&quot;: &quot;title&quot;
    },
    // Order in which to index the fields of the json {} document
    &quot;field_order&quot;: [
      &quot;title&quot;,
      &quot;heading&quot;,
      &quot;body&quot;,
      &quot;link&quot;
    ]
  }
}
</code></pre>
<p>Json files can also be indexed. To do this, the <code>field_map</code> key must be specified, which contains a mapping of <strong>json key -&gt; field name</strong>.
The <code>field_order</code> controls in which order these fields are indexed, which can influence position based functions such as query term proximity ranking.</p>
<p>The json files itself can be either</p>
<ol>
<li>An object, following the schema set out in <code>field_map</code></li>
<li>An array of objects following the schema set out in <code>field_map</code></li>
</ol>
<p><strong><code>CsvLoader</code></strong></p>
<pre><code class="language-json">{
  &quot;CsvLoader&quot;: {
    &quot;use_headers&quot;: false,
    &quot;header_field_map&quot;: {},
    &quot;header_field_order&quot;: [],
    &quot;index_field_map&quot;: {
      &quot;0&quot;: &quot;link&quot;,
      &quot;1&quot;: &quot;title&quot;,
      &quot;2&quot;: &quot;body&quot;,
      &quot;4&quot;: &quot;heading&quot;
    },
    &quot;index_field_order&quot;: [
      1,
      4,
      2,
      0
    ],
    &quot;parse_options&quot;: {
      &quot;comment&quot;: null,
      &quot;delimiter&quot;: 44,
      &quot;double_quote&quot;: true,
      &quot;escape&quot;: null,
      &quot;has_headers&quot;: true,
      &quot;quote&quot;: 34
    }
  }
}
</code></pre>
<p>Field mappings for csv can be configured using one of the <code>field_map / field_order</code> key pairs. The <code>use_headers</code> parameter specifies which of the two pairs of settings to use.</p>
<h2 id="full-example"><a class="header" href="#full-example">Full Example</a></h2>
<pre><code class="language-json">{
  &quot;fields_config&quot;: {
    &quot;field_store_block_size&quot;: 250,
    &quot;fields&quot;: [
      {
        &quot;name&quot;: &quot;title&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.2,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.25
      },
      {
        &quot;name&quot;: &quot;heading&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.3,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.3
      },
      {
        &quot;name&quot;: &quot;body&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.5,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;headingLink&quot;,
        &quot;do_store&quot;: false,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      },
      {
        &quot;name&quot;: &quot;_relative_fp&quot;,
        &quot;do_store&quot;: true,
        &quot;weight&quot;: 0.0,
        &quot;k&quot;: 1.2,
        &quot;b&quot;: 0.75
      }
    ]
  },
  &quot;lang_config&quot;: {
    &quot;lang&quot;: &quot;latin&quot;,
    &quot;options&quot;: null
  },
  &quot;indexing_config&quot;: {
    &quot;num_docs_per_block&quot;: 1000,
    &quot;pl_limit&quot;: 16383,
    &quot;pl_cache_threshold&quot;: 1048576,
    &quot;exclude&quot;: [
      &quot;morsels_config.json&quot;
    ],
    &quot;loader_configs&quot;: {
      &quot;HtmlLoader&quot;: {
        &quot;exclude_selectors&quot;: [
          &quot;.no-index&quot;
        ]
      },
      &quot;JsonLoader&quot;: {
        &quot;field_map&quot;: {
          &quot;body&quot;: &quot;body&quot;,
          &quot;heading&quot;: &quot;heading&quot;,
          &quot;link&quot;: &quot;_relative_fp&quot;,
          &quot;title&quot;: &quot;title&quot;
        },
        &quot;field_order&quot;: [
          &quot;title&quot;,
          &quot;heading&quot;,
          &quot;body&quot;,
          &quot;link&quot;
        ]
      }
    },
    &quot;pl_names_to_cache&quot;: [],
    &quot;num_pls_per_dir&quot;: 1000,
    &quot;num_stores_per_dir&quot;: 1000,
    &quot;with_positions&quot;: true
  }
}
</code></pre>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="tradeoffs"><a class="header" href="#tradeoffs">Tradeoffs</a></h1>
<p>When configuring morsels, there are several tradeoffs you need to keep in mind, which varies greatly on depending on your collection and use case. </p>
<p>This chapter outlines the possible tradeoffs you can make and summarises the relevant options you would want to keep in mind.</p>
<h2 id="possible-tradeoffs"><a class="header" href="#possible-tradeoffs">Possible Tradeoffs</a></h2>
<p>The possible tradeoffs you can make are marked with ✔️. Those that are likely impossible are marked ❌, or in other words, you need a search server / SaaS for these options. Some options that are possible but are relatively undesirable (for which better equivalent options exist) are marked 😩.</p>
<p>Latency is labelled in terms of <code>RTT</code> (round trip time), the maximum of which is <code>3</code>.
Scalability and file bloat are inevitably labelled more <strong>subjectively</strong>.</p>
<p>Also note that the labelled <code>RTT</code> times are <strong>maximums</strong>. (namely, if files are served from cache instead)</p>
<table><thead><tr><th>Factor</th><th><code>RTT=0</code></th><th><code>RTT=1</code></th><th><code>RTT=2</code></th><th><code>RTT=3</code></th></tr></thead><tbody>
<tr><td>Fair Scalability,<br><span style="color: green">Little</span> File bloat</td><td>✔️</td><td>😩</td><td>😩</td><td>😩</td></tr>
<tr><td>Fair Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>😩</td><td>😩</td><td>😩</td><td>😩</td></tr>
<tr><td>Fair Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>😩</td><td>😩</td><td>😩</td><td>😩</td></tr>
<tr><td>Good Scalability,<br><span style="color: green">Little</span> File bloat</td><td>❌</td><td>❌</td><td>✔️</td><td>😩</td></tr>
<tr><td>Good Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>❌</td><td>✔️</td><td>😩</td><td>😩</td></tr>
<tr><td>Good Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>❌</td><td>✔️</td><td>😩</td><td>😩</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: green">Little</span> File bloat</td><td>❌</td><td>❌</td><td>❌</td><td>✔️</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: #ff8a0f">Moderate</span> File bloat</td><td>❌</td><td>❌</td><td>❌</td><td>✔️</td></tr>
<tr><td>Excellent Scalability,<br><span style="color: red">Heavy</span> File bloat</td><td>❌</td><td>❌</td><td>✔️</td><td>😩</td></tr>
<tr><td>Beyond Excellent Scalability<br>(consider running a<br>search server / SaaS)</td><td>❌</td><td>❌</td><td>❌</td><td>❌</td></tr>
</tbody></table>
<blockquote>
<p>Some roughly equivalent / nearby options are still marked ✔️ (vs 😩), since the labels are subjective.</p>
</blockquote>
<p>Of particular note, the only possible option under <code>RTT=0</code> is equivalent to using some other existing client side search library and generating a monolithic prebuilt index.</p>
<p>You may still want to use morsels since it packages a search UI, or, if you prefer the simplicity of a cli indexer tool (e.g. for CI).</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<blockquote>
<p>This section assumes you have read chapters 4 (barring 4.1) and 5, the options will be discussed in briefer detail here.</p>
</blockquote>
<p>The relevant options you will want to keep in mind are:</p>
<ul>
<li>Search Configuration: 
<ul>
<li>⭐⭐ The method of <a href="search_configuration.html#default-rendering-output--purpose">result preview generation</a></li>
<li><a href="search_configuration.html#search-library-options"><code>cacheAllFieldStores</code></a></li>
</ul>
</li>
<li>Indexing Configuration:
<ul>
<li>what fields are stored (<code>do_store</code>)</li>
<li><a href="indexing_configuration.html#fields_config"><code>field_store_block_size</code></a></li>
<li><a href="indexing_configuration.html#indexing_config"><code>pl_limit</code></a></li>
<li><a href="indexing_configuration.html#indexing_config"><code>pl_cache_threshold</code></a></li>
<li><a href="indexing_configuration.html#indexing_config"><code>num_stores_per_dir</code></a></li>
</ul>
</li>
</ul>
<p>The following sections discusses some combinations of options that generate the outputs in the table above.</p>
<h3 id="1-rtt0-fair-scalability-little-file-bloat"><a class="header" href="#1-rtt0-fair-scalability-little-file-bloat">1. <code>RTT=0</code>, Fair Scalability, Little File Bloat</a></h3>
<p>To achieve this result, you will need to ensure <strong>everything</strong> that is <strong>potentially</strong> needed is retrieved up front.</p>
<ul>
<li>Set <code>pl_limit</code> to an arbitrarily large number. This compresses the inverted index into one or a few files.</li>
<li>Ensure <code>pl_cache_threshold</code> is set to a very low number (or at least smaller than the inverted index file size), so that the postings list are loaded up front and cached in memory.</li>
<li>You would also want to set <code>field_store_block_size</code> to a fairly high number, and correspondingly set <code>cacheAllFieldStores</code> to <code>true</code>. This allows morsels to load the few field stores during initilisation and persistently cache them.</li>
</ul>
<blockquote>
<p>⭐ This is what’s being used by this documentation, since it is fairly small.<br>Nevertheless, <code>RTT=1/2</code> are still very acceptable settings under good network conditions. <code>RTT=3</code> may be slightly slow (<code>~600ms</code> assuming decent network conditions), but still quite acceptable depending on your use case since it reduces file bloat.<br><br>
Coming Soon: More repo / test github pages for demonstrating the other settings</p>
</blockquote>
<h3 id="2-rtt12-good-scalability-moderate--heavy-file-bloat"><a class="header" href="#2-rtt12-good-scalability-moderate--heavy-file-bloat">2. <code>RTT=1/2</code>, Good Scalability, Moderate / Heavy File Bloat</a></h3>
<p>The tradeoffs here a a little more complex; The impacts of various options are discussed under the 2 main methods of result preview generation.</p>
<h4 id="21-generating-result-previews-from-source-files"><a class="header" href="#21-generating-result-previews-from-source-files">2.1. Generating Result Previews from Source Files</a></h4>
<p>While generating result previews from source files greatly reduces file bloat, it does mean that an extra round (<code>RTT</code>) of network requests has to be made to retrieve said source files.</p>
<p>Therefore, the tradeoff here is between <strong>file bloat</strong> and <strong><code>RTT</code></strong>.</p>
<p>However, it is also more feasible with this option to remove a round of network requests by <strong>compressing and caching</strong> all field stores up front.
This is because in this option, field stores only store the relative file path from which to retrieve the source files, and are therefore fairly small.</p>
<p>For example, assuming each link takes an average of <code>25</code> bytes to encode (including json fluff), and <code>3MB</code> (ungzipped) is your “comfort zone”, you can store up to <code>120000</code> document links in a single, cached field store!</p>
<p>The relevant options are <code>pl_cache_threshold</code> and <code>field_store_block_size</code> (configure similar to the earlier <code>RTT=0</code> case).</p>
<blockquote>
<p>⭐ This is the default settings! (<code>RTT=2</code>, Little file bloat, Good scalability)</p>
</blockquote>
<h4 id="22-generating-result-previews-from-field-stores"><a class="header" href="#22-generating-result-previews-from-field-stores">2.2. Generating Result Previews from Field Stores</a></h4>
<p>(<code>RTT=1</code>, Moderate-Heavy file bloat, Good scalability)</p>
<p>It is also possible to achieve another trade off by using this method of preview generation.</p>
<p>As mentioned, generating result previews directly from field stores (making sure to specify <code>do_store</code> on the appropriate fields) avoids the extra mentioned round of network requests to retrieve said source files.</p>
<p>Moreover, for moderately sized collections, we may surmise that the <strong>size of the index</strong> is often far smaller than the <strong>size of field stores</strong>.</p>
<p>The idea here therefore is to <strong>cache the index</strong> (using <code>pl_limit</code>, <code>pl_cache_threshold</code>) and fragment the <strong>field stores</strong> (<code>field_store_block_size</code>), therefore reducing another <code>RTT</code>.</p>
<h3 id="3-excellent-scalability"><a class="header" href="#3-excellent-scalability">3. Excellent Scalability</a></h3>
<p>The settings here follow from the section directly above, disregarding the compromises. That is,</p>
<h4 id="31-generating-result-previews-from-source-files"><a class="header" href="#31-generating-result-previews-from-source-files">3.1. Generating Result Previews from Source Files</a></h4>
<p>(<code>RTT=3</code>, Excellent Scalability, Little-Moderate File Bloat)</p>
<p>The <code>RTT</code> compromise is accepted as is, without performing the caching mentioned in section 2.1.</p>
<p>This is because as the collection grows, we cannot guarantee that document links are at a size that can be feasibly and monolithically cached.</p>
<h4 id="32-generating-result-previews-from-field-stores"><a class="header" href="#32-generating-result-previews-from-field-stores">3.2. Generating Result Previews from Field Stores</a></h4>
<p>(<code>RTT=2</code>, Excellent Scalability, Heavy File Bloat)</p>
<p>Per section 2.2, one simply needs to avoid the assumption that the index can be cached.</p>
<p>Scalability is then ensured here by fragmenting both the index (using <code>pl_limit</code>) and field stores (<code>field_store_block_size</code>).</p>
<h3 id="other-options"><a class="header" href="#other-options">Other Options</a></h3>
<p>There are 2 other options worth highlighting that can help reduce the index size. </p>
<ul>
<li><a href="indexing_configuration.html#lang_config"><code>ignore_stop_words</code></a></li>
<li><a href="indexing_configuration.html#indexing_config"><code>with_positions</code></a></li>
</ul>
<p>Since the default settings (<code>RTT=2</code>, Little file bloat, Good scalability) fragments the index, stop word removal at indexing time is not done.</p>
<p>Positional information also takes up a considerable proportion of the index size.</p>
<p>If you are willing to forgo some features (e.g. phrase queries, boolean queries of stop words) in return for reducing the index size, you can enable / disable these options as appropriate.</p>
<p>This would be especially useful if configuring for a monolithic index (<code>RTT=0</code>, Fair Scalability, Little File Bloat), as it reduces the index size to be retrieved up front.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="dynamic-indexing"><a class="header" href="#dynamic-indexing">Dynamic Indexing</a></h1>
<p><em>Dynamic</em>, or <em>incremental</em> indexing is also supported by the indexer cli tool.</p>
<p>Detecting deleted, changed, or added files is done by storing an internal file path -&gt; last modified timestamp metadata map.</p>
<p>To enable it, simply pass the <code>--dynamic</code> or <code>-d</code> option when running the indexer.</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it Works</a></h2>
<p>As the core idea of Morsels is to split up the index into many tiny parts (and not more than necessary), the dynamic indexing feature works by “patching” only the files which were updated during the current run. This means that at search time, the same amount of index files are retrieved and searched through as before, to reduce the number of network requests.</p>
<p>This is in contrast to a more traditional “segment” based approach you might find in search servers, whereby each dynamic indexing run generates an entirely separate “segment”, and segments are merged together at runtime (during search). While this makes sense for traditional search tools, it may unfortunately generate too many network requests for index files and search overhead from merging files, something Morsels is trying to minimise.</p>
<h2 id="caveats"><a class="header" href="#caveats">Caveats</a></h2>
<p>There are certain caveats to note when using this option. Whenever possible, try to run a full reindex of the documents, utilising dynamic indexing only when indexing speed is of concern – for example, updating the index immediately when writing this documentation (on saving a file).</p>
<p>Note however, that the following circumstances will forcibly trigger a <strong>full</strong> reindex:</p>
<ul>
<li>If the output folder path does not contain any files indexed by morsels</li>
<li>It contains files indexed by a different version of morsels</li>
<li>The configuration file (<code>morsels_config.json</code>) was changed in any way</li>
</ul>
<h3 id="collection-statistics"><a class="header" href="#collection-statistics">Collection Statistics</a></h3>
<p>Collection statistics will tend to drift off when deleting documents (which also entails updating documents). This is because such documents may contain terms that were not encountered during the current run of dynamic indexing (from added / updated documents). Detecting such terms is difficult, as there is no guarantee the deleted documents are available anymore. The alternative would be to store such information in a non-inverted index, but that again takes up extra space =(.</p>
<p>As such, the information for these terms may not be “patched”. As a result, you <em>may</em> notice some slight drifting in the relative ranking of documents returned after some number of dynamic indexing runs.</p>
<h3 id="file-metadata"><a class="header" href="#file-metadata">File Metadata</a></h3>
<p>The change detection currently relies on the last modified time in file metadata. This may not be available or accurate on all systems, or guaranteed by the tools that generate the files Morsels indexes.</p>
<p>If file metadata is <em>unavailable</em> for any given file, the file would always be re-indexed.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="whats-next"><a class="header" href="#whats-next">What’s Next</a></h1>
<p>This section briefly details some future plans for this project, organised roughly in decreasing priority:</p>
<h2 id="cutting-down-the-wasm-binary-size"><a class="header" href="#cutting-down-the-wasm-binary-size">Cutting Down the Wasm Binary Size</a></h2>
<p>Not much to be said here - the smallest wasm binary is <code>992KB</code>, and <code>334KB</code> when gzipped.</p>
<p>Definitely something to work on, although the silver lining (hopefully) is that users typically don’t need to immediately (within &lt; 1s of page load?) access search functionalities.</p>
<h2 id="search-api"><a class="header" href="#search-api">Search API</a></h2>
<p>I.e. publishing <code>@morsels/search-lib</code>. Also, stabilizing some finer related details of the <a href="./search_configuration_renderers.html">renderers API</a> available.</p>
<h2 id="field-sorting--types"><a class="header" href="#field-sorting--types">Field Sorting &amp; Types</a></h2>
<p>While the focus currently is on free text queries sorted by relevance (BM25), it would definitely be great (if feasible) to support use cases that need to sort results by fields values.</p>
<p>Field types (e.g. integers), and sorting based on these types may be supported as such in the future.</p>
<h2 id="proximity-queries"><a class="header" href="#proximity-queries">Proximity Queries</a></h2>
<p>Basically something like <a href="https://www.guidingtech.com/16116/google-search-little-known-around-operator/">this</a>:</p>
<pre><code>lorem AROUND(2) dolor
</code></pre>
<h2 id="dynamic-linking-for-language-modules"><a class="header" href="#dynamic-linking-for-language-modules">Dynamic Linking for Language Modules</a></h2>
<p>Language modules are “bundled” into the <code>morsels_search</code> wasm module at the moment. In order to reduce binary size, each module is configured via feature flags and bundled separately. This however does mean that any and all language modules have to be PR-ed to the upstream repo (otherwise, one would have to maintain a separate fork of morsels on its own distribution channels). This is pending better dynamic linking support in wasm.</p>
<h2 id="exposing-morsels_indexer-package-api"><a class="header" href="#exposing-morsels_indexer-package-api">Exposing <code>morsels_indexer</code> Package API</a></h2>
<p>The plan is for the morsels_indexer package to also expose its API. This is still a WIP at this point, and I’m not exactly sure if there would even be a demand for this given the very specific use cases of this tool – raise an issue if so!</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>Contributions of any form (code, documentation, bug reports) are highly welcome.</p>
<p>To report a bug, simply head on over <a href="https://github.com/ang-zeyu/morsels/issues/new">here</a>.</p>
<p>The subsequent sections details information only for getting your development environment setup.</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="setting-up"><a class="header" href="#setting-up">Setting Up</a></h1>
<p>To get your development environment setup, you’ll need to have installed the following:</p>
<ul>
<li><a href="https://crates.io/">cargo</a>, the package manager for Rust</li>
<li><a href="https://github.com/rustwasm/wasm-pack">wasm-pack</a>, the “one-stop shop” for working with rust generated WebAssembly</li>
<li><a href="https://rust-lang.github.io/mdBook/">mdbook</a>, if working on mdbook-morsels plugin</li>
</ul>
<h2 id="commands"><a class="header" href="#commands">Commands</a></h2>
<p>After you have installed the above dependencies, run <code>npm run setup</code> to install npm-related dependencies. This command also symlinks the all npm packages locally, including the ones generated by wasm-pack.</p>
<h2 id="test-files"><a class="header" href="#test-files">Test Files</a></h2>
<p>You’ll also need to source a suitable set of html, json, or csv files that is loadable by one of the command-line <a href="./indexing_configuration.html#Loaders">loaders</a>. The data in the collection should be mappable to the <a href="./indexing_configuration.html#fields-needed-for-morselssearch-ui">fields</a> required by <code>@morsels/search-ui</code> for easy testing.</p>
<p>The test collection I used for the majority of development is a <code>380mb</code> csv corpus for example, in the following format.</p>
<pre><code>&quot;date&quot;, | &quot;title&quot;,                 | &quot;content&quot;,              | &quot;court&quot;
----------------------------------------------------------------------------------------
unused, | mapped to 'title' field, | mapped to 'body' field, | mapped to 'heading' field
</code></pre>
<p>Once you have your test files, place them under the <code>&lt;project-root&gt;/test_files/1/source</code> directory. If using a custom file format, you will likely need to configure the <a href="./indexing_configuration.html">data and field mappings</a> as well. You can run <code>cargo run -p morsels_indexer &lt;project-root&gt;/test_files/1/source --init</code> to create the default configuration file as a template, and proceed from there.</p>
<hr />
<p>I am unable to release my test collections I conveniently had on hand for licensing reasons =(, and have yet to search for a freely available one.</p>
<p>If you are aware of a widely available and easily integrated dataset, feel free to help supplement the docs here!</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script><div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="/morsels/morsels_assets/search-ui.css">
<style>
.morsels-root {
    --morsels-border: 3px solid var(--table-header-bg);
    --morsels-fg: var(--fg);
    --morsels-bg: var(--bg);
    --morsels-item-border-radius: 10px;
    --morsels-item-sub-border:  1px solid var(--table-border-color);
    --morsels-dropdown-input-separator-bg: var(--table-header-bg);
    --morsels-title-bg: var(--table-header-bg);
    --morsels-title-hover-fg: var(--bg);
    --morsels-title-hover-bg: var(--fg);
    --morsels-heading-bg: var(--table-alternate-bg);
    --morsels-heading-hover-bg: var(--table-header-bg);
    --morsels-body-hover-bg: var(--table-alternate-bg);
    --morsels-highlight: var(--search-mark-bg);
    --morsels-error-fg: var(--fg);
    --morsels-fine-print-fg: var(--fg);
    --morsels-loading-bg: var(--fg);
    --morsels-scrollbar-bg: var(--sidebar-bg);
    --morsels-scrollbar-thumb-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-box-shadow: none;
    --morsels-fullscreen-header-bg: var(--sidebar-bg);
    --morsels-fullscreen-input-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-border: 2px solid var(--searchbar-border-color);
    --morsels-fullscreen-input-focus-box-shadow: 0 0 5px var(--searchbar-shadow-color);
    --morsels-fullscreen-header-close-fg: var(--sidebar-fg);
    --morsels-fullscreen-header-close-bg: var(--sidebar-non-existant);
    --morsels-fullscreen-header-close-hover-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-hover-fg: var(--sidebar-spacer);
    --morsels-fullscreen-header-close-active-bg: var(--theme-popup-border);
    --morsels-fullscreen-header-close-active-fg: var(--sidebar-spacer);
}

#morsels-search {
    width: 100%;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 16px;
    padding: 0.5em 0.75em;
    border: 1px solid var(--searchbar-border-color);
    background: var(--searchbar-bg);
    color: var(--searchbar-fg);
    outline: none;
}

@media print {
    #morsels-search {
        display: none;
    }
}

#morsels-mdbook-target {
    list-style: none;
}
</style>
<p><input
    type="text"
    id="morsels-search"
    placeholder="Search"
/></p>
<p><span style="font-weight: 600;"><!--preload weight 600--></span></p>
<div class="morsels-root" id="morsels-mdbook-target"></div>
<h1 id="developing"><a class="header" href="#developing">Developing</a></h1>
<h2 id="building-and-running-the-development-site"><a class="header" href="#building-and-running-the-development-site">Building and Running the Development Site</a></h2>
<p>Once you have you test files placed in the correct folder per the previous chapter, run the <code>npm run index1</code> script to index your content, then run <code>npm run devServer1</code> to serve up the indexer’s output on port <code>3000</code>.</p>
<p>Finally, use the <code>npm run dev</code> script to open the development site on port <code>8080</code>. This script runs the webpack build process, which in turn triggers the WebAssembly build process as well through the wasm-pack webpack plugin.</p>
<p>There are also <code>npm run index2</code> / <code>devServer2</code> scripts available. An interactive script may be added in the future, but for now 2 should suffice (1 to test a smaller site, 1 to test a very large collection).</p>
<h2 id="working-with-the-mdbook-morsels-plugin--documentation-edits"><a class="header" href="#working-with-the-mdbook-morsels-plugin--documentation-edits">Working With the mdbook-morsels Plugin / Documentation Edits</a></h2>
<p>Simply run <code>npm run devDocsFull</code> to get serve up the documentation on port <code>8000</code>!</p>
<p>This script runs the following subscripts:</p>
<ol>
<li>
<p><code>npm run installIndexer</code>, this builds and install the indexer command-line tool to your <code>PATH</code> (mdbook plugins are basically separate executables, operating on <code>stdin / stdout</code>).</p>
</li>
<li>
<p><code>npm run buildSearch</code>, which builds the search-ui bundles, to ensure the documentation is being developed on the latest changes.</p>
</li>
<li>
<p><code>npm run installMdbook</code>, which builds and installs the mdbook plugin executable.</p>
</li>
<li>
<p><code>npm run devDocs</code>, which serves up the documentation at port <code>8000</code>. The commands are segregated to reduce iterative build times if you only need to execute the last few script(s).</p>
</li>
</ol>
<p>You can also run the individual commands separately to reduce iterative build times if you only need to execute the last few script(s).</p>
<script src="/morsels/morsels_assets/search-ui.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="/morsels/morsels_assets/mark.min.js" type="text/javascript" charset="utf-8"></script>
<script>
const base_url = '/morsels/';
const mode = (function () {
                // This IIFE is documentation specific, for demoing the different modes.
                // It would be the string mode (e.g. 'target') normally
                const params = new URLSearchParams(window.location.search);
                return params.get('mode') || 'target';
            })();
initMorsels({
  searcherOptions: {
    url: base_url + 'morsels_output/',
  },
  uiOptions: {
    mode,
    dropdownAlignment: 'bottom-start',
    target: document.getElementById('morsels-mdbook-target'),
    sourceFilesUrl: base_url,
    resultsRenderOpts: {
      addSearchedTerms: 'search',
    },
  },
});

if (window.location.search) {
  // Adapted from the original searcher.js for mdbook
  // https://github.com/rust-lang/mdBook/blob/master/src/theme/searcher/searcher.js
  const target = document.getElementById('content');
  const marker = new Mark(target);

  function doSearchOrMarkFromUrl() {
    // Check current URL for search request
    var url = new URL(window.location.href);
    var urlParams = new URLSearchParams(url.search);

    if (urlParams.has('search')) {
      var words = JSON.parse(decodeURIComponent(urlParams.get('search')));
      marker.mark(words);

      var markers = document.querySelectorAll('mark');
      function hide() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].classList.add('fade-out');
          window.setTimeout(function () { marker.unmark(); }, 300);
        }
      }
      for (var i = 0; i < markers.length; i++) {
        markers[i].addEventListener('click', hide);
      }
    }
  }
  doSearchOrMarkFromUrl();
}
</script>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>



        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="src/morsels-theme.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
