!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.initMorsels=r():e.initMorsels=r()}(self,(function(){return(()=>{"use strict";var e={958:e=>{e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}},r={};function t(n){var s=r[n];if(void 0!==s)return s.exports;var o=r[n]={exports:{}};return e[n](o,o.exports,t),o.exports}t.m=e,t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.u=e=>"search.worker.bundle.js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var n=r.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href;var n={};return(()=>{t.d(n,{default:()=>R});const e=class{constructor(e,r,t,n,s){this.query=e,this.searchedTerms=r,this.queryParts=t,this.retrieve=n,this.free=s}};var r=function(e,r,t,n){return new(t||(t=Promise))((function(s,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function d(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,d)}l((n=n.apply(e,r||[])).next())}))};const s=class{constructor(e,r,t){this.docId=e,this.score=r,this.fieldInfos=t,this.storage=Object.create(null)}populate(e,t,n){return r(this,void 0,void 0,(function*(){const r=Math.floor(this.docId/t),s=Math.floor(r/n),o=`${e}field_store/${s}/${r}.json`;try{const e=yield(yield fetch(o)).json();this.storage=e[this.docId%t]}catch(e){console.log(e)}}))}getSingleField(e){const r=this.fieldInfos.find((r=>r.name===e));if(!r)return"";const t=this.storage.find((e=>e[0]===r.id));return t?t[1]:""}getStorageWithFieldNames(){return this.storage.map((e=>{const r=e.map((e=>e));return r[0]=this.fieldInfos[r[0]].name,r}))}};var o=function(e,r,t,n){return new(t||(t=Promise))((function(s,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function d(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,d)}l((n=n.apply(e,r||[])).next())}))};const i=class{constructor(e){this.options=e,this.workerQueryPromises=Object.create(null),this.worker=new Worker(new URL(t.p+t.u(658),t.b));const r=new Promise((e=>{this.worker.onmessage=r=>{if(r.data.isSetupDone)e();else if(r.data.query){const{query:e,timestamp:t,nextResults:n,searchedTerms:s,queryParts:o}=r.data;this.workerQueryPromises[e][t].resolve({query:e,nextResults:n,searchedTerms:s,queryParts:o})}},this.worker.onmessageerror=e=>{console.log(e)}}));this.setupPromise=this.retrieveConfig().then((()=>(e.useQueryTermProximity=e.useQueryTermProximity&&this.morselsConfig.indexingConfig.withPositions,this.worker.postMessage(this.morselsConfig),r)))}retrieveConfig(){return o(this,void 0,void 0,(function*(){const e=yield(yield fetch(`${this.options.url}_morsels_config.json`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();if("0.0.0"!==e.ver)throw new Error("Morsels search version not equal to indexer version!");const{field_infos:r}=e,t=[];Object.entries(r.field_infos_map).forEach((([e,r])=>{r.name=e,t.push(r)})),t.sort(((e,r)=>e.id-r.id)),this.morselsConfig={indexingConfig:{loaderConfigs:e.indexing_config.loader_configs,plNamesToCache:e.indexing_config.pl_names_to_cache,numPlsPerDir:e.indexing_config.num_pls_per_dir,numStoresPerDir:e.indexing_config.num_stores_per_dir,withPositions:e.indexing_config.with_positions},langConfig:e.lang_config,fieldInfos:t,numScoredFields:r.num_scored_fields,fieldStoreBlockSize:r.field_store_block_size,searcherOptions:this.options}}))}deleteQuery(e,r){delete this.workerQueryPromises[e][r],0===Object.keys(this.workerQueryPromises[e]).length&&delete this.workerQueryPromises[e]}getQuery(r){return o(this,void 0,void 0,(function*(){yield this.setupPromise;const t=(new Date).getTime();this.workerQueryPromises[r]=this.workerQueryPromises[r]||{},this.workerQueryPromises[r][t]={promise:void 0,resolve:void 0},this.workerQueryPromises[r][t].promise=new Promise((e=>{this.workerQueryPromises[r][t].resolve=e,this.worker.postMessage({query:r,timestamp:t})}));const n=yield this.workerQueryPromises[r][t].promise;return new e(r,n.searchedTerms,n.queryParts,(e=>o(this,void 0,void 0,(function*(){yield this.workerQueryPromises[r][t].promise,this.workerQueryPromises[r][t].promise=new Promise((n=>{this.workerQueryPromises[r][t].resolve=n,this.worker.postMessage({query:r,timestamp:t,isGetNextN:!0,n:e})}));const n=(yield this.workerQueryPromises[r][t].promise).nextResults.map((([e,r])=>new s(e,r,this.morselsConfig.fieldInfos)));return yield Promise.all(n.map((e=>e.populate(this.options.url,this.morselsConfig.fieldStoreBlockSize,this.morselsConfig.indexingConfig.numStoresPerDir)))),n}))),(()=>{this.deleteQuery(r,t),this.worker.postMessage({query:r,isFree:!0})}))}))}};const d=function(e,r,...t){const n=document.createElement(e);return Object.entries(r).forEach((([e,r])=>{n.setAttribute(e,r)})),t.forEach((e=>{if("string"==typeof e){const r=document.createElement("span");r.textContent=e,n.appendChild(r)}else n.appendChild(e)})),n};var l=t(958),a=function(e,r,t,n){return new(t||(t=Promise))((function(s,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function d(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,d)}l((n=n.apply(e,r||[])).next())}))};const c=new DOMParser,u="_relative_fp";function p(e,r,t,n,s){const o=Object.create(null);function i(e){const n=r.map((()=>-1e8));let i=n.map((e=>e)),l=1e8,a=0,c=t.exec(e);for(;c;){const r=c[2].toLowerCase(),s=o[r];n[s]=c.index+c[1].length,c[1].length>0&&(t.lastIndex=n[s]);const d=n.filter((e=>e>=0)),u=Math.max(...d)-Math.min(...d),p=d.length>a;(p||u<l)&&(p&&(a=d.length),l=u,i=n.map((e=>e))),c=t.exec(e)}t.lastIndex=0;const u=i.map(((e,t)=>({pos:e,term:r[t]}))).filter((e=>e.pos>=0)).sort(((e,r)=>e.pos-r.pos)),p=[];if(!u.length)return{result:p,numberTermsMatched:a};let h=0;for(let r=0;r<u.length;r+=1){const{pos:t,term:n}=u[r],o=t+n.length;t>h+80?(p.push(d("span",{class:"morsels-ellipsis"})),p.push(e.substring(t-40,t)),p.push(s.resultsRenderOpts.highlightRender(d,s.opts,n)),p.push(e.substring(o,o+40))):(p.pop(),p.push(e.substring(h,t)),p.push(s.resultsRenderOpts.highlightRender(d,s.opts,n)),p.push(e.substring(o,o+40))),h=o}return p.push(d("span",{class:"morsels-ellipsis"})),{result:p,numberTermsMatched:a}}r.forEach(((e,r)=>{o[e.toLowerCase()]=r}));let l=-1,a={result:void 0,numberTermsMatched:0};const c=[];let u=-1;for(const r of e){if(u+=1,r[0].startsWith("heading"))continue;const{result:t,numberTermsMatched:o}=i(r[1]);if(0===o)continue;let p=u-1;for(;p>l;p-=1)if("heading"===e[p][0]){l=p,c.push({result:s.resultsRenderOpts.headingBodyRender(d,s.opts,e[p][1],t,p-1>=0&&"headingLink"===e[p-1][0]&&`${n}#${e[p-1][1]}`),numberTermsMatched:o});break}!c.length&&o>a.numberTermsMatched&&(a={result:s.resultsRenderOpts.bodyOnlyRender(d,s.opts,t),numberTermsMatched:o})}return!c.length&&a.numberTermsMatched>0&&c.push(a),c.sort(((e,r)=>r.numberTermsMatched-e.numberTermsMatched)).map((e=>e.result)).slice(0,2)}function h(e,r,t,n,s,o){return a(this,void 0,void 0,(function*(){const{loaderConfigs:i}=t.indexingConfig,l=e.getStorageWithFieldNames(),a=l.find((e=>e[0]===u)),h=a&&a[1]||"",m="string"==typeof r.sourceFilesUrl,f=m?`${r.sourceFilesUrl}${h}`:void 0,g=l.find((e=>"title"===e[0]));let y,v=g&&g[1]||h;if(n)y=p(l.filter((e=>e[0]!==u&&"title"!==e[0])),s.searchedTerms,o,h,r.render);else if(a&&m)if(f.endsWith(".html")&&i.HtmlLoader){const e=yield(yield fetch(f)).text(),t=c.parseFromString(e,"text/html"),{title:n,bodies:d}=function(e,r,t,n,s,o){const i=[];if(r.exclude_selectors)for(const t of r.exclude_selectors){const r=e.querySelectorAll(t);for(let e=0;e<r.length;e+=1)r[e].remove()}r.selectors=r.selectors||[];const d=r.selectors.map((e=>e.selector)).join(",");!function e(t,n){for(const e of r.selectors)if(t.matches(e.selector)){Object.entries(e.attr_map).forEach((([e,r])=>{t.attributes[e]&&i.push([r,t.attributes[e].value])})),n=e.field_name;break}if(t.querySelector(d))for(let r=0;r<t.childNodes.length;r+=1){const s=t.childNodes[r];s.nodeType===Node.ELEMENT_NODE?e(s,n):s.nodeType===Node.TEXT_NODE&&n&&(i.length&&i[i.length-1][0]===n?i[i.length-1][1]+=s.data:i.push([n,s.data]))}else n&&(i.length&&i[i.length-1][0]===n?i[i.length-1][1]+=t.innerText:i.push([n,t.innerText||""]))}(e.documentElement,void 0);const l=i.find((e=>"title"===e[0]));let a="";return l&&([,a]=l,l[1]=""),{title:a,bodies:p(i,t,n,s,o)}}(t,i.HtmlLoader,s.searchedTerms,o,h,r.render);v=n||v,y=d}else{const e=new URL(f);if(e.pathname.endsWith(".json")&&i.JsonLoader){const t=yield(yield fetch(f)).json(),{title:n,bodies:d}=function(e,r,t,n,s,o){const i=[],{field_map:d,field_order:l}=r,a=Object.entries(d).find((([,e])=>"title"===e)),c=a&&a[0];for(const r of l)r!==c&&e[r]&&i.push([d[r],e[r]]);return{title:c&&e[c],bodies:p(i,t,n,s,o)}}(e.hash?t[e.hash.substring(1)]:t,i.JsonLoader,s.searchedTerms,o,h,r.render);v=n||v,y=d}}else y=[];return r.render.resultsRenderOpts.listItemRender(d,r.render.opts,f,v,y,l)}))}function m(e,r,t,n,s){const o=new RegExp(`(^|\\W)(${s.searchedTerms.map((e=>`(${l(e)})`)).join("|")})(?=\\W|$)`,"gi"),i=t.fieldInfos.find((e=>e.do_store&&("body"===e.name||"title"===e.name||"heading"===e.name)));return Promise.all(n.map((e=>h(e,r,t,i,s,o))))}function f(e,r,t,n,s){return a(this,void 0,void 0,(function*(){const o=s.render.loadingIndicatorRender(d,s.render.opts);t||n.appendChild(o);const i=document.createDocumentFragment();(t?function(e,r){const t=[],n=[];let s=[];return e.forEach((e=>{if(e.isCorrected){for(const r of e.originalTerms)e.terms.includes(r)||t.push(r);for(const r of e.terms)n.push(r)}else e.isExpanded&&(s=e.terms)})),r.termInfoRender(d,r.opts,t,n,s)}(e.queryParts,s.render):[]).forEach((e=>i.appendChild(e)));const l=yield e.retrieve(s.render.resultsRenderOpts.resultsPerPage),c=yield s.render.resultsRender(d,s,r,l,e);c.length?c.forEach((e=>i.appendChild(e))):t&&i.appendChild(s.render.noResultsRender(d,s.render.opts));const u=i.lastElementChild;t?(n.innerHTML="",n.appendChild(i)):o.replaceWith(i);let p=!0;const h=new IntersectionObserver(((t,o)=>a(this,void 0,void 0,(function*(){!p&&t[0].isIntersecting?(o.unobserve(u),yield f(e,r,!1,n,s)):p=!1}))),{rootMargin:"10px 10px 10px 10px"});c.length&&h.observe(u)}))}var g=function(e,r,t,n){return new(t||(t=Promise))((function(s,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function d(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var r;e.done?s(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,d)}l((n=n.apply(e,r||[])).next())}))};let y,v,w=!1;function b(e,r,t,n,s,o){return g(this,void 0,void 0,(function*(){try{y&&y.free(),y=yield s.getQuery(e),yield f(y,s.morselsConfig,!0,t,o),r.scrollTo({top:0}),t.scrollTo({top:0})}catch(e){throw t.innerHTML=e.message,e}finally{if(v){const e=v;v=void 0,yield e()}else w=!1}}))}const R=function(e){const r=window.matchMedia("only screen and (max-width: 1024px)").matches;!function(e,r){"numberOfExpandedTerms"in e.searcherOptions||(e.searcherOptions.numberOfExpandedTerms=3),"useQueryTermProximity"in e.searcherOptions||(e.searcherOptions.useQueryTermProximity=!r),"inputId"in e||(e.inputId="morsels-search"),"inputDebounce"in e||(e.inputDebounce=r?275:200),"render"in e||(e.render={}),"enablePortal"in e.render||(e.render.enablePortal="auto"),e.render.portalTo=e.render.portalTo||document.getElementsByTagName("body")[0],e.render.show=e.render.show||((r,t,n)=>{if(n){e.render.portalTo.appendChild(r);const t=r.querySelector("input.morsels-portal-input");t&&t.focus()}else r.lastElementChild.style.display="block",r.lastElementChild.previousSibling.style.display="block"}),e.render.hide=e.render.hide||((e,r,t)=>{t?e.remove():(e.lastElementChild.style.display="none",e.lastElementChild.previousSibling.style.display="none")}),e.render.rootRender=e.render.rootRender||((e,r,t,n)=>{const s=e("div",{class:"morsels-root"+(n?" morsels-portal-root":"")});let o;if(n&&(o=e("div",{class:"morsels-portal-backdrop"},s),s.onclick=e=>e.stopPropagation(),o.onclick=()=>o.remove()),n){const r=e("button",{class:"morsels-input-close-portal"});r.onclick=n,s.appendChild(e("div",{class:"morsels-portal-input-button-wrapper"},t,r))}else s.appendChild(t);n||s.appendChild(e("div",{class:`morsels-input-dropdown-separator ${r.dropdownAlignment||"right"}`,style:"display: none;"}));const i=e("ul",{class:`morsels-list ${n?"":r.dropdownAlignment||"right"}`,style:n?"":"display: none;"});return s.appendChild(i),{root:n?o:s,listContainer:i}}),e.render.portalInputRender=e.render.portalInputRender||(e=>e("input",{class:"morsels-portal-input",type:"text"})),e.render.noResultsRender=e.render.noResultsRender||(e=>e("div",{class:"morsels-no-results"})),e.render.portalBlankRender=e.render.portalBlankRender||(e=>e("div",{class:"morsels-portal-blank"})),e.render.loadingIndicatorRender=e.render.loadingIndicatorRender||(e=>e("span",{class:"morsels-loading-indicator"})),e.render.termInfoRender=e.render.termInfoRender||(()=>[]),e.render.resultsRender=e.render.resultsRender||m,e.render.resultsRenderOpts=e.render.resultsRenderOpts||{},"resultsPerPage"in e.render.resultsRenderOpts||(e.render.resultsRenderOpts.resultsPerPage=8),e.render.resultsRenderOpts.listItemRender=e.render.resultsRenderOpts.listItemRender||((e,r,t,n,s)=>{const o=e("a",{class:"morsels-link"},e("div",{class:"morsels-title"},n),...s);return t&&o.setAttribute("href",t),e("li",{class:"morsels-list-item"},o)}),e.render.resultsRenderOpts.headingBodyRender=e.render.resultsRenderOpts.headingBodyRender||((e,r,t,n,s)=>{const o=e("a",{class:"morsels-heading-body"},e("div",{class:"morsels-heading"},t),e("div",{class:"morsels-bodies"},e("div",{class:"morsels-body"},...n)));return s&&o.setAttribute("href",s),o}),e.render.resultsRenderOpts.bodyOnlyRender=e.render.resultsRenderOpts.bodyOnlyRender||((e,r,t)=>e("div",{class:"morsels-body"},...t)),e.render.resultsRenderOpts.highlightRender=e.render.resultsRenderOpts.highlightRender||((e,r,t)=>e("span",{class:"morsels-highlight"},t)),e.render.opts=e.render.opts||{}}(e,r);const t=new i(e.searcherOptions);let n=-1,s=!0;const o=(r,o,i)=>l=>{const a=l.target.value;if(clearTimeout(n),a.length)n=setTimeout((()=>{s&&(o.innerHTML="",o.appendChild(e.render.loadingIndicatorRender(d,e.render.opts)),i||e.render.show(r,e.render.opts,i)),w?v=()=>b(a,r,o,0,t,e):(w=!0,b(a,r,o,0,t,e)),s=!1}),e.inputDebounce);else{const t=()=>{i?(o.innerHTML="",o.appendChild(e.render.portalBlankRender(d,e.render.opts))):e.render.hide(r,e.render.opts,i),w=!1,s=!0};w?v=t:t()}},l=e.render.portalInputRender(d,e.render.opts),{root:a,listContainer:c}=e.render.rootRender(d,e.render.opts,l,(()=>e.render.hide(a,e.render.opts,!0)));l.addEventListener("input",o(a,c,!0)),l.addEventListener("keydown",(e=>e.stopPropagation())),c.appendChild(e.render.portalBlankRender(d,e.render.opts));const u=e.inputId&&document.getElementById(e.inputId);if(u){const t=u.parentElement;u.remove();const{root:n,listContainer:s}=e.render.rootRender(d,e.render.opts,u);if(t.appendChild(n),u.addEventListener("input",o(n,s,!1)),u.addEventListener("keydown",(e=>e.stopPropagation())),u.addEventListener("blur",(()=>{e.render.enablePortal||setTimeout((()=>{let r=document.activeElement;for(;r;)if(r=r.parentElement,r===s)return void u.focus();e.render.hide(n,e.render.opts,!1)}),100)})),u.addEventListener("focus",(()=>{e.render.enablePortal?e.render.show(a,e.render.opts,!0):s.childElementCount&&e.render.show(n,e.render.opts,!1)})),"auto"===e.render.enablePortal){let t;e.render.enablePortal=r,window.addEventListener("resize",(()=>{clearTimeout(t),t=setTimeout((()=>{const r=e.render.enablePortal;e.render.enablePortal=window.matchMedia("only screen and (max-width: 1024px)").matches,r!==e.render.enablePortal&&(e.render.enablePortal?e.render.hide(n,e.render.opts,!1):e.render.hide(a,e.render.opts,!0))}),250)}))}}return{show:()=>{e.render.show(a,e.render.opts,!0)},hide:()=>{e.render.hide(a,e.render.opts,!0)}}}})(),n=n.default})()}));